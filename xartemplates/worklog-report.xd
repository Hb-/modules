<xar:set name="worklog_objectid">xarModGetVar('xtasks','worklog_objectid')</xar:set>
<xar:data-getitem name="$properties" module="xtasks" itemtype="2" itemid="$worklog_objectid" />
<xar:set name="projects_objectid">xarModGetVar('xproject','projects_objectid')</xar:set>
<xar:data-getitem name="$xproject_properties" module="xproject" itemtype="1" itemid="$projects_objectid" />

<xar:template type="module" file="admin-menu" />

<div class="xar-mod-head">
    <span class="xar-mod-title">Work Log</span>
</div>
<div class="xar-mod-body">    
    <form method="post" action="#xarModURL('xtasks','worklog','report')#">
        <fieldset><legend><strong>Filter Results: </strong><input type="submit" value="Go" /></legend>
        <div>Report View: <select name="reportview">
                <option value="thisprojectid:taskownerid:workdate">Project / Staff / Date</option>
                <option value="thisprojectid:workdate:taskownerid">Project / Date / Staff</option>
                <option value="taskownerid:thisprojectid:workdate">Staff / Project / Date</option>
                <option value="taskownerid:workdate:thisprojectid">Staff / Date / Project</option>
                <option value="workdate:thisprojectid:taskownerid">Date / Project / Staff</option>
                <option value="workdate:taskownerid:thisprojectid">Date / Staff / Project</option>
            </select>
        </div>
        <div>By Project: <select name="projectid">
            <option value=""></option>
            <xar:set name="projectlist">xarModAPIFunc('xproject','user','getall',array('sortby'=>"project_name"))</xar:set>
            <xar:foreach in="$projectlist" value="$projectinfo">
                <xar:if condition="$projectinfo['projectid'] eq $projectid">
                    <option value="#$projectinfo['projectid']#" selected>#$projectinfo['project_name']#</option>
                <xar:else />
                    <option value="#$projectinfo['projectid']#">#$projectinfo['project_name']#</option>
                </xar:if>
            </xar:foreach>
            </select>
        </div>
        <xar:set name="ownersearchchecked">($ownerid ? "checked" : "")</xar:set>
        <div>By Staff member: <xar:data-input property="$properties['ownerid']" name="ownerid" value="$ownerid" /><input type="checkbox" name="ownersearch" value="1" #$ownersearchchecked#/> <xar:mlstring>Filter by Staff Member?</xar:mlstring></div>
        <div>From <xar:data-input type="calendar" name="mindate" value="$mindate" />
             to <xar:data-input type="calendar" name="maxdate" value="$maxdate" />#$ownerid#
        </div>
        (or)
        <div>Days Displayed: <input type="text" name="ttldays" value="#$ttldays#" size="3" /></div>
        </fieldset>
    </form>
    
    <div style="width: 100%;">
        <div>
            <div class="xtasks-tasklist-header" style="float: left; width: 60px;"><strong><xar:mlstring>Date</xar:mlstring></strong></div>
            <div class="xtasks-tasklist-header" style="float: left; width: 120px; text-align: center;"><strong><xar:mlstring>Staff</xar:mlstring></strong></div>
            <div class="xtasks-tasklist-header" style="float: left; width: 60px; text-align: center;"><strong><xar:mlstring>Hours</xar:mlstring></strong></div>
            <div class="xtasks-tasklist-header" style="float: left; width: 60px; text-align: center;"><strong><xar:mlstring>Tasks</xar:mlstring></strong></div>
            <div style="clear: both;"></div>
        </div>
        
        <xar:set name="rowclass">"xtasks-norm-row"</xar:set>
        <xar:set name="prev_projectid">0</xar:set>
        <xar:set name="prev_ownerid">0</xar:set>
        <xar:set name="firstproject">1</xar:set>
        <xar:if condition="$reportview eq 'thisprojectid:taskownerid:workdate'">
            <xar:foreach in="$worksummary" key="$projectid" value="$projectsummary">
                <xar:foreach in="$projectsummary" key="$ownerid" value="$staffhours">
                    <xar:foreach in="$staffhours" key="$workdate" value="$workhours">
                    
                        <xar:if condition="$projectid ne $prev_projectid or $firstproject">
                            <xar:set name="projectinfo">xarModAPIFunc('xproject','user','get',array('projectid'=>$projectid))</xar:set>
                            <xar:set name="firstproject">0</xar:set>
                            <xar:set name="errortype">xarCurrentErrorType()</xar:set>
                            
                            <xar:if condition="!$firstproject">
                                </fieldset>
                            </xar:if>
                            
                            <xar:if condition="!empty($errortype)">
                                <xar:set name="dummy">xarErrorFree()</xar:set>
                                <fieldset><legend><span class="xar-title">[project deleted]</span></legend>
                            <xar:else />
                                <fieldset><legend><span class="xar-title">#$projectinfo['project_name']#</span> [<a href="index.php?module=xproject&amp;type=admin&amp;func=display&amp;projectid=#$projectid#&amp;mode=worklog">view</a>]</legend>
                            </xar:if>
                            <xar:set name="rowclass">"xtasks-alt-row"</xar:set>
                            <xar:set name="prev_projectid">$projectid</xar:set>
                        </xar:if>
                    
                    
                        <xar:if condition="$rowclass eq 'xtasks-norm-row'">
                            <xar:set name="rowclass">"xtasks-alt-row"</xar:set>
                        <xar:else />
                            <xar:set name="rowclass">"xtasks-norm-row"</xar:set>
                        </xar:if>
                        
                        <xar:set name="dummy">$workhours['hours'] = sprintf("%.02f", $workhours['hours'])</xar:set>
                        
                        <div class="#$rowclass#">
                            <div class="xtasks-tasklist-data" style="float: left; width: 60px;"><xar:data-output property="$properties['eventdate']" value="$workdate" dateformat="%d-%b" />&nbsp;</div>
                            <div class="xtasks-tasklist-data" style="float: left; width: 120px;"><xar:data-output property="$properties['ownerid']" value="$ownerid" />&nbsp;</div>
                            <div class="xtasks-tasklist-data" style="float: left; width: 60px; text-align: right;"><xar:data-output property="$properties['hours']" value="$workhours['hours']" />&nbsp;hrs</div>
                            <div class="xtasks-tasklist-data" style="float: left; width: 60px; text-align: right;"><xar:data-output property="$properties['hours']" value="$workhours['ttltasks']" />&nbsp;tasks</div>
                            <div style="clear: both;"></div>
                        </div>
                    </xar:foreach>
                </xar:foreach>
            </xar:foreach>
        <xar:elseif condition="$reportview eq 'thisprojectid:workdate:taskownerid'" />
            <xar:foreach in="$worksummary" key="$projectid" value="$projectsummary">
                <xar:foreach in="$projectsummary" key="$workdate" value="$workhours">
                    <xar:foreach in="$workhours" key="$ownerid" value="$staffhours">
                    
                        <xar:if condition="$projectid ne $prev_projectid or $firstproject">
                            <xar:set name="projectinfo">xarModAPIFunc('xproject','user','get',array('projectid'=>$projectid))</xar:set>
                            <xar:set name="firstproject">0</xar:set>
                            <xar:set name="errortype">xarCurrentErrorType()</xar:set>
                            
                            <xar:if condition="!$firstproject">
                                </fieldset>
                            </xar:if>
                            
                            <xar:if condition="!empty($errortype)">
                                <xar:set name="dummy">xarErrorFree()</xar:set>
                                <fieldset><legend><span class="xar-title">[project deleted]</span></legend>
                            <xar:else />
                                <fieldset><legend><span class="xar-title">#$projectinfo['project_name']#</span> [<a href="index.php?module=xproject&amp;type=admin&amp;func=display&amp;projectid=#$projectid#&amp;mode=worklog">view</a>]</legend>
                            </xar:if>
                            <xar:set name="rowclass">"xtasks-alt-row"</xar:set>
                            <xar:set name="prev_projectid">$projectid</xar:set>
                        </xar:if>
                    
                    
                        <xar:if condition="$rowclass eq 'xtasks-norm-row'">
                            <xar:set name="rowclass">"xtasks-alt-row"</xar:set>
                        <xar:else />
                            <xar:set name="rowclass">"xtasks-norm-row"</xar:set>
                        </xar:if>
                        
                        <xar:set name="dummy">$workhours['hours'] = sprintf("%.02f", $workhours['hours'])</xar:set>
                        
                        <div class="#$rowclass#">
                            <div class="xtasks-tasklist-data" style="float: left; width: 60px;"><xar:data-output property="$properties['eventdate']" value="$workdate" dateformat="%d-%b" />&nbsp;</div>
                            <div class="xtasks-tasklist-data" style="float: left; width: 120px;"><xar:data-output property="$properties['ownerid']" value="$ownerid" />&nbsp;</div>
                            <div class="xtasks-tasklist-data" style="float: left; width: 60px; text-align: right;"><xar:data-output property="$properties['hours']" value="$workhours['hours']" />&nbsp;hrs</div>
                            <div class="xtasks-tasklist-data" style="float: left; width: 60px; text-align: right;"><xar:data-output property="$properties['hours']" value="$workhours['ttltasks']" />&nbsp;tasks</div>
                            <div style="clear: both;"></div>
                        </div>
                    </xar:foreach>
                </xar:foreach>
            </xar:foreach>
        <xar:elseif condition="$reportview eq 'taskownerid:thisprojectid:workdate'" />
            <xar:foreach in="$worksummary" key="$projectid" value="$projectsummary">
                <xar:foreach in="$projectsummary" key="$ownerid" value="$staffhours">
                    <xar:foreach in="$staffhours" key="$workdate" value="$workhours">
                    
                        <xar:if condition="$projectid ne $prev_projectid or $firstproject">
                            <xar:set name="projectinfo">xarModAPIFunc('xproject','user','get',array('projectid'=>$projectid))</xar:set>
                            <xar:set name="firstproject">0</xar:set>
                            <xar:set name="errortype">xarCurrentErrorType()</xar:set>
                            
                            <xar:if condition="!$firstproject">
                                </fieldset>
                            </xar:if>
                            
                            <xar:if condition="!empty($errortype)">
                                <xar:set name="dummy">xarErrorFree()</xar:set>
                                <fieldset><legend><span class="xar-title">[project deleted]</span></legend>
                            <xar:else />
                                <fieldset><legend><span class="xar-title">#$projectinfo['project_name']#</span> [<a href="index.php?module=xproject&amp;type=admin&amp;func=display&amp;projectid=#$projectid#&amp;mode=worklog">view</a>]</legend>
                            </xar:if>
                            <xar:set name="rowclass">"xtasks-alt-row"</xar:set>
                            <xar:set name="prev_projectid">$projectid</xar:set>
                        </xar:if>
                    
                    
                        <xar:if condition="$rowclass eq 'xtasks-norm-row'">
                            <xar:set name="rowclass">"xtasks-alt-row"</xar:set>
                        <xar:else />
                            <xar:set name="rowclass">"xtasks-norm-row"</xar:set>
                        </xar:if>
                        
                        <xar:set name="dummy">$workhours['hours'] = sprintf("%.02f", $workhours['hours'])</xar:set>
                        
                        <div class="#$rowclass#">
                            <div class="xtasks-tasklist-data" style="float: left; width: 60px;"><xar:data-output property="$properties['eventdate']" value="$workdate" dateformat="%d-%b" />&nbsp;</div>
                            <div class="xtasks-tasklist-data" style="float: left; width: 120px;"><xar:data-output property="$properties['ownerid']" value="$ownerid" />&nbsp;</div>
                            <div class="xtasks-tasklist-data" style="float: left; width: 60px; text-align: right;"><xar:data-output property="$properties['hours']" value="$workhours['hours']" />&nbsp;hrs</div>
                            <div class="xtasks-tasklist-data" style="float: left; width: 60px; text-align: right;"><xar:data-output property="$properties['hours']" value="$workhours['ttltasks']" />&nbsp;tasks</div>
                            <div style="clear: both;"></div>
                        </div>
                    </xar:foreach>
                </xar:foreach>
            </xar:foreach>
        <xar:elseif condition="$reportview eq 'taskownerid:workdate:thisprojectid'" />
            <xar:foreach in="$worksummary" key="$projectid" value="$projectsummary">
                <xar:foreach in="$projectsummary" key="$ownerid" value="$staffhours">
                    <xar:foreach in="$staffhours" key="$workdate" value="$workhours">
                    
                        <xar:if condition="$projectid ne $prev_projectid or $firstproject">
                            <xar:set name="projectinfo">xarModAPIFunc('xproject','user','get',array('projectid'=>$projectid))</xar:set>
                            <xar:set name="firstproject">0</xar:set>
                            <xar:set name="errortype">xarCurrentErrorType()</xar:set>
                            
                            <xar:if condition="!$firstproject">
                                </fieldset>
                            </xar:if>
                            
                            <xar:if condition="!empty($errortype)">
                                <xar:set name="dummy">xarErrorFree()</xar:set>
                                <fieldset><legend><span class="xar-title">[project deleted]</span></legend>
                            <xar:else />
                                <fieldset><legend><span class="xar-title">#$projectinfo['project_name']#</span> [<a href="index.php?module=xproject&amp;type=admin&amp;func=display&amp;projectid=#$projectid#&amp;mode=worklog">view</a>]</legend>
                            </xar:if>
                            <xar:set name="rowclass">"xtasks-alt-row"</xar:set>
                            <xar:set name="prev_projectid">$projectid</xar:set>
                        </xar:if>
                    
                    
                        <xar:if condition="$rowclass eq 'xtasks-norm-row'">
                            <xar:set name="rowclass">"xtasks-alt-row"</xar:set>
                        <xar:else />
                            <xar:set name="rowclass">"xtasks-norm-row"</xar:set>
                        </xar:if>
                        
                        <xar:set name="dummy">$workhours['hours'] = sprintf("%.02f", $workhours['hours'])</xar:set>
                        
                        <div class="#$rowclass#">
                            <div class="xtasks-tasklist-data" style="float: left; width: 60px;"><xar:data-output property="$properties['eventdate']" value="$workdate" dateformat="%d-%b" />&nbsp;</div>
                            <div class="xtasks-tasklist-data" style="float: left; width: 120px;"><xar:data-output property="$properties['ownerid']" value="$ownerid" />&nbsp;</div>
                            <div class="xtasks-tasklist-data" style="float: left; width: 60px; text-align: right;"><xar:data-output property="$properties['hours']" value="$workhours['hours']" />&nbsp;hrs</div>
                            <div class="xtasks-tasklist-data" style="float: left; width: 60px; text-align: right;"><xar:data-output property="$properties['hours']" value="$workhours['ttltasks']" />&nbsp;tasks</div>
                            <div style="clear: both;"></div>
                        </div>
                    </xar:foreach>
                </xar:foreach>
            </xar:foreach>
        <xar:elseif condition="$reportview eq 'workdate:thisprojectid:taskownerid'" />
            <xar:foreach in="$worksummary" key="$projectid" value="$projectsummary">
                <xar:foreach in="$projectsummary" key="$ownerid" value="$staffhours">
                    <xar:foreach in="$staffhours" key="$workdate" value="$workhours">
                    
                        <xar:if condition="$projectid ne $prev_projectid or $firstproject">
                            <xar:set name="projectinfo">xarModAPIFunc('xproject','user','get',array('projectid'=>$projectid))</xar:set>
                            <xar:set name="firstproject">0</xar:set>
                            <xar:set name="errortype">xarCurrentErrorType()</xar:set>
                            
                            <xar:if condition="!$firstproject">
                                </fieldset>
                            </xar:if>
                            
                            <xar:if condition="!empty($errortype)">
                                <xar:set name="dummy">xarErrorFree()</xar:set>
                                <fieldset><legend><span class="xar-title">[project deleted]</span></legend>
                            <xar:else />
                                <fieldset><legend><span class="xar-title">#$projectinfo['project_name']#</span> [<a href="index.php?module=xproject&amp;type=admin&amp;func=display&amp;projectid=#$projectid#&amp;mode=worklog">view</a>]</legend>
                            </xar:if>
                            <xar:set name="rowclass">"xtasks-alt-row"</xar:set>
                            <xar:set name="prev_projectid">$projectid</xar:set>
                        </xar:if>
                    
                    
                        <xar:if condition="$rowclass eq 'xtasks-norm-row'">
                            <xar:set name="rowclass">"xtasks-alt-row"</xar:set>
                        <xar:else />
                            <xar:set name="rowclass">"xtasks-norm-row"</xar:set>
                        </xar:if>
                        
                        <xar:set name="dummy">$workhours['hours'] = sprintf("%.02f", $workhours['hours'])</xar:set>
                        
                        <div class="#$rowclass#">
                            <div class="xtasks-tasklist-data" style="float: left; width: 60px;"><xar:data-output property="$properties['eventdate']" value="$workdate" dateformat="%d-%b" />&nbsp;</div>
                            <div class="xtasks-tasklist-data" style="float: left; width: 120px;"><xar:data-output property="$properties['ownerid']" value="$ownerid" />&nbsp;</div>
                            <div class="xtasks-tasklist-data" style="float: left; width: 60px; text-align: right;"><xar:data-output property="$properties['hours']" value="$workhours['hours']" />&nbsp;hrs</div>
                            <div class="xtasks-tasklist-data" style="float: left; width: 60px; text-align: right;"><xar:data-output property="$properties['hours']" value="$workhours['ttltasks']" />&nbsp;tasks</div>
                            <div style="clear: both;"></div>
                        </div>
                    </xar:foreach>
                </xar:foreach>
            </xar:foreach>
        <xar:elseif condition="$reportview eq 'workdate:taskownerid:thisprojectid'" />
            <xar:foreach in="$worksummary" key="$projectid" value="$projectsummary">
                <xar:foreach in="$projectsummary" key="$ownerid" value="$staffhours">
                    <xar:foreach in="$staffhours" key="$workdate" value="$workhours">
                    
                        <xar:if condition="$projectid ne $prev_projectid or $firstproject">
                            <xar:set name="projectinfo">xarModAPIFunc('xproject','user','get',array('projectid'=>$projectid))</xar:set>
                            <xar:set name="firstproject">0</xar:set>
                            <xar:set name="errortype">xarCurrentErrorType()</xar:set>
                            
                            <xar:if condition="!$firstproject">
                                </fieldset>
                            </xar:if>
                            
                            <xar:if condition="!empty($errortype)">
                                <xar:set name="dummy">xarErrorFree()</xar:set>
                                <fieldset><legend><span class="xar-title">[project deleted]</span></legend>
                            <xar:else />
                                <fieldset><legend><span class="xar-title">#$projectinfo['project_name']#</span> [<a href="index.php?module=xproject&amp;type=admin&amp;func=display&amp;projectid=#$projectid#&amp;mode=worklog">view</a>]</legend>
                            </xar:if>
                            <xar:set name="rowclass">"xtasks-alt-row"</xar:set>
                            <xar:set name="prev_projectid">$projectid</xar:set>
                        </xar:if>
                    
                    
                        <xar:if condition="$rowclass eq 'xtasks-norm-row'">
                            <xar:set name="rowclass">"xtasks-alt-row"</xar:set>
                        <xar:else />
                            <xar:set name="rowclass">"xtasks-norm-row"</xar:set>
                        </xar:if>
                        
                        <xar:set name="dummy">$workhours['hours'] = sprintf("%.02f", $workhours['hours'])</xar:set>
                        
                        <div class="#$rowclass#">
                            <div class="xtasks-tasklist-data" style="float: left; width: 60px;"><xar:data-output property="$properties['eventdate']" value="$workdate" dateformat="%d-%b" />&nbsp;</div>
                            <div class="xtasks-tasklist-data" style="float: left; width: 120px;"><xar:data-output property="$properties['ownerid']" value="$ownerid" />&nbsp;</div>
                            <div class="xtasks-tasklist-data" style="float: left; width: 60px; text-align: right;"><xar:data-output property="$properties['hours']" value="$workhours['hours']" />&nbsp;hrs</div>
                            <div class="xtasks-tasklist-data" style="float: left; width: 60px; text-align: right;"><xar:data-output property="$properties['hours']" value="$workhours['ttltasks']" />&nbsp;tasks</div>
                            <div style="clear: both;"></div>
                        </div>
                    </xar:foreach>
                </xar:foreach>
            </xar:foreach>
        </xar:if>
    </div>
    <br />
</div>
<div class="xar-mod-foot"></div>