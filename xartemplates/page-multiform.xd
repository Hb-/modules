
<xar:comment>
    Default page for the 'multiform' page display.
</xar:comment>

<xar:set name="dummy">#xarTplSetPageTitle($current_page.desc)#</xar:set>

<xar:comment>Add an edit link if required.</xar:comment>
<xar:if condition="xarSecurityCheck('EditXarpagesPage', 0, 'Page', $current_page.name . ':' . $current_page.pagetype.name)">
    [<a href="#xarModURL('xarpages','admin','modifypage',array('pid'=>$pid,'return_url'=>xarServerGetCurrentURL(array(),false)))#">edit page</a>]
    <xar:if condition="!empty($multiform.formobject-&gt;objectid)">
        [<a href="#xarModURL('dynamicdata', 'admin', 'modifyprop', array('itemid'=&gt;$multiform.formobject-&gt;objectid,'return_url'=>xarServerGetCurrentURL(array(),false)))#">edit form</a>]
    </xar:if>
</xar:if>

<xar:if condition="empty($multiform)">
    <p class="xar-error">Configuration error: This page is missing the 'multiform' custom page function.
    Please add the page function and try again.</p>
<xar:else />
    <xar:comment>Display the history crumbtrail/progress bar</xar:comment>
    <xar:if condition="!empty($multiform.history)">
        <div class="xarpages-multiform-history">
            <xar:mlstring>Progress:</xar:mlstring>
            <xar:loop name="$multiform.history">
                <xar:if condition="!empty($pages[$loop:key]['dd']['menu_title'])">
                    <xar:set name="page_name">#$pages[$loop:key]['dd']['menu_title']#</xar:set>
                <xar:elseif condition="!empty($pages[$loop:key]['name'])" />
                    <xar:set name="page_name">#$pages[$loop:key]['name']#</xar:set>
                <xar:else />
                    <xar:set name="page_name">
                        <xar:ml>
                            <xar:mlstring>Page #(1)</xar:mlstring>
                            <xar:mlvar>#$loop:index + 1#</xar:mlvar>
                        </xar:ml>
                    </xar:set>
                </xar:if>
                <xar:if condition="$loop:index gt 0">&gt;</xar:if>
                <xar:if condition="!empty($loop:item.revisit) and $loop:key ne $current_page.pid">
                    <a href="#xarModURL('xarpages','user','display',array('pid'=&gt;$loop:key,$multiform.multiform_key_name=&gt;$multiform.multiform_key))#">#xarVarPrepForDisplay($page_name)#</a>
                <xar:else />
                    <span>#xarVarPrepForDisplay($page_name)#</span>
                </xar:if>
            </xar:loop>
        </div>
    </xar:if>

    <xar:comment>Display body content for the form. This could hold a title, introduction, hints etc.</xar:comment>
    <xar:if condition="isset($current_page.dd.body)">
        <div>#$current_page.dd.body#</div>
    </xar:if>

    <xar:comment>Display the main input form.</xar:comment>

    <form method="post" name="post" id="post" action="#xarModURL('xarpages','user','display',array('pid'=&gt;$current_page.pid))#" enctype='multipart/form-data'>
        <xar:comment>There may not be a form object - this could just be an information page in the sequence</xar:comment>
        <xar:if condition="!empty($multiform.formobject)">
            <div class="xarpages-multiform-input">
                <xar:if condition="!empty($multiform.formlayout)">
                    <xar:data-form object="$multiform['formobject']" layout="$multiform['formlayout']" />
                <xar:else />
                    <xar:data-form object="$multiform['formobject']" />
                </xar:if>

                <xar:if condition="!empty($multiform.multiform_key)">
                    <input type="hidden" name="#$multiform.multiform_key_name#" value="#$multiform.multiform_key#" />
                </xar:if>
                <div style="clear: both;"></div>
            </div>
        </xar:if>
        <div>
            <xar:if condition="!empty($multiform.prev_page_pid)">
                <input type="submit" name="multiform_submit_prev" value="#xarVarPrepForDisplay($multiform.submit_labels.prev)#" />
            </xar:if>
            <input type="submit" name="multiform_submit_cont" value="#xarVarPrepForDisplay($multiform.submit_labels.save)#" />
            <input type="submit" name="multiform_submit_next" value="#xarVarPrepForDisplay($multiform.submit_labels.next)#" />
            <a href="#xarModURL('xarpages','user','display',array('pid'=&gt;$current_page.pid,'multiform_cancel'=&gt;'true'))#"><xar:mlstring>Cancel</xar:mlstring></a>
        </div>
    </form>

    <xar:if condition="!empty($hooks)">
        <xar:foreach in="$hooks" key="$hookmodule">
            <xar:if condition="trim($hooks[$hookmodule]) ne ''">
                <div>#$hooks[$hookmodule]#</div>
            </xar:if>
        </xar:foreach>
    </xar:if>

</xar:if>
