<xar:if condition="!empty($catid)">
    <xar:categories-navigation layout="trails" showchildren="1" module="helpdesk" itemtype="10" catid="$catid" showcatcount="0" showempty="1" selection="$selection" />
<xar:else />
    <div class="xar-mod-head">
        <span class="xar-mod-title">
        <xar:ml>
            <xar:mlstring>#(1) - View Ticket</xar:mlstring>
            <xar:mlvar>#xarModGetDisplayableName('helpdesk')#</xar:mlvar>
        </xar:ml>
        </span>
    </div>
    <br />
   <xar:categories-navigation layout="trails" showchildren="1" module="helpdesk" itemtype="10" catid="0" showcatcount="0" showempty="1" />
</xar:if>

<div class="xar-mod-body">
<xar:if condition="isset($menu)"><xar:var name="menu" /></xar:if>
<div class="tborder">

<xar:if condition="$UserLoggedIn">

<xar:if condition="!empty($selection) and !empty($sortorder) and !empty($status)">

    <form action="#xarModURL('helpdesk', 'user', 'view')#" name="options" method="post">
    <input type="hidden" name="selection" value="#$selection#" />
    <input type="hidden" name="sortorder" value="#$sortorder#" />
    <xar:if condition="!empty($catid)">
    <input type="hidden" name="catid" value="#$catid#" />
    </xar:if>

<div class="xar-norm-outline">
    <table style="width: 100%; text-align: center;">
        <tr>
            <th><xar:mlstring>Status</xar:mlstring></th>
            <th><xar:mlstring>Sort Order</xar:mlstring></th>
            <th><xar:mlstring>Filters</xar:mlstring></th>
        </tr>
        <tr>
            <td style="padding: 5px;">
                <select name="statusfilter" onChange="javascript:document.options.submit();">
                <option value=""></option>
                <xar:loop name="$status">
                    <xar:if condition="$statusfilter eq $loop:item['id']">
                    <option value="#$loop:item['id']#" selected="selected">#$loop:item['status']#</option>
                    <xar:else />
                    <option value="#$loop:item['id']#">#$loop:item['status']#</option>
                    </xar:if>
                </xar:loop>
                </select>
            </td>
            <td>
                <xar:if condition="$order eq 'ASC'">
                <xar:mlstring>Ascending Order:</xar:mlstring> <input type="radio" name="order" value="ASC" checked="checked" onChange="javascript:document.options.submit();" />
                <xar:mlstring>Descending Order:</xar:mlstring> <input type="radio" name="order" value="DESC" onChange="javascript:document.options.submit();" />
                <xar:else />
                <xar:mlstring>Ascending Order:</xar:mlstring> <input type="radio" name="order" value="ASC" onChange="javascript:document.options.submit();" />
                <xar:mlstring>Descending Order:</xar:mlstring> <input type="radio" name="order" value="DESC" checked="checked" onChange="javascript:document.options.submit();" />
                </xar:if>
            </td>
            <td>
                <select name="selection" onChange="javascript:document.options.submit();">

                <xar:if condition="!empty($selection)">
                <option value="#$selection#">#$selections[$selection]#</option>
                <xar:else />
                <option value=""></option>
                </xar:if>

                <option value="">-------------</option>
                <option value="MYALL"><xar:mlstring>My Tickets</xar:mlstring></option>

                <xar:if condition="xarSecurityCheck('edithelpdesk',0) and xarModGetVar('helpdesk', 'Techs see all tickets')">
                <option value="MYOPEN"><xar:mlstring>My Open Tickets</xar:mlstring></option>
                </xar:if>

                <xar:if condition="xarSecurityCheck('edithelpdesk',0) and xarModGetVar('helpdesk', 'Techs see all tickets')">
                <option value="ALL"><xar:mlstring>All Tickets</xar:mlstring></option>
                </xar:if>

                <xar:if condition="xarSecurityCheck('edithelpdesk',0) and xarModGetVar('helpdesk', 'Techs see all tickets')">
                <option value="MYASSIGNEDALL"><xar:mlstring>My Assigned Tickets</xar:mlstring></option>
                </xar:if>

                <xar:if condition="xarSecurityCheck('edithelpdesk',0) and xarModGetVar('helpdesk', 'Techs see all tickets')">
                <option value="UNASSIGNED"><xar:mlstring>All Unassigned Tickets</xar:mlstring></option>
                </xar:if>

                </select>
            </td>
        </tr>
    </table>
    </form>
</div>
</xar:if>

<br />
<table border="0" width="100%" class="xar-norm-outline" cellspacing="1" cellpadding="2">
    <tr style="text-align: center;">
        <th colspan="12" class="xar-norm-outline">
            #xarSessionGetVar('ResultTitle')#
        </th>
    </tr>
    <tr style="text-align: center;">
        <th class="xar-norm-outline">
            <a href="#xarModURL('helpdesk', 'user', 'view', array('sortorder' => 'TICKET_ID', 'order' => $order, 'selection' => $selection, 'statusfilter' => $statusfilter))#">
            <xar:mlstring>Ticket</xar:mlstring>#
            </a>
        </th>
        <th class="xar-norm-outline">
            <a href="#xarModURL('helpdesk', 'user', 'view', array('sortorder' => 'SUBJECT', 'order' => $order, 'selection' => $selection, 'statusfilter' => $statusfilter))#">
            <xar:mlstring>Subject</xar:mlstring>
            </a>
        </th>
        <xar:if condition="$showstatusinsummary">
        <th class="xar-norm-outline">
            <a href="#xarModURL('helpdesk', 'user', 'view', array('sortorder' => 'STATUS', 'order' => $order, 'selection' => $selection, 'statusfilter' => $statusfilter))#">
            <xar:mlstring>Status</xar:mlstring>
            </a>
        </th>
        </xar:if>
        <xar:if condition="$showpriorityinsummary">
        <th class="xar-norm-outline">
            <a href="#xarModURL('helpdesk', 'user', 'view', array('sortorder' => 'PRIORITY', 'order' => $order, 'selection' => $selection, 'statusfilter' => $statusfilter))#">
            <xar:mlstring>Priority</xar:mlstring>
            </a>
        </th>
        </xar:if>
        <xar:if condition="$showopenbyinsummary">
        <th class="xar-norm-outline">
            <a href="#xarModURL('helpdesk', 'user', 'view', array('sortorder' => 'OPENEDBY', 'order' => $order, 'selection' => $selection, 'statusfilter' => $statusfilter))#">
            <xar:mlstring>Opened by</xar:mlstring>
            </a>
        </th>
        </xar:if>
        <xar:if condition="$showassignedtoinsummary">
        <th class="xar-norm-outline">
            <a href="#xarModURL('helpdesk', 'user', 'view', array('sortorder' => 'ASSIGNEDTO', 'order' => $order, 'selection' => $selection, 'statusfilter' => $statusfilter))#">
            <xar:mlstring>Assigned to</xar:mlstring>
            </a>
        </th>
        </xar:if>
        <xar:if condition="$showclosedbyinsummary">
        <th class="xar-norm-outline">
            <a href="#xarModURL('helpdesk', 'user', 'view', array('sortorder' => 'CLOSEDBY', 'order' => $order, 'selection' => $selection, 'statusfilter' => $statusfilter))#">
            <xar:mlstring>Closed by</xar:mlstring>
            </a>
        </th>
        </xar:if>
        <xar:if condition="$showdateenteredinsummary">
        <th class="xar-norm-outline">
            <a href="#xarModURL('helpdesk', 'user', 'view', array('sortorder' => 'DATE', 'order' => $order, 'selection' => $selection, 'statusfilter' => $statusfilter))#">
            <xar:mlstring>Date Entered</xar:mlstring>
            </a>
        </th>
        </xar:if>
        <xar:if condition="$showlastmodifiedinsummary">
        <th class="xar-norm-outline">
            <a href="#xarModURL('helpdesk', 'user', 'view', array('sortorder' => 'DATEUPDATED', 'order' => $order, 'selection' => $selection, 'statusfilter' => $statusfilter))#">
            <xar:mlstring>Last Modified</xar:mlstring>
            </a>
        </th>
        </xar:if>
    </tr>

    <!-- Cycle through the array, creating each row of the table
         Fields to show: Ticket Number/Date/Subject/Status/Last Update -->
    <xar:set name="$class">'xar-norm'</xar:set>
    <xar:if condition="empty($mytickets_data)">
    <tr><td colspan="10"><xar:mlstring>There are no tickets!</xar:mlstring></td></tr>
    </xar:if>
    <xar:foreach in="$mytickets_data" value="$ticket">
        <xar:set name="$ticket_id">$ticket['ticket_id']</xar:set>
        <tr class="#$class#">
            <td><a href="#xarModURL('helpdesk', 'user', 'display', array('tid' => $ticket_id, 'uid' => $userid, 'authkey' => xarSecGenAuthKey()))#" title="View Ticket">#$ticket_id#</a>&nbsp;</td>
            <td><a href="#xarModURL('helpdesk', 'user', 'display', array('tid' => $ticket_id, 'uid' => $userid, 'authkey' => xarSecGenAuthKey()))#" title="View Ticket">#$ticket['subject']#</a>&nbsp;</td>
            <xar:if condition="$showstatusinsummary">
            <td>#$ticket['status']#</td>
            </xar:if>
            <xar:if condition="$showpriorityinsummary">
            <td style="background-color: ###$ticket['priority']['color']#;">#$ticket['priority']['priority']#</td>
            </xar:if>
            <xar:if condition="$showopenbyinsummary">
            <td><a href="#xarModURL('roles', 'user', 'display', array('uid' => $ticket['openedby']))#">#xarUserGetVar('name', $ticket['openedby'])#</a></td>
            </xar:if>
            <xar:if condition="$showassignedtoinsummary">
            <td>
            <xar:if condition="$ticket['assignedto'] gt 0">
                <a href="#xarModURL('roles', 'user', 'display', array('uid' => $ticket['assignedto']))#">#xarUserGetVar('name', $ticket['assignedto'])#</a>
            </xar:if>
            </td>
            </xar:if>
            <xar:if condition="$showclosedbyinsummary">
            <td>
            <xar:if condition="$ticket['closedby'] gt 0">
                <a href="#xarModURL('roles', 'user', 'display', array('uid' => $ticket['closedby']))#">#xarUserGetVar('name', $ticket['closedby'])#</a>
            </xar:if>
            </td>
            </xar:if>

            <xar:if condition="$showdateenteredinsummary">
            <td>#$ticket['ticketdate']#</td>
            </xar:if>

            <xar:if condition="$showlastmodifiedinsummary">
            <td>#$ticket['lastupdate']#</td>
            </xar:if>
        </tr>
        </form>
        <xar:if condition="$class eq 'xar-norm'">
            <xar:set name="$class">'xar-accent'</xar:set>
        <xar:else />
            <xar:set name="$class">'xar-norm'</xar:set>
        </xar:if>
    </xar:foreach>
</table>
<div style="text-align: center;">#$pager#</div>
<xar:else />
    <h3><xar:mlstring>Not logged in</xar:mlstring>!</h3>
    <xar:mlstring>Sorry, this feature is not available for anonymous users. Please login and try again.</xar:mlstring>
</xar:if>

</div>
<br />
<xar:if condition="!empty($summary)">
    #$summary#
</xar:if>
</div>
