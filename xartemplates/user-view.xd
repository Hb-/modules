<div class="xar-mod-head">
  <span class="xar-mod-title"><xar:mlstring>Tasks lists</xar:mlstring></span>
</div>

<table border="0" width="100%">
  <tr>
    <td align=center>
      <a href="&xar-modurl-tasks-user-view;"><xar:mlstring>View tasks</xar:mlstring></a> | 
      <a href="&xar-modurl-tasks-admin-new;"><xar:mlstring>New task</xar:mlstring></a>
    </td>
  </tr>
</table>

<!-- Filter form -->
<form action="#$filterformtarget#" method="post" enctype="application/x-www-form-urlencoded">
    <input type="hidden" name="id" id="id" value="#$parentid#" />
    <input type="hidden" name="modname" id="modname" value="#$modname#" />
    <input type="hidden" name="objectid" id="objectid" value="#$objectid#" />

    <xar:set name="$options">xarModAPIFunc('tasks','user','getdepthoptions')</xar:set>
    <xar:data-input type="dropdown" name="displaydepth" tabindex="1" options="$options" value="$maxdepth" />

    <xar:set name="$options">xarModAPIFunc('tasks','user','getfilteroptions')</xar:set>
    <xar:data-input type="dropdown" name="filter" tabindex="2" options="$options" value="$filter" />
    <input type="submit" value="#$filtersubmit#"  tabindex="3" />
</form>

<!-- Migrate form -->
<form action="&xar-modurl-tasks-admin-migrate;" method="post" enctype="application/x-www-form-urlencoded">
  <input type="hidden" name="parentid" id="parentid" value="#$parentid#" />
  <input type="hidden" name="modname" id="modname" value="#$modname#" />
  <input type="hidden" name="objectid" id="objectid" value="#$objectid#" />
  <table style="border: none; width: 100%">
    <tr><th style="text-align: center;"><xar:mlstring>Tasks</xar:mlstring></th></tr>
    <tr><td>
      <table style="border: 1px; width: 100%">
        <tr>
          <th style="text-align: left;"><xar:mlstring>Tasks</xar:mlstring></th>
          <th style="text-align: left;"><xar:mlstring>Description</xar:mlstring></th>
          <th style="text-align: center;"><xar:mlstring>?</xar:mlstring></th>
          <th style="text-align: center;"><xar:mlstring>!</xar:mlstring></th>
          <th style="text-align: center;"><xar:mlstring>X</xar:mlstring></th>
          <th style="text-align: center;"><xar:mlstring>X/%</xar:mlstring></th>
          <th style="text-align: center;"><xar:mlstring>Options</xar:mlstring></th>
        </tr>
        <xar:loop name="$tasks">
          <!-- TODO: base background color on depth -->
          <xar:set name="$task">#$loop:item#</xar:set>
          <xar:template file="taskrow" subdata="array('task' =&gt; $task, 'options' =&gt; $options)" />
        </xar:loop>
        <tr>
          <td colspan="6" align="right">
            <xar:mlstring>Selected tasks</xar:mlstring>
              <select name="taskoption" id="taskoption" size="1" tabindex="4">
                <xar:loop name="$taskoptions">
                  <option value="#$loop:item['id']#" selected="selected">#$loop:item['name']#</option>
                </xar:loop>
              </select>
            <input type="submit" value="#$tasksubmitbutton#"  tabindex="5" />
          </td>
        </tr>
      </table>
    </td>
  </tr>
</table>
</form>