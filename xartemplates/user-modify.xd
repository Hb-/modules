<xar:comment> License: GPL http://www.gnu.org/copyleft/gpl.html </xar:comment>

<!-- This Javascript will check for required fields before the form is submitted. -->
<xar:base-include-javascript module="base" filename="formcheck.js" position="head" />
<script type="text/javascript">
<!--
    // Enter name of mandatory fields
    var fieldRequired = Array("name");
    // Enter field description to appear in the dialog box
    var fieldDescription = Array("Name");
//-->
</script>
<div class="xar-mod-head">
    <span class="xar-mod-title"><xar:mlstring>Individual training and supervision plan</xar:mlstring></span>
</div>
<div class="xar-mod-body">

    <xar:if condition="xarSessionGetVar('statusmsg') ne ''">
        <p>#xarSessionGetVar('statusmsg')#</p>
    </xar:if>
    <!-- the variables used in this menu templte come from itsp_user_menu() -->
    <xar:template type="module" file="user-menu" />

    <form method="post" action="&xar-modurl-itsp-user-update;"
          onsubmit="return xar_base_formCheck(this, fieldRequired, fieldDescription);">
        <fieldset>
            <legend><xar:mlstring>Information</xar:mlstring></legend>
            <div class="xar-form-input-wrapper">
                 <label for="pitemname" class="xar-form-label" title="#xarML('Name of this item')#">
                      <xar:mlstring>Name:</xar:mlstring>
                 </label>
                 #$pitem.pitemname#
            </div>
            <div class="xar-form-input-wrapper">
                 <label for="pitemdesc" class="xar-form-label" title="#xarML('Rules and the description')#">
                      <xar:mlstring>Description:</xar:mlstring>
                 </label>
                 #$pitem.pitemdesc#
            </div>
            <div class="xar-form-input-wrapper">
                 <label for="mincredit" class="xar-form-label" title="#xarML('The minimum amount of credits you need to pass this item')#">
                      <xar:mlstring>Minimum credits required:</xar:mlstring>
                 </label>
                 #$pitem.mincredit#
            </div>
            <div class="xar-form-input-wrapper">
                 <label for="creditsnow" class="xar-form-label" title="#xarML('The amount of credits you have entered into your ITSP')#">
                      <xar:mlstring>Credits entered:</xar:mlstring>
                 </label>
                 <xar:if condition="($creditsnow lt $pitem.mincredit) AND $pitem.mincredit gt 0">
                    <span style="color:red">
                        <xar:ml>
                            <xar:mlstring>#(1) = Less than required!</xar:mlstring>
                            <xar:mlvar>#$creditsnow#</xar:mlvar>
                        </xar:ml>
                    </span>
                 <xar:else />
                    #$creditsnow#
                 </xar:if>
            </div>
        </fieldset>

        <xar:comment>Include the template here that will add all fields
        The template name begins with modify- and has a suffix of the source for the courses.
        These included templates are located at /xartemplates/includes/
        The template will only be included when the student can be changes.</xar:comment>

            <xar:template type="module" file="modify-$rule_source" />


        <xar:if condition="$canedit">
            <fieldset>
                <div class="xar-form-input-wrapper-after">
                    <input type="hidden" name="authid" id="authid" value="#$authid#" />
                    <input type="hidden" name="itspid" id="itspid" value="#$itspid#" />
                    <input type="hidden" name="pitemid" id="pitemid" value="#$pitemid#" />
                    <xar:if condition="empty($icourseid)">
                        <input type="submit" value="#xarML('Add')#" />
                    <xar:else />
                        <input type="hidden" name="icourseid" id="icourseid" value="#$icourseid#" />
                        <input type="submit" value="#xarML('Update')#" />
                    </xar:if>
                </div>
            </fieldset>
        </xar:if>
    </form>

    <xar:if condition="!empty($hookoutput)">
        <fieldset>
            <legend><xar:mlstring>Hooked content</xar:mlstring></legend>
                <xar:foreach in="$hookoutput" key="$hookmodule">
                   #$hookoutput[$hookmodule]#
                </xar:foreach>
        </fieldset>
    </xar:if>
</div>
<xar:if condition="xarSessionSetVar('statusmsg', '')"></xar:if>
