
<xar:comment>
    TODO: The CSS loaded will depend on what kind of menu you want.
    The CSS script should match the class of the wrapper div for the menu,
    both of which should be selectable from the block admin page.
    At the moment they are hard-coded here.
    In addition, this stylesheet link will probably have to be linked directly
    from your page template, until setting stylesheets from blocks is supported.
</xar:comment>
<xar:set name="dummy">xarTplAddStyleLink('xarpages', 'block_side_menu1', 'php')</xar:set>

<xar:comment>
    This simple menu template formats the pages tree into a nested-list menu.
    Required paramaters are:
        $pages - the list of all pages needed to build the menu
        $root_page - the root page (can be reference into $pages) that defines
            the root of the menu tree
    If the root page is 'empty' then don't display it - go straight for the next level.
    An empty root page creates a multi-homed menu, while a non-empty root page creates
    a single-homed menu.

    Menu titles can be set with a DD field on each page called 'menu_title'.
</xar:comment>

<xar:set name="dummy">xarTplAddStyleLink('xarpages', 'block-side-menu1')</xar:set>


<div class="xarpages-side-menu1">
<xar:if condition="!empty($multi_homed)">
    <xar:set name="menu_level">0</xar:set>
    <xar:template file="menu-css-side-menu1" subdata="array('parent'=&gt;$root_page,'pages'=&gt;$pages,'root_depth'=&gt;$root_page.depth+1,'menu_level'=&gt;$menu_level)" />
<xar:else />
    <xar:comment>
        FIXME: this is a lot of duplication from the sub-template.
        Better to take a step back and start with the root page as the child of a 'root root'.
    </xar:comment>
    <xar:set name="menu_level">1</xar:set>
    <ul class="side-menu#$menu_level#">
        <li class="open">
            <xar:if condition="$root_page.status eq 'EMPTY'">
                <h2><xar:if condition="!empty($root_page.dd.menu_title)">
                    #xarVarPrepForDisplay($root_page.dd.menu_title)#
                <xar:else />
                    #$root_page.name#
                </xar:if></h2>
            <xar:else />
                <a class="open" href="#xarModURL('xarpages','user','display',array('pid'=&gt;$root_page.pid))#" title="#xarVarPrepForDisplay($root_page.desc)#">
                    <xar:if condition="!empty($root_page.dd.menu_title)">
                        #xarVarPrepForDisplay($root_page.dd.menu_title)#
                    <xar:else />
                        #$root_page.name#
                    </xar:if>
                </a>
            </xar:if>

            <xar:template file="menu-css-side-menu1" subdata="array('parent'=&gt;$root_page,'pages'=&gt;$pages,'root_depth'=&gt;$root_page.depth+1,'menu_level'=&gt;$menu_level)" />
        </li>
    </ul>
</xar:if>
</div>
