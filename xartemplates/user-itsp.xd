<xar:comment> License: GPL http://www.gnu.org/copyleft/gpl.html </xar:comment>
<!-- common user menu for this module - remove link to the current function -->
<div class="xar-mod-head">
    <span class="xar-mod-title"><xar:mlstring>Individual Training and Supervision Plan</xar:mlstring></span>
</div>
<div class="xar-mod-body">

    <!-- the variables used in this menu template come from itsp_user_menu() -->
    <xar:template type="module" file="user-menu" />

    <h2><xar:mlstring>My ITSP</xar:mlstring></h2>
    <xar:if condition="xarSessionGetVar('statusmsg') ne ''">
        <p>#xarSessionGetVar('statusmsg')#</p>
    </xar:if>
    <p>
    <xar:ml>
        <xar:mlstring>Welcome #(1)</xar:mlstring>
        <xar:mlvar>#xarUserGetVar('name')#</xar:mlvar>
    </xar:ml>
    </p>
    <p>
        <xar:mlstring>A summary of your ITSP is shown below. If you have added enough credits,
        then you will be able to submit the ITSP.</xar:mlstring>
    </p>
    <xar:comment> Show the plan details, coming from $plan</xar:comment>
    <xar:if condition="empty($plan)">
        <strong><xar:mlstring>Please choose an education plan first</xar:mlstring>&nbsp;
        <a href="#xarModUrl('itsp','user','view')#"><xar:mlstring>here</xar:mlstring></a>
        </strong>
    <xar:else />
        <form>
            <fieldset>
                <legend><xar:mlstring>Information</xar:mlstring></legend>
                <div class="xar-form-input-wrapper">
                     <label for="planname" class="xar-form-label" title="#xarML('Name of the plan')#">
                          <xar:mlstring>Name:</xar:mlstring>
                     </label>
                     #$plan.planname#
                </div>
                <div class="xar-form-input-wrapper">
                     <label for="plandesc" class="xar-form-label" title="#xarML('Name of the plan')#">
                          <xar:mlstring>Description:</xar:mlstring>
                     </label>
                     #$plan.plandesc#
                </div>
                <div class="xar-form-input-wrapper">
                     <label for="planitems" class="xar-form-label" title="#xarML('Name of the plan')#">
                          <xar:mlstring>The sections:</xar:mlstring>
                     </label>

                    <table>
                        <thead>
                            <tr>
                                <th><xar:mlstring>Section</xar:mlstring></th>
                                <th><xar:mlstring>Needed</xar:mlstring></th>
                                <th><xar:mlstring>Planned</xar:mlstring></th>
                                <th><xar:mlstring>Passed</xar:mlstring></th>
                            </tr>
                        </thead>
                        <xar:foreach in="$pitems" value="$item">
                        <tr>
                            <td>
                                 <a href="#xarModURL('itsp','user','modify',array('pitemid'=>$item['pitemid'],'itspid'=>$itspid))#">#$item.pitemname#</a>
                            </td>
                            <td>
                                 #$item.mincredit#
                            </td>
                            <td>
                                 #$item.creditsnow#
                            </td>
                        </tr>
                        </xar:foreach>
                        <tr>
                            <td>
                            Credits needed
                            </td>
                            <td>
                            #$plan.mincredit#
                            </td>
                            <td>
                            <xar:if condition="$sumcreditsnow lt $plan.mincredit">
                            <span style="color:red">#$sumcreditsnow#&nbsp;</span>
                            <xar:else />
                            #$sumcreditsnow#
                            </xar:if>
                            </td>
                            <td>
                            &nbsp;
                            </td>
                    </table>
                </div>
            </fieldset>
        </form>
    </xar:if>
    <!-- if you want to extend this module with dynamic data, you can retrieve
    //   that data in the code via APIs, or use e.g. the following BL tags here.
    //   For the different options, see the overview of dynamicdata...
    -->
    <xar:if condition="xarModIsHooked('dynamicdata')">
        <!-- 1. retrieve any dynamic properties defined for this object -->
        <xar:data-getitem name="$properties" module="itsp" itemid="$itspid" />
        <!-- 2. for each property, display its label and value in output format -->
        <xar:if condition="isset($properties) and count($properties) gt 0">
            <xar:foreach in="$properties" key="$name">
                      <xar:data-label property="$properties[$name]" />:
                    <xar:data-output property="$properties[$name]" />
            </xar:foreach>
        </xar:if>
    </xar:if>

    <!-- add the output from the different display hooks here -->
    <xar:if condition="!empty($hookoutput)">
        <xar:foreach in="$hookoutput" key="$hookmodule">
            #$hookoutput[$hookmodule]#
        </xar:foreach>
    </xar:if>
</div>

<h3><xar:mlstring>Submit your ITSP</xar:mlstring></h3>



<xar:if condition="xarSessionSetVar('statusmsg', '')"></xar:if>
