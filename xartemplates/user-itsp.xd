<xar:comment> License: GPL http://www.gnu.org/copyleft/gpl.html </xar:comment>

<xar:if condition="$fulldetails eq 1">
    <xar:set name="items">#$fullitems#</xar:set>
<xar:else />
    <xar:set name="items">#$pitems#</xar:set>
</xar:if>

<div class="xar-mod-head">
    <span class="xar-mod-title"><xar:mlstring>Individual Training and Supervision Plan</xar:mlstring></span>
</div>
<div class="xar-mod-body">

    <xar:template type="module" file="user-menu" />

    <h2><xar:mlstring>My ITSP</xar:mlstring></h2>
    <xar:if condition="xarSessionGetVar('statusmsg') ne ''">
        <p>#xarSessionGetVar('statusmsg')#</p>
    </xar:if>
    <p><em><xar:mlstring>Status of the ITSP: </xar:mlstring> #$statusname#</em></p>
    <br />
    <p>
    <xar:ml>
        <xar:mlstring>Welcome #(1)</xar:mlstring>
        <xar:mlvar>#xarUserGetVar('name')#</xar:mlvar>
    </xar:ml>
    </p>

    <p>
        <xar:mlstring>A summary of your ITSP is shown below. If you have added enough credits,
        then you will be able to submit the ITSP.</xar:mlstring>
    </p>
    <xar:comment> Show the plan details, coming from $plan</xar:comment>
    <xar:if condition="empty($plan)">
        <strong><xar:mlstring>Please choose an education plan first</xar:mlstring>&nbsp;
        <a href="#xarModUrl('itsp','user','view')#"><xar:mlstring>here</xar:mlstring></a>
        </strong>
    <xar:else />
        <form method="post" action="&xar-modurl-itsp-user-itsp;">
            <input type="hidden" name="authid" id="authid" value="#$authid#" />
            <input type="hidden" name="itspid" id="itspid" value="#$itspid#" />
            <input type="hidden" name="return_url" id="return_url" value="#xarModUrl('itsp','user','itsp')#" />
            <xar:if condition="$fulldetails eq 0 ">
              <input type="hidden" name="showdetails" id="showdetails" value="1" />
              <input type="submit" value="#xarML('Show details')#" />
              <xar:else/>
              <input type="hidden" name="showdetails" id="showdetails" value="0" />
              <input type="submit" value="#xarML('Show summary')#" />
            </xar:if>
        </form>

        <form method="post" action="&xar-modurl-itsp-user-submit;">
            <fieldset>
                <legend><xar:mlstring>Information</xar:mlstring></legend>
                <div class="xar-form-input-wrapper">
                     <label for="planname" class="xar-form-label" title="#xarML('Name of the plan')#">
                          <xar:mlstring>Name:</xar:mlstring>
                     </label>
                     #$plan.planname#
                </div>
                <div class="xar-form-input-wrapper">
                     <label for="plandesc" class="xar-form-label" title="#xarML('Name of the plan')#">
                          <xar:mlstring>Description:</xar:mlstring>
                     </label>
                     #$plan.plandesc#
                </div>
               <div class="xar-form-input-wrapper">
                    <table>
                        <thead>
                            <tr>
                                <th><xar:mlstring>Section</xar:mlstring></th>
                                <th><xar:mlstring>Needed</xar:mlstring></th>
                                <th><xar:mlstring>Planned</xar:mlstring></th>
                                <th><xar:mlstring>Obtained</xar:mlstring></th>
                            </tr>
                        </thead>
                        <xar:foreach in="$items" value="$item">
                            <tr>
                                <td>
                                     <a href="#xarModURL('itsp','user','modify',array('pitemid'=>$item['pitemid'],'itspid'=>$itspid))#">#$item.pitemname#</a>

                                </td>

                                     <xar:if condition="$fulldetails eq 1 AND !empty($item.courses)">
                                     <td style="border: 0px">&nbsp;</td>
                                     <td style="border: 0px">&nbsp;</td>
                                     <td style="border: 0px">&nbsp;</td>

                                     </tr>
                                        <xar:foreach in="$item.courses" value="$course">
<tr style="border: 0px"><td style="border: 0px">
                                            #$course.number# #$course.title# </td><td style="border: 0px">&nbsp;</td><td  style="border: 0px">#$course.credits#</td><td  style="border: 0px">&nbsp;</td>
                                            </tr>

                                        </xar:foreach>
                                        <tr>
                                        <td>&nbsp;</td>
                                     </xar:if>

                                <td>
                                     <strong>#$item.mincredit#</strong>
                                </td>
                                <td>
                                     <strong>#$item.creditsnow#</strong>
                                </td>
                                <td >
                                &nbsp;
                                </td>
                            </tr>
                                     </xar:foreach>
                        <tr>
                            <td>
                            <xar:mlstring>Totals</xar:mlstring>
                            </td>
                            <td>
                            <strong>#$plan.mincredit#</strong>
                            </td>
                            <td>
                            <xar:if condition="$sumcreditsnow lt $plan.mincredit">
                            <span style="color:red">#$sumcreditsnow#&nbsp;</span>
                            <xar:else />
                            <span style="color:red"><strong>#$sumcreditsnow#</strong></span>
                            </xar:if>
                            </td>
                            <td>
                            &nbsp;
                            </td>
                        </tr>
                    </table>
                </div>
            </fieldset>
            <!-- add the output from the different display hooks here -->
            <xar:if condition="!empty($hookoutput)">
            <fieldset>
                <xar:foreach in="$hookoutput" key="$hookmodule">
                    #$hookoutput[$hookmodule]#
                </xar:foreach>
            </fieldset>
            </xar:if>

            <xar:if condition="$itspstatus lt 4">
                <xar:if condition="($sumcreditsnow eq $plan.mincredit) OR ($sumcreditsnow gt $plan.mincredit)" >
                    <p><xar:mlstring>Currently, your ITSP has not been submitted yet to the Education Desk. Submitting your ITSP means that it will be sent to the
                    Education Desk and be reviewed for approval. You cannot make any changes to it during this review stage.</xar:mlstring><br />

                    <fieldset>
                        <legend><xar:mlstring>Submit your ITSP</xar:mlstring></legend>
                        <div class="xar-form-input-wrapper-after">
                        <xar:mlstring>Press this button if you want to submit your ITSP. The ITSP will be locked untill it is approved</xar:mlstring><br />
                            <input type="hidden" name="authid" id="authid" value="#$authid#" />
                            <input type="hidden" name="itspid" id="itspid" value="#$itspid#" />
                            <input type="hidden" name="newstatus" id="newstatus" value="4" />
                            <input type="hidden" name="return_url" id="return_url" value="#xarModUrl('itsp','user','itsp')#" />
                            <input type="submit" value="#xarML('Submit')#" />
                        </div>
                    </fieldset>
                <xar:else />
                    <p><xar:mlstring>You have not added enough credits yet. Please add courses and/or activities to your ITSP. When you have added enough credits, you will be able to submit your ITSP.</xar:mlstring></p>
                </xar:if>
            <xar:elseif condition="$itspstatus eq 4" />
                <p><xar:mlstring> You have submitted your ITSP. You can not make changes to it untill it has been approved.</xar:mlstring></p>
            </xar:if>
        </form>
    </xar:if>
    <!-- if you want to extend this module with dynamic data, you can retrieve
    //   that data in the code via APIs, or use e.g. the following BL tags here.
    //   For the different options, see the overview of dynamicdata...
    -->
    <xar:if condition="xarModIsHooked('dynamicdata')">
        <!-- 1. retrieve any dynamic properties defined for this object -->
        <xar:data-getitem name="$properties" module="itsp" itemid="$itspid" />
        <!-- 2. for each property, display its label and value in output format -->
        <xar:if condition="isset($properties) and count($properties) gt 0">
            <xar:foreach in="$properties" key="$name">
                      <xar:data-label property="$properties[$name]" />:
                    <xar:data-output property="$properties[$name]" />
            </xar:foreach>
        </xar:if>
    </xar:if>
</div>

<xar:if condition="xarSessionSetVar('statusmsg', '')"></xar:if>
