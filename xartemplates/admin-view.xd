<div class="xar-mod-head">
    <span class="xar-mod-title">
        <xar:mlstring>File Administration</xar:mlstring>
    </span>
</div>
<div class="xar-mod-body">
    <h2><xar:mlstring>View Files</xar:mlstring></h2>
    <br />
    <div style="margin: auto;">
        <xar:if condition="isset($diskUsage)">
            <table summary="Files" width="100%" border="0" cellpadding="2" cellspacing="1" class="xar-accent xar-accent-outline">
                <tr>
                    <th><xar:mlstring>Physical Device Space</xar:mlstring></th>
                    <th><xar:mlstring>Stored File Size Usage</xar:mlstring></th>
                    <th><xar:mlstring>Number of Files</xar:mlstring></th>
                </tr>
                <tr>
                    <td class="xar-norm" align="center"><xar:mlstring>Total / Used / Free</xar:mlstring></td>
                    <td class="xar-norm" align="center"><xar:mlstring>current view / stored total</xar:mlstring></td>
                    <td class="xar-norm" align="center"><xar:mlstring>current view / stored total</xar:mlstring></td>
                </tr>  
                <tr>
                    <td class="xar-norm" align="center">
                        #$diskUsage['device_total']['short']# / #$diskUsage['device_used']['short']# / #$diskUsage['device_free']['short']#
                    </td>
                    <td class="xar-norm" align="center">
                        #$diskUsage['stored_size_filtered']['short']# / #$diskUsage['stored_size_total']['short']#
                    </td>
                    <td class="xar-norm" align="center">
                        #$diskUsage['numfiles_filtered']# / #$diskUsage['numfiles_total']# 
                    </td>
                </tr>
            </table>

            <br />                    
        </xar:if>        
        <xar:template file="filter_bar" type="module" />
        
        <xar:base-include-javascript filename="openDialog.js" />
        
        <form action="#xarModUrl('filemanager','admin','view')#" method="post">
        
        <table summary="Files" width="100%" border="0" cellpadding="2" cellspacing="1" class="xar-accent xar-accent-outline">
            <tr>
                <th><xar:mlstring>Select</xar:mlstring></th>
                <th><xar:mlstring>File Name</xar:mlstring></th>
                <th><xar:mlstring>Uploaded By</xar:mlstring></th>
                <th><xar:mlstring>Status</xar:mlstring></th>
            </tr>   
            <xar:if condition="count($items)">
                <xar:loop name="$items">
                    <xar:if condition="(($loop:index + 1) % 2)">
                        <tr>
                            <td class="xar-norm" align="center">
                                <input type="checkbox" name="fileId[]" id="fileId_#$loop:item['fileId']#" value="#$loop:item['fileId']#"/>
                            </td>
                            <td class="xar-norm" align="center">&nbsp;
                                <a style="cursor: pointer;" onclick="PropertiesDialog('#xarModURL('filemanager', 'fs', 'properties', array('fileId' => $loop:item['fileId']))#'); return false;">
                                    #$loop:item['fileName']#
                                </a>
                            </td>
                            <td class="xar-norm" align="center">&nbsp;#$loop:item['userName']#</td>
                            <td class="xar-norm" align="center">&nbsp;#$loop:item['fileStatusName']#</td>
                        </tr>
                    <xar:else />
                        <tr>
                            <td class="xar-accent" align="center">
                                <input type="checkbox" name="fileId[]" id="fileId_#$loop:item['fileId']#" value="#$loop:item['fileId']#"/>
                            </td>
                            <td class="xar-accent" align="center">&nbsp;
                                <a style="cursor: pointer;" onclick="PropertiesDialog('#xarModURL('filemanager', 'fs', 'properties', array('fileId' => $loop:item['fileId']))#'); return false;">
                                    #$loop:item['fileName']#
                                </a>
                            </td>
                            <td class="xar-accent" align="center">&nbsp;#$loop:item['userName']#</td>
                            <td class="xar-accent" align="center">&nbsp;#$loop:item['fileStatusName']#</td>
                        </tr>  
                    </xar:if>
                </xar:loop>
                <tr>
                    <xar:if condition="!xarModGetVar('filemanager','file.auto-purge')">
                        <xar:set name="colspan">3</xar:set>
                    <xar:else />
                        <xar:set name="colspan">4</xar:set>
                    </xar:if>
                    <td colspan="#$colspan#" class="xar-accent xar-accent-outline">
                        <table summary="Commands" width="100%" border="0" cellpadding="0" cellspacing="0" class="xar-norm">
                            <tr>
                                <td width="100%">
                                    Change selected files to:&nbsp;
                                    <select name="action" id="action">
                                        <xar:foreach in="$filters['status']" key="$key" value="$status">
                                            <xar:if condition="$key eq '0'">
                                                <xar:comment> skip </xar:comment> 
                                            <xar:else />
                                                <option value="#$status['statusId']#">
                                                    #$status['statusName']# 
                                                </option>
                                            </xar:if>
                                        </xar:foreach>
                                    </select>
                                    <input type="submit" name="fileDo" id="file_change" value="#xarML('Change')#"/>
                                </td>
                            </tr>
                        </table>
                    </td>
                    <xar:if condition="!xarModGetVar('filemanager','file.auto-purge')">
                        <form action="#xarModUrl('filemanager','admin','purge_rejected')#" method="post">
                            <td class="xar-accent">
                                <table summary="Commands" width="100%" border="0" cellpadding="0" cellspacing="0" class="xar-norm">
                                    <tr>
                                        <td width="100%" align="center">
                                            <center>
                                            <input type="hidden" name="authid" value="#xarSecGenAuthKey()#" />
                                            <input type="submit" name="fileDo" id="fileDo_purge"  value="#xarML('Purge Rejected Files')#" />
                                            </center>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </form>
                    </xar:if>
                </tr>                                    
            <xar:else />
                <tr>
                    <td class="xar-norm" colspan="4" align="center">
                        <br />
                        <xar:mlstring>
                            There are currently no files to view with the filter you have chosen.
                        </xar:mlstring>
                        <br />
                    </td>
                </tr>
            </xar:if>
        </table>
        </form>
    </div>
</div>
