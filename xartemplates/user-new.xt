<xar:template xmlns:xar="http://xaraya.com/2004/blocklayout">
<xar:style scope="module" module="messages" file="messages"/>
<xar:set name="action">
    isset($action) ? $action : 'noaction'
</xar:set>
<div class="xar-mod-head">
    <span class="xar-mod-title">Private Messages</span>
</div>
<xar:comment>Psspl:Modifided the code for anonymous message</xar:comment>
<div class="xar-mod-body">
    <xar:comment>Psspl: Added the code for configuring NewMessages tab</xar:comment>
    <xar:template type="module" file="user-menu"/>
    <xar:if condition="$action eq 'reply'">
        <h3>Original Message</h3>
        <div class="xar-margin-thick xar-padding-thick xar-border-thin">
            <xar:data-display object="$previousobject" tplmodule="messages" action="$action"/>
            <div class="xar-margin-thicktop">
                <xar:if condition="xarSecurityCheck('ManageMessages', 0)">
                    <a href="#xarModURL('messages','user','delete',array('id' => $previousobject->properties['id']->value, 'folder' => $folder))#" title="#xarML('Delete Message')#">Delete</a>
                <xar:else/>
                    Delete
                </xar:if>
            </div>
        </div>
    </xar:if>
    <xar:if condition="$action ne 'post' and $action ne 'reply'">
        <h3>Message Preview</h3>
        <div class="xar-margin-thick xar-padding-thick xar-border-thin">
            <xar:data-display object="$object" tplmodule="messages" action="$action"/>
        </div>
    </xar:if>
    <h3>#$input_title#</h3>
    <form id="inputbox" action="#$post_url#" method="post" enctype="multipart/form-data">
        <xar:if condition="$action eq 'reply'">
            <xar:set name="previousanon">
                $previousobject->properties['postanon']->value
            </xar:set>
            <xar:data-form object="$object" tplmodule="messages" action="$action" previousanon="$previousanon"/>
        <xar:else />
            <xar:data-form object="$object" tplmodule="messages" action="$action"/>
        </xar:if>
        <div class="xar-align-center xar-margin-thick">
            <input type="hidden" name="authid" id="authid" value="#xarSecGenAuthKey()#"/>

            <xar:if condition="$action eq 'reply'">
                <input type="hidden" name="id" id="id" value="#$id#"/>
            <xar:elseif condition="$action eq 'modify'"/>
                <input type="hidden" name="action" id="action" value="prev_reply"/>
            <xar:elseif condition="$action eq 'prev_reply'"/>
                <input type="hidden" name="action" id="action" value="prev_reply"/>
            </xar:if>
            <input type="hidden" name="action" id="action" value="#$action#"/>
            <input type="hidden" name="phase" id="phase" value="submit"/>
            <input type="submit" name="preview" id="preview" value="#xarML('Preview')#" class="xar-margin-thickright"/>
            <input type="submit" name="confirm" id="confirm" value="#xarML('Submit')#" class="xar-margin-thickleft"/>
        </div>
    </form>
</div>
</xar:template>
