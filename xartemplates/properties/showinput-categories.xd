<xar:template xmlns:xar="http://xaraya.com/2004/blocklayout">

<!--
    size and multiple attributes not implemented under 1x. Fix for 2x
-->
<xar:if condition="!empty($size)">
    <xar:set name="sizestring">'size="'.$size.'"'</xar:set>
<xar:else/>
    <xar:set name="sizestring">''</xar:set>
</xar:if>

<xar:if condition="!empty($multiple)">
    <xar:set name="multiplestring">'multiple="multiple"'</xar:set>
<xar:else/>
    <xar:set name="multiplestring">''</xar:set>
</xar:if>

<xar:if condition="isset($onchange)">
  <xar:set name="evt_change">$onchange</xar:set>
<xar:else/>
  <xar:set name="evt_change">'return true;'</xar:set>
</xar:if>
<xar:if condition="!isset($style)">
    <xar:set name="style">''</xar:set>
</xar:if>

<input type="hidden" name="#$name#_categories_itemid" value="#$categories_itemid#" />
<input type="hidden" name="#$name#_categories_localmodule" value="#$categories_localmodule#" />
<input type="hidden" name="#$name#_categories_localitemtype" value="#$categories_localitemtype#" />
<xar:set name="index">0</xar:set>
<xar:foreach in="$trees" value="$nodes">
    <input type="hidden" name="#$name#_categories_basecats[#$index#]" value="#$basecids[$index]#" />
    <xar:if condition="count($trees) eq 1">
        <xar:set name="dropdownname">$name . "_categories"</xar:set>
        <xar:set name="dropdownid">$id . "_categories"</xar:set>
    <xar:else />
        <xar:set name="dropdownname">$name . "_categories[" . $index . "]"</xar:set>
        <xar:set name="dropdownid">$id . "_categories_" . $index</xar:set>
    </xar:if>
    <select name="#$dropdownname#" id="#$dropdownid#" tabindex="#$tabindex#" onchange="#$evt_change#" style="#$style#" >
        <xar:set name="already_passed">false</xar:set>
        <xar:set name="current_id">0</xar:set>
        <xar:set name="lastindent">0</xar:set>
        <xar:if condition="isset($firstline)">
            <option value="">#$firstline#</option>
        </xar:if>
        <xar:foreach in="$nodes" value="$node">
            <xar:set name="nodeid">$node->id</xar:set>
            <xar:set name="nodename">$node->name</xar:set>
            <xar:set name="level">$node->getLevel()</xar:set>
            <xar:if condition="empty($nodeid) or $nodeid ne $nodename">
                <xar:if condition="in_array($nodeid,$value)" >
                    <option value="#$nodeid#" selected="selected">
                        <xar:for start="$i = 1" test="$i le $level" iter="$i++">
                            -
                        </xar:for>
                        #$nodename#
                    </option>
                <xar:else />
                    <option value="#$nodeid#">
                        <xar:for start="$i = 1" test="$i le $level" iter="$i++">
                            -
                        </xar:for>
                        #$nodename#
                    </option>
                </xar:if>
            <xar:elseif condition="in_array($nodeid,$value)" />
                <option selected="selected">
                    <xar:for start="$i = 1" test="$i le $level" iter="$i++">
                        -
                    </xar:for>
                    #$nodename#
                </option>
            <xar:else />
                <option>
                    <xar:for start="$i = 1" test="$i le $level" iter="$i++">
                        -
                    </xar:for>
                    #$nodename#
                </option>
            </xar:if>
        </xar:foreach>
    </select>
    <xar:if condition="$layout eq 'vertical'">
        <br />
    </xar:if>
    <xar:set name="index">$index+1</xar:set>
</xar:foreach>

<xar:if condition="!empty($show_edit) and !empty($current_id)">
    <xar:sec id="showEdit" mask="EditCategories" catch="false" component="All" instance="All:$current_id">
        [&#160;<a href="#xarModURL('categories','admin','modifycat',array('cid' => $current_id))#">
        <xar:mlstring>Edit</xar:mlstring>
        </a> ]
    </xar:sec>
</xar:if>
</xar:template>
