<xar:comment>
    License: GPL http://www.gnu.org/copyleft/gpl.html 
</xar:comment>
<xar:comment>
    using css-driven template, avoiding excess tables for layout, especially nested ones 
</xar:comment>
<xar:if condition="xarTplAddStyleLink('xarBB', 'xarbb-layout')">
</xar:if>
<xar:if condition="$post ne '1'">
    <div class="xarbb-noteswrapper">
        <xar:categories-navigation layout="trails" showchildren="1" module="xarbb" itemtype="1" func="main" catid="$catid" />
    </div>
    <div class="xarbb-noteswrapper">
        <div class="xar-sub rightnote">
            <xar:comment>
                Approach 1 : via redirect in viewtopic FIXME: insert link to previous/next topic here with the right CSS stuff ? 
                <span class="xar-sub">
                    <a href="#xarModURL('xarbb','user','viewtopic',array('tid' => $tid, 'view' => 'prev'))#">
                        <xar:mlstring>
                            Previous Topic 
                        </xar:mlstring>
                    </a>
                    | 
                    <a href="#xarModURL('xarbb','user','viewtopic',array('tid' => $tid, 'view' => 'next'))#">
                        <xar:mlstring>
                            Next Topic 
                        </xar:mlstring>
                    </a>
                </span>
            </xar:comment>
            <xar:comment>
                Approach 2 : show previous/next topic directly in viewtopic instead of redirecting (unsupported) 
            </xar:comment>
            <xar:comment>
                Approach 3 : retrieve the previous/next topic id here 
            </xar:comment>
            <div>
                <xar:set name="previd">
                    #xarModAPIFunc('xarbb','user','getprevioustopicid',array('fid' => $fid, 'ttime' => $ttime))# 
                </xar:set>
                <xar:if condition="!empty($previd)">
                    <a href="#xarModURL('xarbb','user','viewtopic',array('tid' => $previd))#">
                        <xar:mlstring>
                            Previous Topic 
                        </xar:mlstring>
                    </a>
                    <xar:else />
                    <xar:mlstring>
                        Previous Topic 
                    </xar:mlstring>
                </xar:if>
                | 
                <xar:set name="nextid">
                    #xarModAPIFunc('xarbb','user','getnexttopicid',array('fid' => $fid, 'ttime' => $ttime))# 
                </xar:set>
                <xar:if condition="!empty($nextid)">
                    <a href="#xarModURL('xarbb','user','viewtopic',array('tid' => $nextid))#">
                        <xar:mlstring>
                            Next Topic 
                        </xar:mlstring>
                    </a>
                    <xar:else />
                    <xar:mlstring>
                        Next Topic 
                    </xar:mlstring>
                </xar:if>
            </div>
            <xar:if condition="xarThemeIsAvailable('print')">
                <div>
                    <a href="#xarModUrl('xarbb', 'user', 'printtopic', array('tid' => $tid, 'theme' => 'print'))#">
                        <xar:mlstring>
                            Print this topic 
                        </xar:mlstring>
                    </a>
                    :: 
                    <a href="#xarModUrl('xarbb', 'user', 'subscribe', array('tid' => $tid, 'uid' => xarUserGetVar('uid')))#">
                        <xar:mlstring>
                            Subscribe to topic 
                        </xar:mlstring>
                    </a>
                </div>
            </xar:if>
        </div>
    </div>
    <div id="top">
        <strong>
            #$ttitle# 
        </strong>
    </div>
    <xar:if condition="!empty($pager)">
        <div class="xar-sub">
            <strong>
                #$pager# 
            </strong>
        </div>
    </xar:if>
    <form action="#xarModUrl('xarbb', 'user', 'jump')#" method="post">
        <div class="xarbb-noteswrapper">
            <strong>
                <xar:mlstring>
                    Forum Jump 
                </xar:mlstring>
            </strong>
            <br />
            <select name="f" onchange="this.form.submit();">
                <optgroup label="#xarML('Options')#">
                    <option value="#$fid#" selected="selected">
                        <xar:mlstring>
                            Please select forum 
                        </xar:mlstring>
                    </option>
                    <option value="#$fid#">
                        -------------------- 
                    </option>
                </optgroup>
                <optgroup label="#xarML('Forums')#">
                    <xar:loop name="$forums">
                        <option value="#$loop:item['fid']#">
                            #$loop:item['fname']# 
                        </option>
                    </xar:loop>
                </optgroup>
            </select>
            <input type="submit" class="button" value="#xarML('Jump')#" />
        </div>
    </form>
    <div class="xarbb-topiccontrols">
        <xar:template file="topiccontrols" type="module" />
    </div>
</xar:if>
<div class="xarbb-tablewrapper">
    <xar:if condition="!empty($hooks) and !empty($hooks['polls'])">
        #$hooks['polls']# 
    </xar:if>
    <xar:comment>
        if you have other dynamic user fields that you want to include in this template, add them to the fieldlist 
    </xar:comment>
    <xar:data-getitems name="$properties" value="$posterdata" module="roles" itemids="$posterlist" fieldlist="website,avatar,location,signature,icq,msnm,yim,aim" />
    <table>
        <tr>
            <th>
                <xar:mlstring>
                    Author 
                </xar:mlstring>
            </th>
            <th>
                <xar:mlstring>
                    Message 
                </xar:mlstring>
            </th>
        </tr>
        <xar:comment>
            Display the Topic Post itself - unless it is not the first pager page 
        </xar:comment>
        <xar:if condition="$startnum eq 1">
            <tr>
                <td class="xar-norm author">
                    <div>
                        <strong>
                            <a href="#xarModUrl('roles', 'user', 'display', array('uid' => $tposter))#">
                                #$postername# 
                            </a>
                        </strong>
                    </div>
                    <div class="xar-sub">
                        <xar:if condition="isset($properties['avatar']) and !empty($posterdata[$tposter]['avatar'])">
                            <xar:data-output property="$properties['avatar']" value="$posterdata[$tposter]['avatar']" />
                            <br />
                        </xar:if>
                        <xar:mlstring>
                            Joined 
                        </xar:mlstring>
                        : #xarLocaleGetFormattedDate('medium', $posterdatestamp)# 
                        <br />
                        <xar:mlstring>
                            Posts 
                        </xar:mlstring>
                        : #$usertopics# 
                        <xar:if condition="isset($properties['location']) and !empty($posterdata[$tposter]['location'])">
                            <br />
                            <xar:mlstring>
                                Location 
                            </xar:mlstring>
                            : 
                            <xar:data-output property="$properties['location']" value="$posterdata[$tposter]['location']" />
                        </xar:if>
                        <br />
                        <a href="#xarModURL('xarbb', 'user', 'searchtopics', array('by' => $tposter))#">
                            <xar:mlstring>
                                Other Topics
                            </xar:mlstring>
                        </a>
                    </div>
                </td>
                <td class="xar-norm message">
                    <div class="xarbb-messagecontrols">
                        <div class="leftnote">
                            <span class="xar-sub">
                                <xar:mlstring>
                                    Posted 
                                </xar:mlstring>
                                : #xarLocaleGetFormattedDate('medium', $tftime)# #xarLocaleGetFormattedTime('medium', $tftime)# 
                            </span>
                        </div>
                        <div class="rightnote">
                            <xar:if condition="xarUserIsLoggedIn()">
                                <xar:if condition="$tstatus ne 3">
                                    <xar:sec mask="PostxarBB" catch="false">
                                        <xar:if condition="(isset($allowbbcode) and ($allowbbcode eq 'true')) or (isset($allowhtml) and ($allowhtml eq 'true'))">
<!-- <xar:if condition="xarModIsAvailable('bbcode')"> -->
                                            <a href="#xarModUrl('xarbb', 'user', 'newreply', array('tid' => $tid, 'phase' => 'quote'))#">
                                                #$quoteimg# 
                                            </a>
                                        </xar:if>
                                    </xar:sec>
                                    <xar:if condition="xarUserGetVar('uid') eq $tposter">
                                        <a href="#xarModURL('xarbb','user','newtopic',array('tid' => $tid,'redirect' => 'topic'))#">
                                            #$editimg# 
                                        </a>
                                        <xar:else />
                                        <xar:sec mask="ModxarBB" catch="false">
                                            <a href="#xarModURL('xarbb','user','newtopic',array('tid' => $tid,'redirect' => 'topic'))#">
                                                #$editimg# 
                                            </a>
                                        </xar:sec>
                                    </xar:if>
                                </xar:if>
                                <xar:sec mask="DeletexarBB" catch="false">
                                    <a href="#xarModUrl('xarbb', 'user', 'deletetopic', array('tid' => $tid, 'confirmation' => 1, 'authid' => $authid))#" onclick="return xar_base_confirmLink(this, '#xarML('Delete this topic?').' '.xarVarPrepfordisplay($ttitle)#?')">
                                        #$deleteimg# 
                                    </a>
                                </xar:sec>
                                <xar:sec mask="AdminxarBB" catch="false">
                                    <a href="#xarModUrl('xarbb', 'admin', 'checkip', array('ip' => $thostname))#">
                                        #$ipimg# 
                                    </a>
                                </xar:sec>
                            </xar:if>
                        </div>
                        <xar:comment>
                            Placement of subject for full width of message containing div 
                        </xar:comment>
                        <div style="float:left;">
                            <strong class="xar-sub">
                                <xar:mlstring>
                                    Subject 
                                </xar:mlstring>
                                : #$transformedtitle# 
                            </strong>
                        </div>
                    </div>
                    <div>
                        #$transformedtext# 
                        <xar:if condition="isset($properties['signature']) and !empty($posterdata[$tposter]['signature'])">
                            <p class="hiddensignature">
                                <xar:data-output property="$properties['signature']" value="$posterdata[$tposter]['signature']" />
                            </p>
                        </xar:if>
                    </div>
                </td>
            </tr>
            <tr>
                <td class="xar-norm author">
                    <a href="#xarModURL('xarbb', 'user', 'viewtopic', array('tid' => $tid))##top">
                        <xar:mlstring>
                            Back to top 
                        </xar:mlstring>
                    </a>
                    <xar:if condition="isset($changelog)">
                        <xar:sec mask="ModxarBB" catch="false">
                            <br />
                            <a href="#xarModUrl('changelog', 'admin', 'showlog', array('modid' => '300', 'itemtype' => $fid, 'itemid' => $tid))#">
                                <xar:mlstring>
                                    View changes 
                                </xar:mlstring>
                            </a>
                        </xar:sec>
                    </xar:if>
                </td>
                <td class="xar-alt">
                    <xar:if condition="xarUserIsLoggedIn()">
                        <xar:comment>
                            jojodee: This is not strictly correct as anon users may have permission to send PMs etc Each of these should really have their own xar:sec .... 
                        </xar:comment>
                        <a href="#xarModUrl('roles', 'user', 'display', array('uid' => $tposter))#">
                            <img src="#xarTplGetImage('new/icon_profile.gif')#" alt="#xarML('Profile')#" />
                        </a>
                        <a href="#xarModUrl('roles', 'user', 'email', array('uid' => $tposter))#">
                            <img src="#xarTplGetImage('new/icon_email.gif')#" alt="#xarML('Email')#" />
                        </a>
                        <xar:if condition="xarModIsAvailable('messages')">
                            <a href="#xarModUrl('messages', 'user', 'send',array('action'=>'post'))#">
                                <img src="#xarTplGetImage('new/icon_pm.gif')#" alt="#xarML('Private Message')#" />
                            </a>
                        </xar:if>
                        <xar:if condition="isset($properties['website']) and !empty($posterdata[$tposter]['website'])">
                            <a href="#$posterdata[$tposter]['website']#">
                                <img src="#xarTplGetImage('new/icon_www.gif')#" alt="#xarML('Website')#" />
                            </a>
                        </xar:if>
                        <xar:if condition="isset($properties['icq']) and !empty($posterdata[$tposter]['icq'])">
                            <a href="http://wwp.icq.com/#$posterdata[$tposter]['icq']##pager">
                                <img src="#xarTplGetImage('new/icon_icq_add.gif')#" alt="#xarML('ICQ')#" />
                            </a>
                        </xar:if>
                        <xar:if condition="isset($properties['msnm']) and !empty($posterdata[$tposter]['msnm'])">
                            <a href="#xarModUrl('roles', 'user', 'display', array('uid' => $tposter))#">
                                <img src="#xarTplGetImage('new/icon_msnm.gif')#" alt="#xarML('MSN')#" />
                            </a>
                        </xar:if>
                        <xar:if condition="isset($properties['yim']) and !empty($posterdata[$tposter]['yim'])">
                            <a href="http://edit.yahoo.com/config/send_webmesg?.target=#$posterdata[$tposter]['yim']#&amp;.src=pg">
                                <img src="#xarTplGetImage('new/icon_yim.gif')#" alt="#xarML('Yahoo!')#" />
                            </a>
                        </xar:if>
                        <xar:if condition="isset($properties['aim']) and !empty($posterdata[$tposter]['aim'])">
                            <a href="aim:goim?screenname=#$posterdata[$tposter]['aim']#&amp;message=Hello+Are+you+there?">
                                <img src="#xarTplGetImage('new/icon_aim.gif')#" alt="#xarML('AOL Instant Messenger')#" />
                            </a>
                        </xar:if>
                    </xar:if>
                </td>
            </tr>
        </xar:if>
        <xar:comment>
            start the post replies and add alternating row colors 
        </xar:comment>
        <xar:foreach in="$items" value="$item" key="$key">
            <xar:if condition="(($key+1) % 2)">
                <xar:set name="myclass">
                    'xar-accent' 
                </xar:set>
                <xar:else />
                <xar:set name="myclass">
                    'xar-norm' 
                </xar:set>
            </xar:if>
            <tr>
                <td class="xar-norm author">
                    <strong>
                        <xar:comment>
                            Reply post could be anonymous - need to check 
                        </xar:comment>
                        <xar:if condition="$item['xar_postanon'] eq 0">
                            <a href="#xarModUrl('roles', 'user', 'display', array('uid' => $item['xar_uid']))#">
                                #$item['xar_author']# 
                            </a>
                            <xar:else />
                            <xar:sec catch="false" mask="modXarBB">
                                <xar:mlstring>
                                    Anonymous 
                                </xar:mlstring>
                                (#$item['xar_author']#) 
                                <xar:else />
                                <xar:mlstring>
                                    Anonymous 
                                </xar:mlstring>
                            </xar:sec>
                        </xar:if>
                    </strong>
<!--  <xar:if condition="xarUserIsLoggedIn()"> -->
                    <span class="xar-sub">
                        <xar:if condition="$item['xar_postanon'] eq 0">
                            <br />
                            <xar:if condition="isset($properties['avatar']) and !empty($posterdata[$item['xar_uid']]['avatar'])">
                                <xar:data-output property="$properties['avatar']" value="$posterdata[$item['xar_uid']]['avatar']" />
                                <br />
                            </xar:if>
                            <xar:mlstring>
                                Joined 
                            </xar:mlstring>
                            : #xarLocaleGetFormattedDate('medium',$item['commenterdatestamp'])# 
                            <br />
                            <xar:mlstring>
                                Posts 
                            </xar:mlstring>
                            : #$item['usertopics']# 
                            <br />
                            <xar:if condition="isset($properties['location']) and !empty($posterdata[$item['xar_uid']]['location'])">
                                <xar:mlstring>
                                    Location 
                                </xar:mlstring>
                                : 
                                <xar:data-output property="$properties['location']" value="$posterdata[$item['xar_uid']]['location']" />
                                <br />
                            </xar:if>
                        </xar:if>
                        <br />
                        <a href="#xarModURL('xarbb', 'user', 'searchtopics', array('by' => $item['xar_uid']))#">
                            <xar:mlstring>
                                Other Topics
                            </xar:mlstring>
                        </a>
                    </span>
<!--  </xar:if> -->
                </td>
                <td class="#$myclass# message">
                    <div class="xarbb-messagecontrols">
                        <div class="leftnote">
                            <span class="xar-sub">
                                <xar:mlstring>
                                    Posted 
                                </xar:mlstring>
                                : #xarLocaleGetFormattedDate('medium', $item['xar_datetime'])# #xarLocaleGetFormattedTime('medium', $item['xar_datetime'])# 
                            </span>
                        </div>
                        <div class="rightnote">
                            <xar:if condition="xarUserIsLoggedIn()">
                                <xar:if condition="$tstatus ne 3">
                                    <xar:sec mask="PostxarBB" catch="false">
                                        <xar:if condition="(isset($allowbbcode) and ($allowbbcode eq 'true')) or (isset($allowhtml) and ($allowhtml eq 'true'))">
<!-- <xar:if condition="xarModIsAvailable('bbcode')"> -->
                                            <a href="#xarModUrl('xarbb', 'user', 'newreply', array('cid' => $item['xar_cid'], 'tid' => $tid, 'phase' => 'quote'))#">
                                                #$quoteimg# 
                                            </a>
                                        </xar:if>
                                    </xar:sec>
                                    <xar:if condition="xarUserGetVar('uid') eq $item['xar_uid']">
                                        <a href="#xarModUrl('xarbb', 'user', 'newreply', array('cid' => $item['xar_cid'], 'tid' => $tid, 'phase' => 'edit'))#">
                                            #$editimg# 
                                        </a>
                                        <xar:else />
                                        <xar:sec mask="ModxarBB" catch="false">
                                            <a href="#xarModUrl('xarbb', 'user', 'newreply', array('cid' => $item['xar_cid'], 'tid' => $tid, 'phase' => 'edit'))#">
                                                #$editimg# 
                                            </a>
                                        </xar:sec>
                                    </xar:if>
                                </xar:if>
                                <xar:sec mask="DeletexarBB" catch="false">
                                    <a href="#xarModUrl('xarbb', 'user', 'deletereply', array('cid' => $item['xar_cid'], 'confirmation' => 1, 'authid' => $authid))#" onclick="return xar_base_confirmLink(this, '#xarML('Delete this reply?').' '.xarVarPrepfordisplay($item['xar_title'])#?')">
                                        #$deleteimg# 
                                    </a>
                                </xar:sec>
                                <xar:sec mask="AdminxarBB" catch="false">
                                    <a href="#xarModUrl('xarbb', 'admin', 'checkip', array('ip' => $item['xar_hostname']))#">
                                        #$ipimg# 
                                    </a>
                                </xar:sec>
                            </xar:if>
                        </div>
                        <div style="float:left;">
                            <strong class="xar-sub">
                                <xar:mlstring>
                                    Subject 
                                </xar:mlstring>
                                : 
                                <a name="#$item['xar_cid']#" href="#xarModUrl('xarbb', 'user', 'viewtopic', array('tid' => $tid),NULL, $item['xar_cid'])#">
                                    #$item['xar_title']# 
                                </a>
                            </strong>
                        </div>
                    </div>
                    <div style="clear:left;">
                        #$item['xar_text']# 
                        <xar:if condition="$item['xar_postanon'] eq 0">
                            <xar:if condition="isset($properties['signature']) and !empty($posterdata[$item['xar_uid']]['signature'])">
                                <p class="hiddensignature">
                                    <xar:data-output property="$properties['signature']" value="$posterdata[$item['xar_uid']]['signature']" />
                                </p>
                            </xar:if>
                        </xar:if>
                    </div>
                </td>
            </tr>
            <tr>
                <td class="xar-norm author">
                    <a href="#xarModURL('xarbb', 'user', 'viewtopic', array('tid' => $tid))##top">
                        <xar:mlstring>
                            Back to top 
                        </xar:mlstring>
                    </a>
                    <xar:if condition="isset($changelog)">
                        <xar:sec mask="ModxarBB" catch="false">
                            <br />
                            <a href="#xarModUrl('changelog', 'admin', 'showlog', array('modid' => '14', 'itemid' => $item['xar_cid']))#">
                                <xar:mlstring>
                                    View changes 
                                </xar:mlstring>
                            </a>
                        </xar:sec>
                    </xar:if>
                </td>
                <td class="xar-alt">
                    <xar:if condition="xarUserIsLoggedIn()">
                        <xar:comment>
                            jojodee: This is not strictly correct as anon users may have permission to send PMs etc Each of these should really have their own xar:sec .... 
                        </xar:comment>
                        <xar:if condition="$item['xar_postanon'] eq 0">
                            <a href="#xarModUrl('roles', 'user', 'display', array('uid' => $item['xar_uid']))#">
                                <img src="#xarTplGetImage('new/icon_profile.gif')#" alt="#xarML('Profile')#" />
                            </a>
                            <a href="#xarModUrl('roles', 'user', 'email', array('uid' => $item['xar_uid']))#">
                                <img src="#xarTplGetImage('new/icon_email.gif')#" alt="#xarML('Email')#" />
                            </a>
                            <xar:if condition="xarModIsAvailable('messages')">
                                <a href="#xarModUrl('messages', 'user', 'send',array('action'=>'post'))#">
                                    <img src="#xarTplGetImage('new/icon_pm.gif')#" alt="#xarML('Private Message')#" />
                                </a>
                            </xar:if>
                            <xar:if condition="isset($properties['website']) and !empty($posterdata[$item['xar_uid']]['website'])">
                                <a href="#$posterdata[$item['xar_uid']]['website']#">
                                    <img src="#xarTplGetImage('new/icon_www.gif')#" alt="#xarML('Website')#" />
                                </a>
                            </xar:if>
                            <xar:if condition="isset($properties['icq']) and !empty($posterdata[$item['xar_uid']]['icq'])">
                                <a href="http://wwp.icq.com/#$posterdata[$item['xar_uid']]['icq']##pager">
                                    <img src="#xarTplGetImage('new/icon_icq_add.gif')#" alt="#xarML('ICQ')#" />
                                </a>
                            </xar:if>
                            <xar:if condition="isset($properties['msnm']) and !empty($posterdata[$item['xar_uid']]['msnm'])">
                                <a href="#xarModUrl('roles', 'user', 'display', array('uid' => $item['xar_uid']))#">
                                    <img src="#xarTplGetImage('new/icon_msnm.gif')#" alt="#xarML('MSN')#" />
                                </a>
                            </xar:if>
                            <xar:if condition="isset($properties['yim']) and !empty($posterdata[$item['xar_uid']]['yim'])">
                                <a href="http://edit.yahoo.com/config/send_webmesg?.target=#$posterdata[$item['xar_uid']]['yim']#&amp;.src=pg">
                                    <img src="#xarTplGetImage('new/icon_yim.gif')#" alt="#xarML('Yahoo!')#" />
                                </a>
                            </xar:if>
                            <xar:if condition="isset($properties['aim']) and !empty($posterdata[$item['xar_uid']]['aim'])">
                                <a href="aim:goim?screenname=#$posterdata[$item['xar_uid']]['aim']#&amp;message=Hello+Are+you+there?">
                                    <img src="#xarTplGetImage('new/icon_aim.gif')#" alt="#xarML('AOL Instant Messenger')#" />
                                </a>
                            </xar:if>
                        </xar:if>
                    </xar:if>
                </td>
            </tr>
        </xar:foreach>
    </table>
</div>
<xar:if condition="$post ne '1'">
    <div class="xarbb-topiccontrols">
        <xar:template file="topiccontrols" type="module" />
        <xar:comment>
            Approach 1 : via redirect in viewtopic FIXME: insert link to previous/next topic here with the right CSS stuff ? 
            <span class="xar-sub">
                <a href="#xarModURL('xarbb','user','viewtopic',array('tid' => $tid, 'view' => 'prev'))#">
                    <xar:mlstring>
                        Previous Topic 
                    </xar:mlstring>
                </a>
                | 
                <a href="#xarModURL('xarbb','user','viewtopic',array('tid' => $tid, 'view' => 'next'))#">
                    <xar:mlstring>
                        Next Topic 
                    </xar:mlstring>
                </a>
            </span>
        </xar:comment>
        <xar:comment>
            Approach 2 : show previous/next topic directly in viewtopic instead of redirecting (unsupported) 
        </xar:comment>
        <xar:comment>
            Approach 3 : retrieve the previous/next topic id here 
            <span class="xar-sub">
                <xar:set name="previd">
                    #xarModAPIFunc('xarbb','user','getprevioustopicid',array('fid' => $fid, 'ttime' => $ttime))# 
                </xar:set>
                <xar:if condition="!empty($previd)">
                    <a href="#xarModURL('xarbb','user','viewtopic',array('tid' => $previd))#">
                        <xar:mlstring>
                            Previous Topic 
                        </xar:mlstring>
                    </a>
                    <xar:else />
                    <xar:mlstring>
                        Previous Topic 
                    </xar:mlstring>
                </xar:if>
                | 
                <xar:set name="nextid">
                    #xarModAPIFunc('xarbb','user','getnexttopicid',array('fid' => $fid, 'ttime' => $ttime))# 
                </xar:set>
                <xar:if condition="!empty($nextid)">
                    <a href="#xarModURL('xarbb','user','viewtopic',array('tid' => $nextid))#">
                        <xar:mlstring>
                            Next Topic 
                        </xar:mlstring>
                    </a>
                    <xar:else />
                    <xar:mlstring>
                        Next Topic 
                    </xar:mlstring>
                </xar:if>
            </span>
        </xar:comment>
        <xar:if condition="!empty($pager)">
            <span class="xar-sub">
                <strong>
                    #$pager# 
                </strong>
            </span>
        </xar:if>
    </div>
    <xar:sec mask="ModxarBB" catch="false">
        <div style="clear:left;">
            <xar:if condition="$tstatus ne 3">
                <xar:if condition="$tstatus eq 0">
                    <a href="#xarModUrl('xarbb', 'user', 'locktopic', array('tstatus' => 3, 'tid' => $tid))#">
                        <img src="#xarTplGetImage('new/topic_lock.gif')#" alt="#xarML('Lock Topic')#" />
                    </a>
                    <xar:else />
                    <a href="#xarModUrl('xarbb', 'user', 'locktopic', array('tstatus' => 3, 'options' => 1, 'tid' => $tid))#">
                        <img src="#xarTplGetImage('new/topic_lock.gif')#" alt="#xarML('Lock Topic')#" />
                    </a>
                </xar:if>
                <xar:else />
                <a href="#xarModUrl('xarbb', 'user', 'locktopic', array('tstatus' => 0, 'tid' => $tid))#">
                    <img src="#xarTplGetImage('new/topic_unlock.gif')#" alt="#xarML('Unlock Topic')#" />
                </a>
            </xar:if>
            <xar:sec mask="DeletexarBB" catch="false">
                <a href="#xarModUrl('xarbb', 'user', 'deletetopic', array('tid' => $tid, 'confirmation' => 1, 'authid' => $authid))#" onclick="return xar_base_confirmLink(this, '#xarML('Delete this topic?').' '.xarVarPrepfordisplay($ttitle)#?')">
                    #$deleteimg# 
                </a>
            </xar:sec>
            <a href="#xarModUrl('xarbb', 'user', 'movetopic', array('tid' => $tid))#">
                <img src="#xarTplGetImage('new/topic_move.gif')#" alt="#xarML('Move Topic')#" />
            </a>
        </div>
    </xar:sec>
</xar:if>
<xar:if condition="$tstatus ne 3">
    <xar:if condition="$post ne '1'">
        <xar:sec mask="PostxarBB" catch="false">
            <form action="#xarModUrl('xarbb', 'user', 'quickreply', array('tid' => $tid))#" method="post" name="post" id="post">
                <p>
                    <div class="xar-sub">
                        <xar:mlstring>
                            Quick Reply 
                        </xar:mlstring>
                        : 
                    </div>
                    <textarea name='text' rows='4' cols='60' wrap='virtual' id="text" tabindex="2"></textarea>
                    <input type="hidden" name="title" id="title" value="#xarVarPrepForDisplay($ttitle)#" />
                    <input type="hidden" name="tid" id="header-objectid" value="#$tid#" />
                    <input type="hidden" name="fid" id="header-itemtype" value="#$fid#" />
                    <div>
                        <input type="submit" name="receipt[action]" id="receipt-action-submit" value="#xarML('Submit')#" tabindex="4" />
                    </div>
                </p>
            </form>
        </xar:sec>
    </xar:if>
</xar:if>
<xar:if condition="!empty($hooks) and count($hooks) gt 0">
    <xar:foreach in="$hooks" key="$hookmodule">
        <xar:comment>
            xarbb already deals with comments directly via API, using itemtype 0 (for now ?) 
        </xar:comment>
        <xar:comment>
            and polls are already inserted at the top for a nicer display 
        </xar:comment>
        <xar:if condition="$hookmodule ne 'comments' and $hookmodule ne 'polls'">
            #$hooks[$hookmodule]# 
        </xar:if>
    </xar:foreach>
</xar:if>
