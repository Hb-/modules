
<xar:style file="mag" scope="module" />

<div class="mag mag-article">

    <xar:if condition="empty($mag)">
        <p class="xar-error"><xar:mlstring>No magazine found. Please select a magazine.</xar:mlstring></p>
    <xar:else />
        <xar:comment><h1>
            <a href="#xarModAPIfunc('mag','user','url',array('func'=&gt;'mags','mag'=&gt;$mag.ref))#">
                #xarVarPrepForDisplay($mag.title)#
            </a>
        </h1></xar:comment>

        <xar:if condition="empty($article)">
            <p class="xar-error"><xar:mlstring>No article found. Please select an article.</xar:mlstring></p>
        <xar:else />
            <xar:comment>Article header section</xar:comment>
            <div class="mag-article-header">
                <xar:comment>Main title</xar:comment>
                <h1>
                    <a href="#xarModAPIfunc('mag','user','url',array('func'=&gt;'article','mag'=&gt;$mag.ref,'issue'=&gt;$issue.ref,'aid'=&gt;article.aid))#">
                        #xarVarPrepForDisplay($article.title)#
                    </a>
                </h1>

                <xar:comment>Sub-title</xar:comment>
                <xar:if condition="!empty($article.subtitle)">
                    <h3>#xarVarPrepForDisplay($article.subtitle)#</h3>
                </xar:if>

                <xar:comment>Publishing information</xar:comment>
                <p class="mag-header-publishing">
                    <xar:ml>
                        <xar:mlstring>Published #(1) in the <a href="#(4)">#(2)</a> issue of <a href="#(5)">#(3)</a></em></xar:mlstring>
                        <xar:mlvar>#xarLocaleGetFormattedDate('long', $issue.pubdate)#</xar:mlvar>
                        <xar:mlvar>#xarVarPrepForDisplay($issue.title)#</xar:mlvar>
                        <xar:mlvar>#xarVarPrepForDisplay($mag.title)#</xar:mlvar>
                        <xar:mlvar>#xarModAPIfunc('mag','user','url',array('func'=&gt;'contents','mag'=&gt;$mag.ref,'issue'=&gt;$issue.ref))#</xar:mlvar>
                        <xar:mlvar>#xarModAPIfunc('mag','user','url',array('func'=&gt;'mags','mag'=&gt;$mag.ref))#</xar:mlvar>
                    </xar:ml>
                    <xar:if condition="!empty($article.series_id)">
                        <xar:ml>
                            <xar:mlstring>; in the <a href="#(1)">#(2)</a> series</xar:mlstring>
                            <xar:mlvar>#xarModAPIfunc('mag','user','url',array('func'=&gt;'series','mag'=&gt;$mag.ref,'series'=&gt;$series.ref))#</xar:mlvar>
                            <xar:mlvar>#xarVarPrepForDisplay($series['title'])#</xar:mlvar>
                        </xar:ml>
                    </xar:if>
                    <xar:if condition="!empty($article.page)">
                        <xar:ml>
                            <xar:mlstring>; Page #(1)</xar:mlstring>
                            <xar:mlvar>#$article.page#</xar:mlvar>
                        </xar:ml>
                    </xar:if>
                </p>

                <xar:if condition="!empty($authors)">
                    <div class="mag-header-author">
                        <xar:mlstring>By:</xar:mlstring>
                        <xar:loop name="$authors">
                            <xar:if condition="$loop:index gt 0"> | </xar:if>
                            <a href="#xarModAPIfunc('mag','user','url',array('func'=&gt;'authors','mag'=&gt;$mag.ref,'auid'=&gt;$loop:item.auid))#">#xarVarPrepForDisplay($loop:item.name)#</a>
                        </xar:loop>
                    </div>
                </xar:if>
            
            </div>

            <xar:if condition="!empty($article.image1_path) or !empty($article.summary)">
                <div class="mag-article-intro-block">
                    <xar:if condition="!empty($article.image1_path)">
                        <img src="#$article.image1_path#" alt="#xarvarPrepForDisplay($article.image1_alt)#" title="#xarvarPrepForDisplay($article.image1_alt)#" class="mag-article-main-image" />
                    </xar:if>
                    <xar:if condition="!empty($article.summary)">
                        <xar:comment>TODO: force the summary to be HTML</xar:comment>
                        #$article.summary#
                    </xar:if>
                    <div style="clear: both;"></div>
                </div>
            </xar:if>

            <xar:comment>TODO: force to HTML format</xar:comment>
            <xar:comment>TODO: handle premium and sample flags</xar:comment>
            <xar:comment>TODO: handle images as pop-ups etc</xar:comment>
            <div class="mag-article-body">
                #xarModAPIfunc('mag','user','imgfilter',array('text'=&gt;$article.body))#
                <div style="clear: both;"></div>
            </div>

            <div class="mag-article-footer">
                <xar:if condition="!empty($article.refs)">
                    <xar:comment>TODO: force this to HTML</xar:comment>
                    <div class="mag-article-refs">
                        <h4><xar:mlstring>References:</xar:mlstring></h4>
                        #$article.refs#
                    </div>
                </xar:if>

                <xar:if condition="!empty($article.footer)">
                    <xar:comment>TODO: force this to HTML</xar:comment>
                    <div class="mag-article-footer-text">#$article.footer#</div>
                </xar:if>

                <xar:if condition="!empty($authors)">
                    <div class="mag-footer-authors">
                        <xar:loop name="$authors">
                            <div class="mag-footer-author">
                                <a href="#xarModAPIfunc('mag','user','url',array('func'=&gt;'authors','mag'=&gt;$mag.ref,'auid'=&gt;$loop:item.auid))#">
                                    <xar:if condition="!empty($loop:item.photo_icon)">
                                        <img src="#xarVarPrepForDisplay($loop:item.photo_icon)#" alt="#xarVarPrepForDisplay($loop:item.name)#" />
                                    </xar:if>
                                    <xar:comment>TODO: force mini-bio to be text</xar:comment>
                                    <xar:if condition="!empty($loop:item.mini_bio)">
                                        #xarVarPrepForDisplay($loop:item.mini_bio)#
                                    <xar:else />
                                        #xarVarPrepForDisplay($loop:item.name)#
                                    </xar:if>
                                </a>
                            </div>
                        </xar:loop>
                        <div style="clear: both;"></div>
                    </div>
                </xar:if>
            </div>
        </xar:if>
    </xar:if>

</div>
