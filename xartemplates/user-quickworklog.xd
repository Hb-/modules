<xar:set name="worklog_objectid">xarModGetVar('xtasks','worklog_objectid')</xar:set>
<xar:data-getitem name="$properties" module="xTasks" itemtype="2" itemid="$worklog_objectid" />
<xar:set name="xtasks_objectid">xarModGetVar('xtasks','xtasks_objectid')</xar:set>
<xar:data-getitem name="$taskproperties" module="xTasks" itemtype="1" itemid="$xtasks_objectid" />

<xar:set name="uid">xarSessionGetVar('uid')</xar:set>
<xar:set name="currentdate">date("Y-m-d H:i:s")</xar:set>

<div class="xar-mod-body">
    <table width="100%" border="0" cellspacing="1" cellpadding="2" id="xtasks_info">
        <tr valign="top">
            <td class="xar-title xar-align-right" style="width: 200px;"><xar:data-label property="$taskproperties['task_name']" /></td>
            <td class="xar-norm xar-align-left"><xar:data-output property="$taskproperties['task_name']" value="$taskinfo['task_name']" /></td>
        </tr>
        <xar:if condition="!empty($taskinfo['parentname'])">
            <tr valign="top">
                <td class="xar-title xar-align-right"><xar:mlstring>Parent Task</xar:mlstring></td>
                <td class="xar-norm xar-align-left"><xar:if condition="empty($parenturl)">#$parentname#<xar:else /><a href="#$parenturl#">#$parentname#</a></xar:if></td>
            </tr>
        </xar:if>
        <tr valign="top">
            <td class="xar-title xar-align-right"><xar:mlstring>Assigned To</xar:mlstring></td>
            <td class="xar-norm xar-align-left"><xar:if condition="!empty($taskinfo['owner'])"><xar:data-output property="$taskproperties['owner']" value="$taskinfo['owner']" /><xar:else /><xar:mlstring>Open/Available</xar:mlstring></xar:if></td>
        </tr>
        <xar:if condition="$taskinfo['assigner'] gt 0">
            <tr valign="top">
                <td class="xar-title xar-align-right"><xar:mlstring>Assigned By</xar:mlstring></td>
                <td class="xar-norm xar-align-left"><xar:data-output property="$taskproperties['assigner']" value="$taskinfo['assigner']" /></td>
            </tr>
        </xar:if>
        <xar:if condition="$taskinfo['creator'] gt 0">
            <tr valign="top">
                <td class="xar-title xar-align-right"><xar:mlstring>Created By</xar:mlstring></td>
                <td class="xar-norm xar-align-left"><xar:data-output property="$taskproperties['creator']" value="$taskinfo['creator']" /></td>
            </tr>
        </xar:if>
        <tr valign="top">
            <td class="xar-title xar-align-right"><xar:data-label property="$taskproperties['status']" /></td>
            <td class="xar-norm xar-align-left"><xar:data-output property="$taskproperties['status']" value="$taskinfo['status']" />
                <span class="xar-title" style="padding-left: 20px;"><xar:data-label property="$taskproperties['private']" /></span>
                <xar:data-output property="$taskproperties['private']" value="$taskinfo['private']" /></td>
        </tr>
        <tr valign="top">
            <td class="xar-title xar-align-right"><xar:data-label property="$taskproperties['priority']" /></td>
            <td class="xar-norm xar-align-left"><xar:data-output property="$taskproperties['priority']" value="$taskinfo['priority']" />
                <span class="xar-title" style="padding-left: 20px;"><xar:data-label property="$taskproperties['importance']" /></span>
                <xar:data-output property="$taskproperties['importance']" value="$taskinfo['importance']" /></td>
        </tr>
        <xar:if condition="$taskinfo['date_approved'] gt 0">
            <tr valign="top">
                <td class="xar-title xar-align-right"><xar:data-label property="$taskproperties['date_approved']" /></td>
                <td class="xar-norm xar-align-left"><xar:data-output property="$taskproperties['date_approved']" value="$taskinfo['date_approved']" /></td>
            </tr>
        </xar:if>
        <xar:if condition="$taskinfo['date_start_planned'] gt 0 OR $taskinfo['date_end_planned'] gt 0">
            <tr valign="top">
                <td class="xar-title xar-align-right"><xar:mlstring>Planned Timeframe</xar:mlstring></td>
                <td class="xar-norm xar-align-left">
                    <xar:if condition="$taskinfo['date_start_planned'] gt 0">
                        <xar:data-output property="$taskproperties['date_start_planned']" value="$taskinfo['date_start_planned']" />
                    </xar:if>
                    <xar:if condition="$taskinfo['date_end_planned'] gt 0">
                        <span class="xar-title"><xar:mlstring> through </xar:mlstring></span>
                        <xar:data-output property="$taskproperties['date_end_planned']" value="$taskinfo['date_end_planned']" />
                    </xar:if>
                </td>
            </tr>
        </xar:if>
        <xar:if condition="$taskinfo['date_start_actual'] gt 0 OR $taskinfo['date_end_actual'] gt 0">
            <tr valign="top">
                <td class="xar-title xar-align-right"><xar:mlstring>Actual Dates</xar:mlstring></td>
                <td class="xar-norm xar-align-left">
                <xar:if condition="$taskinfo['date_start_actual'] gt 0">
                    <xar:data-output property="$taskproperties['date_start_actual']" value="$taskinfo['date_start_actual']" />
                </xar:if>
                    <xar:if condition="$taskinfo['date_end_actual'] gt 0">
                        <span class="xar-title"><xar:mlstring> through </xar:mlstring></span>
                        <xar:data-output property="$taskproperties['date_end_actual']" value="$taskinfo['date_end_actual']" />
                    </xar:if>
                </td>
            </tr>
        </xar:if>
        <tr valign="top">
            <td class="xar-title xar-align-right"><xar:mlstring>Hours</xar:mlstring></td>
            <td class="xar-norm xar-align-left">
                <xar:set name="hours_planned">(float)$taskinfo['hours_planned']</xar:set>
                <xar:if condition="$hours_planned gt 0">
                    <span><xar:mlstring>Planned: </xar:mlstring><xar:data-output property="$taskproperties['hours_planned']" value="$taskinfo['hours_planned']" /></span>
                </xar:if>
                <xar:set name="hours_spent">(float)$taskinfo['hours_spent']</xar:set>
                <xar:if condition="$hours_spent gt 0">
                    <span style="padding-left: 20px;"><xar:mlstring>Spent: </xar:mlstring><xar:data-output property="$taskproperties['hours_spent']" value="$taskinfo['hours_spent']" /></span>
                </xar:if>
                <xar:set name="hours_remaining">(float)$taskinfo['hours_remaining']</xar:set>
                <xar:if condition="$hours_remaining gt 0">
                    <span style="padding-left: 20px;"><xar:mlstring>Remaining: </xar:mlstring><xar:data-output property="$taskproperties['hours_remaining']" value="$taskinfo['hours_remaining']" /></span>
                </xar:if>
            </td>
        </tr>
        <tr valign="top">
            <td class="xar-title xar-align-right"><xar:data-label property="$taskproperties['description']" /></td>
            <td class="xar-norm xar-align-left"><xar:data-output property="$taskproperties['description']" value="$taskinfo['description']" /></td>
        </tr>
    </table>
    
    <h2><xar:mlstring>Log Work Performed</xar:mlstring></h2>
    
    <form method="post" action="&xar-modurl-xtasks-worklog-create;">
    
        <input type="hidden" name="authid" value="#$authid#" />
        <input type="hidden" name="returnurl" value="#$returnurl#" />
        <input type="hidden" name="taskid" value="#$taskid#" />
        
        <table width="100%" border="0" cellspacing="0" cellpadding="2">
            <tr>
                <td><xar:mlstring>Work Date</xar:mlstring></td>
                <td><xar:data-input property="$properties['eventdate']" name="eventdate" value="$currentdate" /></td>
            </tr>
            <tr>
                <td><xar:mlstring>Performed By</xar:mlstring></td>
                <td><xar:data-input property="$properties['ownerid']" name="ownerid" value="$uid" /></td>
            </tr>
            <tr>
                <td><xar:mlstring>Hours Worked</xar:mlstring></td>
                <td><xar:data-input property="$properties['hours']" name="hours" /></td>
            </tr>
            <tr>
                <td><xar:mlstring>Notes</xar:mlstring></td>
                <td><xar:data-input property="$properties['notes']" name="notes" /></td>
            </tr>
            <tr>
                <td colspan="2" align="center"><br /><input type="submit" value="Log" /></td>
            </tr>
        </table>
        
        <input type="hidden" name="authid" id="authid" value="#xarSecGenAuthKey('xtasks')#" />
    
    </form>
</div>

<xar:if condition="is_array($worklog)">
    <xar:template type="module" file="worklog" subdata="array('worklog'=&gt;$worklog)" />
</xar:if>
