<xar:comment> License: GPL http://www.gnu.org/copyleft/gpl.html </xar:comment>
<table border="1" style="margin-right: auto; margin-left: auto; text-align: center;">
    <tr>
        <th><xar:mlstring>Access</xar:mlstring></th>
        <th><xar:mlstring>User</xar:mlstring></th>
        <xar:foreach in="$levels.groups" key="$key" value="$group">
            <th>
                #$groupCache[$key]['name']#<br />
                <xar:if condition="$showRemove AND (isset($user_groups[$key]) OR xarSecurityCheck('AdminPanel', 0))">
                <xar:set name="$args">array('modid' => $modid, 'itemtype' => $itemtype, 'itemid' => $itemid, 'gid' => $key, 'returnurl' => $returnurl)</xar:set>
                (<a href="#xarModURL('security', 'admin', 'deletegroupsecurity', $args)#">remove</a>)
                </xar:if>
            </th>
        </xar:foreach>
        <th><xar:mlstring>World</xar:mlstring></th>
    </tr>
    <xar:foreach in="$secLevels" value="$secLevel">
    <xar:set name="currentLevel">$secLevel['level']</xar:set>
    <xar:set name="userLevel">$secMap['user'][$currentLevel]</xar:set>
    <xar:set name="worldLevel">$secMap['world'][$currentLevel]</xar:set>
    <tr>
        <td>
         <xar:var name="secLevel.label" />
        </td>
        <td>
            <xar:if condition="!empty($userLevel)">
            <xar:if condition="$secLevel['level'] eq SECURITY_READ">
                <input type="checkbox" name="user[]" value="#$secLevel['level']#" checked="checked" disabled="true" />
                <input type="hidden" name="user[]" value="#$secLevel['level']#" />
            <xar:else />
                <input type="checkbox" name="user[]" value="#$secLevel['level']#" checked="checked"  />
            </xar:if>
            <xar:else />
            <input type="checkbox" name="user[]" value="#$secLevel['level']#" />
            </xar:if>
        </td>
        <xar:foreach in="$levels.groups" key="$key" value="$group">
        <xar:set name="groupLevel">$secMap[$key][$currentLevel]</xar:set>
        <td>
            <xar:set name="extra">'disabled="disabled"'</xar:set>
            <xar:if condition="$showRemove AND (isset($user_groups[$key]) OR xarSecurityCheck('AdminPanel', 0))">
                <xar:set name="extra">''</xar:set>
            </xar:if>
            <xar:if condition="!empty($groupLevel)">
            <input type="checkbox" name="groups[#$key#][]" value="#$secLevel['level']#" checked="checked" #$extra# />
            <xar:else />
            <input type="checkbox" name="groups[#$key#][]" value="#$secLevel['level']#"  #$extra# />
            </xar:if>
        </td>
        </xar:foreach>

        <td>
           <xar:if condition="!empty($worldLevel)">
            <input type="checkbox" name="world[]" value="#$secLevel['level']#" checked="checked" />
            <xar:else />
            <input type="checkbox" name="world[]" value="#$secLevel['level']#" />
            </xar:if>
        </td>
    </tr>
    </xar:foreach>
</table>
