<xar:comment>
    Anywhere where we need to display a delta on a file, this template
    should be used. It expects the following variables: ([$vars] are optional)
    [$tag]  : the tag if the delta was in a cset which was tagged
    [$icon] : icon for the file (url to an image really)
    [$checkedout] : boolean which specifies whether the file belonging to the delta is checked out.
    $repoid : id of the repo this delta was in
    $file   : file on which this delta applies
    $author : author of the file
    $rev    : delta revision number
    $age    : age of the delta
</xar:comment>

<div class="xar-norm-outline delta">
    <xar:set name="csetclass">'xar-norm'</xar:set>
    <xar:set name="csettag">''</xar:set>
    <xar:if condition="!empty($tag)">
        <xar:set name="csetclass">'xar-accent'</xar:set>
        <xar:set name="csettag">
            <xar:ml>
                <xar:mlstring> [Tags: #(1)] </xar:mlstring>
                <xar:mlvar>#$tag#</xar:mlvar>
            </xar:ml>
        </xar:set>
    </xar:if>
    <div class="#$csetclass#">
        <div>
            <span>
                <xar:if condition="!isset($icon)">
                    <xar:set name="icon">xarTplGetImage('file.gif','bkview')</xar:set>
                </xar:if>
                <xar:if condition="isset($checkedout) && $checkedout">
                    <xar:set name="titlestring">
                        <xar:ml>
                            <xar:mlstring>Download revision #(1) of #(2)</xar:mlstring>
                            <xar:mlvar>#$rev#</xar:mlvar>
                            <xar:mlvar>#$file#</xar:mlvar>
                        </xar:ml>
                    </xar:set>
                    <a title="#$titlestring#" onclick="return loadContent(this.href);" href="&xar-modurl-bkview-user-downloadfile;&amp;repoid=#$repoid#&amp;file=#$file#&amp;rev=#$rev#">
                        <img class="bkicon" src="#$icon#" alt="file" />
                    </a>
                <xar:else/>
                    <img class="bkicon" src="#$icon#" alt="file" />
                </xar:if>
            </span>
            <xar:set name="filename">basename($file)</xar:set>
            <span style="vertical-align: top;">
                <xar:set name="titlestring">
                    <xar:ml>
                        <xar:mlstring>Show the history of #(1)</xar:mlstring>
                        <xar:mlvar>#$file#</xar:mlvar>
                    </xar:ml>
                </xar:set>
                <a title="#$titlestring#" onclick="return loadContent(this.href);" href="&xar-modurl-bkview-user-historyview;&amp;repoid=#$repoid#&amp;file=#$file#">
                #$filename#</a>
            </span>
        </div>
        <span><xar:mlstring>Delta</xar:mlstring></span>
        <span>
            <xar:set name="titlestring">
                <xar:ml>
                    <xar:mlstring>View annotated contents of #(1) for revision #(2)</xar:mlstring>
                    <xar:mlvar>#$file#</xar:mlvar>
                    <xar:mlvar>#$rev#</xar:mlvar>
                </xar:ml>
            </xar:set>
          <a title="#$titlestring#" onclick="return loadContent(this.href);" href="&xar-modurl-bkview-user-annotateview;&amp;repoid=#$repoid#&amp;file=#$file#&amp;rev=#$rev#">
            #$rev#
          </a> #$csettag#
        </span>
        <span><xar:mlstring>created by</xar:mlstring></span>
        <span>
            <xar:set name="titlestring">
                <xar:ml>
                    <xar:mlstring>Show the changes by #(1)</xar:mlstring>
                    <xar:mlvar>#$author#</xar:mlvar>
                </xar:ml>
            </xar:set>
          <a title="#$titlestring#" onclick="return loadContent(this.href);" href="&xar-modurl-bkview-user-historyview;&amp;repoid=#$repoid#&amp;file=#$file#&amp;user=#$author#">
            #$author#
          </a>
        </span>
        <span>#$age#</span>
        <span><xar:mlstring>ago</xar:mlstring></span>
      </div>
      
      <div class="comments">#$comments#</div>
      
      <div style="text-align: right; font-size: smaller;">
        <a onclick="return loadContent(this.href);"  title="#xarML('View the changeset in which this delta was created')#" href="&xar-modurl-bkview-user-deltaview;&amp;repoid=#$repoid#&amp;rev=#$rev#&amp;file=#$file#">
            <xar:mlstring>Corresponding cset</xar:mlstring></a> | 
        <a  onclick="return loadContent(this.href);" title="#xarML('View differences introduced in this revision')#" href="&xar-modurl-bkview-user-patchview;&amp;repoid=#$repoid#&amp;file=#$file#&amp;rev=#$rev#">
            <xar:mlstring>View differences</xar:mlstring></a> |
        <a  onclick="return loadContent(this.href);" title="#xarML('View other changesets for this file')#" href="&xar-modurl-bkview-user-relatedview;&amp;repoid=#$repoid#&amp;file=#$file#&amp;rev=#$rev#">
            <xar:mlstring>Other changesets</xar:mlstring></a>
            
     </div>
</div>
