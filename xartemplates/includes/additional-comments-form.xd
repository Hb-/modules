<xar:comment> License: GPL http://www.gnu.org/copyleft/gpl.html </xar:comment>
<xar:ajax-lib name="validation" />
<xar:ajax-lib name="effects" />

<fieldset>
    <legend><xar:mlstring>Additional Comments</xar:mlstring></legend>

    <form action="&xar-modurl-helpdesk-user-add_history;" id="add_history" method="POST">
    <xar:if condition="Security::check(SECURITY_WRITE, $module, $itemtype, $itemid, false)">
    <div class="xar-form-input-wrapper">
        <label class="xar-form-label"><xar:mlstring>Status</xar:mlstring></label>
        <select name="status" class="xar-form-textlong">
            <xar:foreach in="$statuses" key="$key" value="$value">
                <xar:if condition="$value['status'] eq $status">
                <option value="#$key#" selected="selected"><xar:var name="value.status" /></option>
                <xar:else />
                <option value="#$key#"><xar:var name="value.status" /></option>
                </xar:if>
            </xar:foreach>
        </select>
    </div>
    </xar:if>

    <xar:if condition="Security::check(SECURITY_MANAGE, $module, $itemtype, $itemid, false)">
        <div class="xar-form-input-wrapper">
            <label class="xar-form-label"><xar:mlstring>Assigned To</xar:mlstring></label>
            <select name="assigned_to" class="xar-form-textlong">
                <xar:foreach in="$assignees" key="$key" value="$value">
                    <xar:if condition="$value['name'] eq $assignedto">
                    <option value="#$value.name#" selected="selected">#xarUserGetVar('name', $value.name)#</option>
                    <xar:else />
                    <option value="#$value.name#">#xarUserGetVar('name', $value.name)#</option>
                    </xar:if>
                </xar:foreach>
            </select>
        </div>
    </xar:if>

    <div class="xar-form-input-wrapper">
        <label class="xar-form-label"><xar:mlstring>Comment</xar:mlstring></label>
        <textarea name="comment" class="xar-form-textarealarge required"></textarea>
    </div>

    <div class="xar-form-input-wrapper-after">
        <input type="hidden" name="itemid" value="#$tid#" />
        <input type="hidden" name="authid" id="authid" value="#xarSecGenAuthKey()#" />
        <input name="add_comment" type="submit" value="#xarML('Commit')#" onclick="return xar_helpdesk_validateQuickHistory(this.form);" />
    </div>
    </form>

</fieldset>
<script type="text/javascript">
new Validation('add_history');
</script>