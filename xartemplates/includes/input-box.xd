<xar:template xmlns:xar="http://xaraya.com/2004/blocklayout">
    <h3>#$input_title#</h3>
    <form id="inputbox" action="#$post_url#" method="post" enctype="multipart/form-data">
        <div class="xar-form-input-wrapper">
            <label class="xar-form-label">
                <xar:mlstring>From:</xar:mlstring>
            </label>
            #xarUserGetVar('name')#
            <!--Psspl:Modifided the code for anonymous message-->
            <xar:if condition="isset($postanon) and $postanon eq 1">
                      <input type="checkbox" name="postanon" id="postanon" checked="checked" value="1"/>
                    <xar:else />
                      <input type="checkbox" name="postanon" id="postanon" value="1" />
                    </xar:if>
                    <xar:mlstring>
                      Post anonymously
                    </xar:mlstring>
        </div>

        <div class="xar-form-input-wrapper">
            <label for="recipient" title="#xarML('To whom the message will be sent')#" class="xar-form-label">
                <xar:mlstring>To:</xar:mlstring>
            </label>
            <xar:if condition="isset($action) and $action ne 'reply' ">
            <select name="recipient" id="recipient">
                <xar:loop name="$users">
                    <xar:if condition="isset($recipient) and $loop:item['id'] eq $recipient">
                        <option value="#$loop:item['id']#" selected="selected">
                            #$loop:item['name']# (#$loop:item['uname']#)
                        </option>
                    <xar:else />
                        <option value="#$loop:item['id']#">
                            #$loop:item['name']# (#$loop:item['uname']#)
                        </option>
                    </xar:if>
                </xar:loop>
            </select>
            </xar:if>
            <xar:if condition="isset($action) and $action eq 'reply' ">
            <xar:if condition="isset($postanon) and $postanon eq 1">
            <xar:mlstring>
                      Anonymous
                </xar:mlstring>
            <xar:else />
            <xar:mlstring>
                    #$recipient_name#
             </xar:mlstring>        
            </xar:if>   
            <input type="hidden" value="#$recipient#" name="recipient" id="recipient" />
            </xar:if>
            <xar:if condition="isset($no_recipient)">
                <span class="xar-error">
                    <xar:mlstring>Missing!</xar:mlstring>
                </span>
            </xar:if>
        </div>

        <div class="xar-form-input-wrapper">
            <label for="subject" title="#xarML('Message subject')#" class="xar-form-label">
                <xar:mlstring>Subject:</xar:mlstring>
            </label>
            <xar:if condition="!empty($subject)">
                <input type="text" name="subject" id="subject" class="xar-form-textxlong" maxlength="85" value="#xarVarPrepForDisplay($subject)#" tabindex="1" />
            <xar:else />
                <input type="text" name="subject" id="subject" class="xar-form-textxlong" maxlength="85" value="" tabindex="1" />
            </xar:if>
            <xar:if condition="isset($no_subject)">
                <span class="xar-error">
                    <xar:mlstring>Missing!</xar:mlstring>
                </span>
            </xar:if>
        </div>

        <div class="xar-form-input-wrapper">
            <label for="body" title="#xarML('Message text')#" class="xar-form-label">
                <xar:mlstring>Message:</xar:mlstring>
            </label>
            <xar:if condition="isset($no_body)">
                <span class="xar-error">
                    <xar:mlstring>Missing!</xar:mlstring>
                </span>
            </xar:if>
            <xar:if condition="isset($body)">
                <textarea cols="" rows="" name="body" id="body" class="xar-form-textarealarge" tabindex="2">#xarVarPrepForDisplay($body)#</textarea>
            <xar:else />
                <textarea cols="" rows="" name="body" id="body" class="xar-form-textarealarge" tabindex="2">&#160;</textarea>
            </xar:if>
        </div>

        <xar:if condition="xarModVars::get('messages','drafts') eq 1">
            <div class="xar-form-input-wrapper-after">
                <xar:if condition="isset($draft) and $draft eq true">
                    <input type="checkbox" name="draft" id="draft" value="1" checked="checked" />
                <xar:else />
                    <input type="checkbox" name="draft" id="draft" value="1" />
                </xar:if>
                <label for="draft" title="#xarML('Save this message to be sent later')#">
                    <xar:mlstring>Save as draft</xar:mlstring>
                </label>
            </div>
        </xar:if>

        <div class="xar-align-center xar-margin-thick">
            <input type="hidden" name="authid" id="authid" value="#xarSecGenAuthKey()#" />
            <xar:if condition="isset($mid)">
                <input type="hidden" name="mid" id="mid" value="#$mid#" />
            </xar:if>
            <xar:if condition="isset($id)">
            <input type="hidden" name="id" id="id" value="#$id#" />
             </xar:if>
            <input type="submit" name="preview" id="preview" value="#xarML('Preview')#" class="xar-margin-thickright" />
            <input type="submit" name="confirm" id="confirm" value="#xarML('Submit')#" class="xar-margin-thickleft" />
        </div>
    </form>
</xar:template>