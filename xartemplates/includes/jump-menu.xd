<div class="ievents-jump-menu">
    <form method="get" action="#xarModURL('ievents','user','view')#">
        <p>
            <xar:data-input name="startday" id="startday" type="6" validation="$lists['daynum']" value="$startday" />
            <xar:data-input name="startmonth" id="startmonth" type="6" validation="$lists['monthshort']" value="$startmonth" />
            <xar:data-input name="startyear" id="startyear" type="6" validation="$lists['yearnum']" value="$startyear" />
            <xar:mlstring>to</xar:mlstring>
            <xar:data-input name="endday" id="endday" type="6" validation="$lists['daynum']" value="$endday" />
            <xar:data-input name="endmonth" id="endmonth" type="6" validation="$lists['monthlong']" value="$endmonth" />
            <xar:data-input name="endyear" id="endyear" type="6" validation="$lists['yearnum']" value="$endyear" />

            <xar:set name="daterangelist">#xarModAPIfunc('ievents','user','params',array('name'=&gt;'daterangelist'))#</xar:set>
            <xar:data-input name="range" id="daterange" type="6" validation="$daterangelist" value="" />

            <xar:set name="calendarlist">#xarModAPIfunc('ievents','user','list_calendars',array('mandatory'=&gt;false))#</xar:set>
            <xar:if condition="!empty($calendarlist) && count($calendarlist) gt 1">
                <xar:data-input name="cid" id="calendar" type="6" validation="$calendarlist" value="$cid" />
            </xar:if>

            <xar:comment>TODO: only include these three hidden values if short URLs are not being used</xar:comment>
            <input type="hidden" name="module" value="ievents" />
            <input type="hidden" name="type" value="user" />
            <input type="hidden" name="func" value="view" />

            <xar:comment>Reset a few values if the jump menu is used</xar:comment>
            <xar:if condition="!empty($startnum)">
                <input type="hidden" name="startnum" value="1" />
            </xar:if>
            <xar:if condition="!empty($numitems) && $numitems ne $default_numitems">
                <input type="hidden" name="numitems" value="#$numitems#" />
            </xar:if>

            <xar:set name="grouplist">array(
                'none' => xarML('No group'),
                'day' => xarML('Daily'),
                'week' => xarML('Weekly'),
                'month' => xarML('Monthly'),
                'year' => xarML('Annual'),
            )</xar:set>
            <xar:data-input name="group" id="group" type="6" validation="$grouplist" value="$group" />

            <input type="submit" value="#xarML('Go')#" />
        </p>

        <xar:comment>The categories are optional</xar:comment>
        <xar:if condition="!empty($categories.basecats)">
            <p>
                <label for="catids_0" id="catids_0_label"><xar:mlstring>Categories:</xar:mlstring></label>
                <xar:loop name="$categories['basecats']" id="basecats">
                    <xar:if condition="!empty($loop:item.catlist)">
                        <select class="ievents-jump-catids" name="catids[]" id="catids_#$loop:index#" multiple="multiple">
                            <optgroup label="#xarVarPrepForDisplay($loop:basecats:item.catname)#">
                            <xar:set name="max_cat_depth">#xarModAPIfunc('ievents','user','params',array('name'=&gt;'max_cat_depth'))#</xar:set>
                            <xar:loop name="$loop:item.catlist">
                                <xar:if condition="$loop:item.level le $max_cat_depth">
                                    <xar:if condition="in_array($loop:item.cid, $catids)">
                                        <option value="#$loop:item.cid#" selected="selected">
                                            #xarVarPrepForDisplay(str_repeat('---', $loop:item.level-1))##xarVarPrepForDisplay($loop:item.name)#
                                        </option>
                                    <xar:else />
                                        <option value="#$loop:item.cid#">
                                            #xarVarPrepForDisplay(str_repeat('---', $loop:item.level-1))##xarVarPrepForDisplay($loop:item.name)#
                                        </option>
                                    </xar:if>
                                </xar:if>
                            </xar:loop>
                            </optgroup>
                        </select>
                    </xar:if>
                </xar:loop>
            
                <span id="crule_1_wrapper">
                    <xar:if condition="$crule eq 'or'">
                        <input type="radio" name="crule" id="crule_1" value="or" checked="checked" />
                    <xar:else />
                        <input type="radio" name="crule" id="crule_1" value="or" />
                    </xar:if>
                    <label for="crule_1" id="crule_1_label"><xar:mlstring>Match <em>any</em> selected category</xar:mlstring></label>
                </span>

                <span id="crule_2_wrapper">
                    <xar:if condition="$crule eq 'and'">
                        <input type="radio" name="crule" id="crule_2" value="and" checked="checked" />
                    <xar:else />
                        <input type="radio" name="crule" id="crule_2" value="and" />
                    </xar:if>
                    <label for="crule_2" id="crule_2_label"><xar:mlstring>Match <em>all</em> selected categories</xar:mlstring></label>
                </span>
            </p>
        </xar:if>

        <xar:comment>Keyword search is optional</xar:comment>
        <xar:if condition="!empty($q_fields)">
            <p>
                <label for="q" id="q_label"><xar:mlstring>Search:</xar:mlstring></label>
                <input type="text" name="q" id="q" value="#xarVarPrepForDisplay($q)#" />
                <input type="submit" value="#xarML('Go')#" />
            </p>
        </xar:if>
    </form>
</div>
