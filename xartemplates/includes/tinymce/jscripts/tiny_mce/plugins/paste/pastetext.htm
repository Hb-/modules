<html>
<head>
<title>{$lang_paste_text_desc}</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
<script language="javascript" type="text/javascript" src="../../tiny_mce_popup.js"></script>
<script language="javascript" type="text/javascript">
<!--
//Ryan Demmer 12/05/2005 (ryandemmer@gmail.com)
//Pretty much a hack of the HTML Source Editor

    tinyMCE.setWindowArg('mce_windowresize', false);

    function saveContent() {
        if (window.opener) {
            if (document.forms[0].htmlSource.value == ''){
              window.close();
              return false;
            } else
                content = document.forms[0].htmlSource.value;

				if (document.forms[0].linebreaks.checked) {
					// Special paragraph treatment
					if (tinyMCE.getParam("plaintext_create_paragraphs", true)) {
						content = tinyMCE.regexpReplace(content, "\r\n\r\n", "</p><p>", "gi");
						content = tinyMCE.regexpReplace(content, "\r\r", "</p><p>", "gi");
						content = tinyMCE.regexpReplace(content, "\n\n", "</p><p>", "gi");

						// Has paragraphs
						if ((pos = content.indexOf('</p><p>')) != -1) {
							window.opener.tinyMCE.execCommand("Delete");

							var node = tinyMCE.selectedInstance.getFocusElement();

							// Get list of elements to break
							var breakElms = new Array();
							do {
								if (node.nodeType == 1) {
									// Don't break tables and break at body
									if (node.nodeName == "TD" || node.nodeName == "BODY")
										break;

									breakElms[breakElms.length] = node;
								}
							} while(node = node.parentNode);

							var before = "", after = "</p>";

							before += content.substring(0, pos);

							for (var i=0; i<breakElms.length; i++) {
								before += "</" + breakElms[i].nodeName + ">";
								after += "<" + breakElms[(breakElms.length-1)-i].nodeName + ">";
							}

							before += "<p>";

							content = before + content.substring(pos+7) + after;
						}
					}

					content = tinyMCE.regexpReplace(content, "\r\n", "<br />", "gi");
					content = tinyMCE.regexpReplace(content, "\r", "<br />", "gi");
					content = tinyMCE.regexpReplace(content, "\n", "<br />", "gi");
				}

			    window.opener.tinyMCE.execCommand("mceInsertRawHTML", true, content);
                window.close();
        }
    }

    function onLoadInit() {
        resizeInputs();
        setWrap('off');
    }

    function setWrap(val) {
        // hard soft off
        document.forms[0].htmlSource.wrap = val;
    }

	function toggleWordWrap(elm) {
		if (elm.checked)
			setWrap('soft');
		else
			setWrap('off');
	}

    var wHeight=0, wWidth=0, owHeight=0, owWidth=0;

    function resizeInputs() {
        if (!tinyMCE.isMSIE) {
             wHeight = self.innerHeight-80;
             wWidth = self.innerWidth-25;
        } else {
             wHeight = document.body.clientHeight-80;
             wWidth = document.body.clientWidth-25;
        }

        document.forms[0].htmlSource.style.height = Math.abs(wHeight) + 'px';
        document.forms[0].htmlSource.style.width  = Math.abs(wWidth) + 'px';
    }

    window.focus();
//-->
</script>
</head>
<body scroll="no" onload="onLoadInit();" onresize="resizeInputs();">
<form name="source" onsubmit="saveContent();">
    <table border="0" cellpadding="0" cellspacing="2" align="center">
        <tr>
            <td valign="top">{$lang_paste_text_title}</td>
            <td align="left" nowrap="nowrap">
			<input type="checkbox" name="linebreaks" id="linebreaks" class="wordWrapCode" checked="checked" /><label for="linebreaks">{$lang_paste_text_linebreaks}</label><br />
<script language="javascript" type="text/javascript">
<!--
    if (tinyMCE.isMSIE) {
        document.write('<input type="checkbox" name="wraped" id="wraped" onclick="toggleWordWrap(this);" class="wordWrapCode" /><label for="wraped">{$lang_theme_code_wordwrap}</label>');
    }
//-->
            </script>
			</td>
        </tr>
        <tr>
            <td colspan="2" align="center">
                <textarea name="htmlSource" id="htmlSource" rows="15" cols="100" style="width: 100%; height: 100%; font-family: 'Courier New',Courier,mono; font-size: 12px;" dir="ltr" wrap="soft"></textarea>
            </td>
        </tr>
        <tr>
            <td colspan="2" align="right"><input type="button" id="insert" name="insert" value="{$lang_insert}" onclick="saveContent();" />&nbsp;&nbsp;&nbsp;<input type="button" id="cancel" name="cancel" value="{$lang_cancel}" onclick="window.close();" /></td>
        </tr>
    </table>
</form>
</body>
</html>
