<xar:comment> License: GPL http://www.gnu.org/copyleft/gpl.html </xar:comment>



<xar:set name="width">100/(count($secLevels)+1)</xar:set>
<table width="100%" class="xar-norm-outline">
    <tr>
        <th>User</th>
        <xar:foreach in="$secLevels" key="$key" value="$level">
            <th width="#$width#%">#$level.label#</th>
        </xar:foreach>
    </tr>
    <xar:set name="count">0</xar:set>
    <xar:foreach in="$security" key="$role_id" value="$user_sec">
        <xar:if condition="$count % 2 eq 0">
            <xar:set name="class">'xar-norm'</xar:set>
        <xar:else />
            <xar:set name="class">'xar-alt'</xar:set>
        </xar:if>
        <tr class="#$class#">
            <xar:if condition="$role_id eq 0">
                <td><xar:mlstring>Everybody</xar:mlstring></td>
            <xar:else />
                <td>#$user_sec.username#</td>
            </xar:if>
            <xar:foreach in="$user_sec.levels" key="$key" value="$level">
                <td>
                    <xar:if condition="$level eq 0">
                        <input type="checkbox" name="#$key#[#$role_id#]" value="1" />
                    <xar:else />
                        <input type="checkbox" name="#$key#[#$role_id#]" value="1" checked="checked" />
                    </xar:if>
                </td>
            </xar:foreach>
        </tr>
        <xar:set name="count">$count+1</xar:set>
    </xar:foreach>
</table>

<xar:comment>
<table border="1" style="margin-right: auto; margin-left: auto;" class="xar-align-center">
    <tr>
        <th><xar:mlstring>Access</xar:mlstring></th>
        <th><xar:mlstring>User</xar:mlstring></th>
        <xar:foreach in="$levels" key="$key" value="$group">
            <xar:if condition="isset($all_groups[$key])">
            <th>
                #$all_groups[$key]['name']#
                <xar:comment>
                <xar:if condition="$show_remove AND (isset($user_groups[$key]) OR xarSecurityCheck('AdminPanel', 0))">
                <br /> (<a href="#xarModURL('security', 'admin', 'deletegroupsecurity')#">remove</a>)
                </xar:if>
                </xar:comment>
            </th>
            </xar:if>
        </xar:foreach>
        <th><xar:mlstring>World</xar:mlstring></th>
    </tr>
    <xar:foreach in="$sec_levels" value="$sec_level">
    <xar:set name="currentLevel">$sec_level['name']</xar:set>
    <xar:set name="userLevel">$sec_map['user'][$currentLevel]</xar:set>
    <xar:set name="worldLevel">$sec_map[0][$currentLevel]</xar:set>
    <tr>
        <td>
         <xar:var name="$sec_level.label" />
        </td>
        <td>
            <xar:if condition="!empty($userLevel)">
            <xar:if condition="$sec_level['level'] eq SECURITY_READ">
                <input type="checkbox" name="#$currentLevel#[user]" value="#$sec_level['level']#" checked="checked" disabled="true" />
                <input type="hidden" name="#$currentLevel#[user]" value="#$sec_level['level']#" />
            <xar:else />
                <input type="checkbox" name="#$currentLevel#[user]" value="#$sec_level['level']#" checked="checked"  />
            </xar:if>
            <xar:else />
                <input type="checkbox" name="#$currentLevel#[user]" value="#$sec_level['level']#" />
            </xar:if>
        </td>

        <xar:foreach in="$levels" key="$key" value="$group">
        <xar:if condition="isset($all_groups[$key])">
        <xar:set name="groupLevel">$sec_map[$key][$currentLevel]</xar:set>
        <td>
            <xar:set name="extra">'disabled="disabled"'</xar:set>
            <xar:if condition="$show_remove AND (isset($user_groups[$key]) OR xarSecurityCheck('AdminPanel', 0))">
                <xar:set name="extra">''</xar:set>
            </xar:if>
            <xar:if condition="!empty($groupLevel)">
                <input type="checkbox" name="#$currentLevel#[#$key#]" value="#$sec_level['level']#" checked="checked" #$extra# />
            <xar:else />
                <input type="checkbox" name="#$currentLevel#[#$key#]" value="#$sec_level['level']#"  #$extra# />
            </xar:if>
        </td>
        </xar:if>
        </xar:foreach>

        <td>
           <xar:if condition="!empty($worldLevel)">
                <input type="checkbox" name="#$currentLevel#[0]" value="#$sec_level['level']#" checked="checked" />
            <xar:else />
                <input type="checkbox" name="#$currentLevel#[0]" value="#$sec_level['level']#" />
            </xar:if>
        </td>
    </tr>
    </xar:foreach>
</table>
</xar:comment>