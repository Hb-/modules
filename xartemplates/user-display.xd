<xar:comment> License: GPL http://www.gnu.org/copyleft/gpl.html </xar:comment>
<script type="text/javascript" src="modules/xtasks/xartemplates/includes/spinner.js"></script>
<xar:set name="projects_objectid">xarModGetVar('xproject','projects_objectid')</xar:set>
<xar:data-getitem name="$properties" module="xProject" itemtype="1" itemid="$projects_objectid" />

<div class="xar-mod-body">
    <h2 style="text-align: center;">#$project_name#</h2>

    <div style="text-align: center;">
    <xar:if condition="!empty($project_link)">
        [ <a href="#$project_link#"><xar:mlstring>manage project</xar:mlstring></a> ]
    </xar:if>
    </div>
    
    <div>
        <xar:if condition="!empty($status)">
            <h3>#$status#</h3>
        <xar:else />
            <div class="xar-norm">
                <xar:data-output property="$properties['description']" value="$item['description']" />
            </div>
            <div class="xar-sub">
                <xar:set name="planned_start_date">$item['planned_start_date']</xar:set>
                <xar:set name="planned_end_date">$item['planned_end_date']</xar:set>
                
                <xar:if condition="!empty($planned_start_date) or !empty($planned_end_date)">
                    <br><em><xar:mlstring>Planned Timeframe:</xar:mlstring></em>
                    <xar:if condition="!empty($planned_start_date)">
                        <xar:mlstring> from </xar:mlstring><strong><xar:data-output property="$properties['planned_start_date']" value="$planned_start_date" dateformat="%a, %d %B %Y" /></strong>
                    </xar:if>
                    <xar:if condition="!empty($planned_end_date)">
                        <xar:mlstring> thru </xar:mlstring><strong><xar:data-output property="$properties['planned_end_date']" value="$planned_end_date" dateformat="%a, %d %B %Y" /></strong>
                    </xar:if>
                </xar:if>
                
                <xar:set name="hours_planned">$item['hours_planned']</xar:set>
                <xar:set name="hours_spent">$item['hours_spent']</xar:set>
                <xar:set name="hours_remaining">$item['hours_remaining']</xar:set>
                
                <xar:set name="ttlhours">$hours_planned + $hours_remaining</xar:set>
                <xar:if condition="$ttlhours gt 0">
                    <xar:set name="pct_complete">sprintf("%.2f", 100 * $hours_spent / $ttlhours)</xar:set>
                <xar:else />
                    <xar:set name="pct_complete">"0"</xar:set>
                </xar:if>
                <xar:if condition="$hours_planned gt 0">
                    <xar:set name="pct_variance">sprintf("%.2f", 100 * ($hours_remaining + $hours_spent) / $hours_planned)</xar:set>
                <xar:else />
                    <xar:set name="pct_variance">"0"</xar:set>
                </xar:if>
                <br>#$pct_complete#% Complete of #$ttlhours# Hours (#$pct_variance#% variance)
                
                <xar:if condition="$pct_variance lt 100">
                    <xar:set name="progress_color">"#000099"</xar:set>
                <xar:else />
                    <xar:set name="progress_color">"#990000"</xar:set>
                </xar:if>
                
                <xar:if condition="$pct_complete lt 100">
                    <xar:set name="int_pct_complete">sprintf("%.0f", $pct_complete)</xar:set>
                    <div style="border: 1px solid black; width: 100%; height: 5px; padding: 2px;">
                        <div style="background-color: #$progress_color#; width: #$int_pct_complete#%; height: 5px;"></div>
                    </div>
                <xar:else />
                    <xar:set name="pct_of_complete">sprintf("$.0f", $pct_complete * $ttlhours)</xar:set>
                    <div style="border: 1px solid black; width: #$pct_of_complete#%; height: 5px;">
                        <div style="background-color: #$progress_color#; width: 100%; height: 5px;"></div>
                    </div>
                </xar:if>
            </div>
            
            <div id="project_features">
                <xar:template type="module" file="features-overview" />
            </div>
        </xar:if>
    </div>
</div>

