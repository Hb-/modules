<xar:comment> License: GPL http://www.gnu.org/copyleft/gpl.html </xar:comment>

<xar:set name="xtasks_objectid">xarModGetVar('xtasks','xtasks_objectid')</xar:set>
<xar:data-getitem name="$properties" module="xTasks" itemtype="1" itemid="$xtasks_objectid" />

<script language="javascript">
function xtaskToggleView(id){
    var el = document.getElementById(id);
    if(el.style.display != 'none'){
        el.style.display = 'none';
    }
    else{
        el.style.display = 'table';
    }
}
</script>

<div class="xar-mod-head">
	<span class="xar-mod-title"><xar:mlstring>xTasks</xar:mlstring></span>
</div>
<div class="xar-mod-body">

    <h2><xar:mlstring>View Task</xar:mlstring></h2>

	<xar:template type="module" file="admin-menu" />

    <xar:if condition="!empty($status)">
	    <div align="center">
            #$status#
		</div>
    </xar:if>


	<p>[ 
		<xar:if condition="empty($item['editurl'])">
			<xar:mlstring>Edit</xar:mlstring>
		<xar:else />
			<a href="#$item['editurl']#"><xar:mlstring>Edit</xar:mlstring></a>
		</xar:if>
		&nbsp;|&nbsp;
		<xar:if condition="empty($item['deleteurl'])">
			<xar:mlstring>Delete</xar:mlstring>
		<xar:else />
			<a href="#$item['deleteurl']#"><xar:mlstring>Delete</xar:mlstring></a>
		</xar:if>
	]</p>

	<dl class="xtasks-display">
	    <dt class="xar-form-label">
	        <xar:data-label property="$properties['task_name']" />
	    </dt>
		<dd>
	    	<xar:data-output property="$properties['task_name']" value="$item['task_name']" />
		</dd>

        <xar:if condition="!empty($parentname)">
		    <dt class="xar-form-label">
		        <xar:mlstring>Parent Task</xar:mlstring>
		    </dt>
			<dd>
				<xar:if condition="empty($parenturl)">
					#$parentname#
				<xar:else />
					<a href="#$parenturl#">#$parentname#</a>
				</xar:if>
			</dd>
        </xar:if>

	    <dt class="xar-form-label">
			<xar:data-label property="$properties['status']" />
		</dt>
	    <dd>
			<xar:data-output property="$properties['status']" value="$item['status']" />
		</dd>

	    <dt class="xar-form-label">
	        <xar:data-label property="$properties['private']" />
		</dt>
		<dd>
	        <xar:data-output property="$properties['private']" value="$item['private']" />
		</dd>

	    <dt class="xar-form-label">
			<xar:data-label property="$properties['priority']" />
		</dt>
	    <dd>
			<xar:data-output property="$properties['priority']" value="$item['priority']" />
		</dd>

	    <dt class="xar-form-label">
	        <xar:data-label property="$properties['importance']" />
		</dt>
		<dd>
	        <xar:data-output property="$properties['importance']" value="$item['importance']" />
		</dd>

	    <xar:if condition="$item['date_approved'] gt 0">
		    <dt class="xar-form-label">
				<xar:data-label property="$properties['date_approved']" />
			</dt>
		    <dd>
				<xar:data-output property="$properties['date_approved']" value="$item['date_approved']" />
			</dd>
		</xar:if>

	    <xar:if condition="$item['date_start_planned'] gt 0 OR $item['date_end_planned'] gt 0">
		    <dt class="xar-form-label">
				<xar:mlstring>Planned Timeframe</xar:mlstring>
			</dt>
	        <dd>
	            <xar:if condition="$item['date_start_planned'] gt 0">
	                <xar:data-output property="$properties['date_start_planned']" value="$item['date_start_planned']" />
	            </xar:if>
	            <xar:if condition="$item['date_end_planned'] gt 0">
	                <span style="font-weight: bold;"><xar:mlstring> through </xar:mlstring></span>
	                <xar:data-output property="$properties['date_end_planned']" value="$item['date_end_planned']" />
	            </xar:if>
	        </dd>
	    </xar:if>

	    <xar:if condition="$item['date_start_actual'] gt 0 OR $item['date_end_actual'] gt 0">
	        <dt class="xar-form-label">
				<xar:mlstring>Actual Dates</xar:mlstring>
			</dt>
	        <dd>
	            <xar:if condition="$item['date_start_actual'] gt 0">
	                <xar:data-output property="$properties['date_start_actual']" value="$item['date_start_actual']" />
	            </xar:if>
	            <xar:if condition="$item['date_end_actual'] gt 0">
	                <span style="font-weight: bold;"><xar:mlstring> through </xar:mlstring></span>
	                <xar:data-output property="$properties['date_end_actual']" value="$item['date_end_actual']" />
	            </xar:if>
	        </dd>
	    </xar:if>

	    <dt class="xar-form-label">
			<xar:mlstring>Hours</xar:mlstring>
		</dt>
	    <dd>
	        <xar:set name="hours_planned">(float)$item['hours_planned']</xar:set>
	        <xar:if condition="$hours_planned gt 0">
	            <span style="font-weight: bold;"><xar:mlstring>Planned: </xar:mlstring></span>
				<xar:data-output property="$properties['hours_planned']" value="$item['hours_planned']" />
	        </xar:if>

	        <xar:set name="hours_spent">(float)$item['hours_spent']</xar:set>
	        <xar:if condition="$hours_spent gt 0">
				<span style="font-weight: bold;margin-left: 3em;">
					<xar:mlstring>Spent: </xar:mlstring>
				</span>
				<xar:data-output property="$properties['hours_spent']" value="$item['hours_spent']" />
				</span>
	        </xar:if>

	        <xar:set name="hours_remaining">(float)$item['hours_remaining']</xar:set>
	        <xar:if condition="$hours_remaining gt 0">
	            <span style="font-weight: bold;margin-left: 3em;">
					<xar:mlstring>Remaining: </xar:mlstring>
				</span>
				<xar:data-output property="$properties['hours_remaining']" value="$item['hours_remaining']" />
	        </xar:if>
	    </dd>

	    <dt class="xar-form-label">
			<xar:data-label property="$properties['description']" />
		</dt>
	    <dd style="display: block;">
			<xar:data-output property="$properties['description']" value="$item['formatted_desc']" />
		</dd>
	</dl>

    <xar:if condition="!empty($hooks)">
		<div>
            <xar:if condition="!isset($mode)">
                <xar:set name="mode">""</xar:set>
            </xar:if>
            <xar:foreach in="$hooks" key="$hookmodule">
                <xar:if condition="trim($hookmodule) eq 'xtasks'">

                    <xar:if condition="$mode eq 'tasks'">
                        <xar:set name="tasks_style">"display: block;"</xar:set>
                    <xar:else />
                        <xar:set name="tasks_style">"display: none;"</xar:set>
                    </xar:if>
                    
                    <xar:set name="returnurl">urlencode(xarServerGetCurrentURL())</xar:set>
                    <xar:set name="newargs">"&amp;inline=1&amp;returnurl=".$returnurl</xar:set>

                    <xar:if condition="isset($parentid)">
                        <xar:set name="newargs">$newargs."&amp;parentid=".$parentid</xar:set>
                    </xar:if>
                    
                    <xar:if condition="isset($objectid)">
                        <xar:set name="newargs">$newargs."&amp;objectid=".$objectid</xar:set>
                    </xar:if>

                    <xar:if condition="isset($modid)">
                        <xar:set name="newargs">$newargs."&amp;modid=".$modid</xar:set>
                    </xar:if>

                    <xar:if condition="isset($itemtype)">
                        <xar:set name="newargs">$newargs."&amp;itemtype=".$itemtype</xar:set>
                    </xar:if>
                    
                    <xar:set name="xtasks_modid">xarModGetIDFromName('xtasks')</xar:set>

                    <xar:if condition="$modid eq $xtasks_modid and $itemtype eq 1">
                        <xar:set name="newargs">$newargs."&amp;parentid=".$objectid</xar:set>
                    </xar:if>
                    
                    <a name="tasklist"></a>
                    
					<h2>
						<xar:mlstring>Sub-Tasks</xar:mlstring>
						<a href="javascript: void twist('project_tasks');" title="#xarML('Toggle Sub-task Display')#" class="xtasks-twist"><img src="modules/xtasks/xarimages/rotate.gif" alt="" /></a>
					</h2>

					<p>
						[ <a href="&xar-modurl-xtasks-admin-new;#$newargs#" onclick="twist_open('project_tasks'); return loadContent(this.href,'newtaskform')"><xar:mlstring>Add Sub-Task</xar:mlstring></a> ]
					</p>

                    <div style="#$tasks_style#" id="project_tasks">
						#$hooks[$hookmodule]#
					</div>
                <xar:elseif condition="trim($hooks[$hookmodule]) ne ''" />
                    <div>
						#$hooks[$hookmodule]#
					</div>
                </xar:if>
            </xar:foreach>
		</div>
    </xar:if>
</div>
