<xar:template xmlns:xar="http://xaraya.com/2004/blocklayout">
<div class="xar-mod-head"><span class="xar-mod-title"><xar:mlstring>Workflow Administration</xar:mlstring></span></div>
<script type="text/javascript">
<![CDATA[
function setSomeElement(elemID, toInsert) {
   var elem = document.getElementById(elemID);

   if(typeof elem.selectionStart != 'undefined') {
       var start = elem.selectionStart;
       var end   = elem.selectionEnd;
       elem.value = elem.value.substr(0, start) + toInsert + elem.value.substr(end);
       elem.selectionStart = start + toInsert.length;
       elem.selectionEnd = end + toInsert.length;
   }
   elem.focus();
}

function keypresshandler(elemID,event)
{
    var tabKey = 9;
    if (event.keyCode == tabKey && elemID=="src") { // to be sure we dont disable tabs on anything but the src for now
      setSomeElement(elemID,"    ");
      event.returnValue = false;
      return false;
    }
    return true;
}
]]>
</script>
<div class="xar-mod-body">
    <xar:template module="workflow" type="module" file="admin-menu" />
    <!-- Process navigation bar -->
    <xar:template file="proc_bar"/>

  <form id='editsource' action="#xarModURL('workflow','admin','shared_source')#" method="post">

    <fieldset>
     <legend><xar:mlstring>Admin process sources</xar:mlstring></legend>
          <div class="xar-form-input-wrapper-before">
              <label class="xar-form-label">
                  <xar:mlstring>Activity: </xar:mlstring>
              </label>
              <select name="activityId" onchange="document.getElementById('editsource').submit();">
              <xar:if condition="$activityId eq 0">
                  <option value="" selected="selected"><xar:mlstring>Shared code</xar:mlstring></option>
              <xar:else/>
                  <option value=""><xar:mlstring>Shared code</xar:mlstring></option>
              </xar:if>

              <xar:foreach in="$items" key="$ix">
              <xar:if condition="$activityId eq $items[$ix]['activityId']">
                <option value="#$items[$ix]['activityId']#" selected="selected">#$items[$ix]['name']#</option>
                <xar:else/>
                <option value="#$items[$ix]['activityId']#">#$items[$ix]['name']#</option>
              </xar:if>
              </xar:foreach>
              </select>
        </div>
       <div class="xar-form-input-wrapper-before">
          <xar:if condition="$activityId gt 0 and $act_info['isInteractive'] eq 'y' and $template eq 'n'">
            <input type="submit" name='template' value="#xarML('Switch to template')#" />
          </xar:if>
          <xar:if condition="$activityId gt 0 and $act_info['isInteractive'] eq 'y' and $template eq 'y'">
            <input type="submit" name='save' value="#xarML('Switch to code')#" />
          </xar:if>
          &#160;
        </div>
         <div class="xar-form-input-wrapper-before">
           <!--
               This is the area where templating and code is editted
           -->
           <textarea style="font-family: monospace; white-space: pre; width: 100%" id='src' name="source" rows="20" cols="80" onkeypress="return keypresshandler(this.id,event);">#$data#</textarea>
           <!--
               End of it
           -->
         </div>
         <div class="xar-form-input-wrapper-before">
               <p>
                <strong><xar:mlstring>Function wizard: </xar:mlstring></strong>
                <xar:if condition="$template != 'y'">
                  <a href="javascript:setSomeElement('src','$instance->setNextUser(&#39;&#39;);');"><xar:mlstring>Set next user</xar:mlstring></a> &#160;
                  <a href="javascript:setSomeElement('src','$instance->get(&#39;&#39;);');"><xar:mlstring>Get property</xar:mlstring></a>&#160;
                  <a href="javascript:setSomeElement('src','$instance->set(&#39;&#39;,&#39;&#39;);');"><xar:mlstring>Set property</xar:mlstring></a>&#160;
                  <xar:if condition="$act_info['isInteractive'] eq 'y'">
                    <a href="javascript:setSomeElement('src','$instance->complete();');"><xar:mlstring>Complete</xar:mlstring></a>&#160;
                    <a href="javascript:setSomeElement('src','if(isset($_REQUEST[&#39;save&#39;]){\n  $instance->complete();\n}');"><xar:mlstring>Process form</xar:mlstring></a>&#160;
                  </xar:if>
                  <xar:if condition="$act_info['type'] eq 'switch'">
                    <a href="javascript:setSomeElement('src','$instance->setNextActivity(&#39;&#39;);');"><xar:mlstring>Set Next act</xar:mlstring></a>&#160;
                    <a href="javascript:setSomeElement('src','if(true) {\n    $instance->setNextActivity(&#39;&#39;);\n}');"><xar:mlstring>If:SetNextact</xar:mlstring></a>&#160;
                    <a href="javascript:setSomeElement('src','switch($instance->get(&#39;&#39;)){\n  case:&#39;&#39;:\n  $instance->setNextActivity(&#39;&#39;);\n  break;\n}');"><xar:mlstring>Switch construct</xar:mlstring></a>&#160;
                  </xar:if>
                </xar:if>
                </p>
            </div>
        </fieldset>
         <div class="xar-form-input-wrapper-after">
            <input type="hidden" name="pid" value="#$pid#" />
            <input type="hidden" name="source_name" value="#$source_name#" />
            <input type="submit" name='save' value="#xarML('Save')#" />
            <input type="submit" name='cancel' value="#xarML('Cancel')#" />
        </div>
  </form>
  <!-- Show a courtesy footer -->
  <xar:template file="galaxfooter"/>
</div>


</xar:template>
