<xar:comment> License: GPL http://www.gnu.org/copyleft/gpl.html </xar:comment>
<xar:base-include-javascript position="body" module="xtasks" filename="spinner.js" />
<xar:base-include-javascript position="head" module="base" filename="calendar.js" />
<xar:set name="projects_objectid">xarModGetVar('xproject','projects_objectid')</xar:set>
<xar:data-getitem name="$properties" module="xProject" itemtype="1" itemid="$projects_objectid" />
<xar:style scope="module" file="xproject" />

<xar:set name="id_list">array()</xar:set>
<xar:set name="id_list[]">$projectid</xar:set>
<xar:data-getitems name="$moreproperties" value="$values" module="xProject" itemtype="0" itemid="$id_list" />


<xar:set name="websiteprojecttype">xarModGetUserVar('xproject', 'websiteprojecttype')</xar:set>

<div class="xar-mod-body">
    <h2 style="text-align: center;">#$project_name#</h2>
    
    <xar:if condition="!empty($status)">

        <h3>#$status#</h3>
    <xar:else />
        <xar:blockgroup name="toxarav" id="toxarav" />
        <table width="100%" border="0" cellspacing="1" cellpadding="2" id="xproject_info" class="xproject-proposal">
            <tr valign="top">
                <td class="xproject-proposal-label"><xar:data-label property="$properties['project_name']" /></td>
                <td class="xproject-proposal-data" style="width: 70%;"><xar:data-output property="$properties['project_name']" value="$item['project_name']" /></td>
            </tr>
            <xar:if condition="isset($values[$projectid])">
                <xar:foreach in="$values[$projectid]" key="$field" value="$nextvalue" >
                    <xar:if condition="!empty($values[$projectid][$field])">
                        <tr valign="top">
                            <td class="xproject-proposal-label"><xar:data-label property="$moreproperties[$field]" /></td>
                            <td class="xproject-proposal-data"><xar:data-output property="$moreproperties[$field]" value="$values[$projectid][$field]" /></td>
                        </tr>
                    </xar:if>
                </xar:foreach>
            </xar:if>
            <xar:if condition="!empty($item['reference'])">
                <tr valign="top">
                    <td class="xproject-proposal-label"><xar:data-label property="$properties['reference']" /></td>
                    <td class="xproject-proposal-data"><xar:data-output property="$properties['reference']" value="$item['reference']" /></td>
                </tr>
            </xar:if>
            <tr>
                <td class="xproject-proposal-label"><xar:data-label property="$properties['clientid']" /></td>
                <td class="xproject-proposal-data"><xar:data-output property="$properties['clientid']" value="$item['clientid']" /></td>
            </tr>
            <tr>
                <td class="xproject-proposal-label"><xar:data-label property="$properties['ownerid']" /></td>
                <td class="xproject-proposal-data"><xar:data-output property="$properties['ownerid']" value="$item['ownerid']" /></td>
            </tr>
            <tr>
                <td class="xproject-proposal-label"><xar:mlstring>Team</xar:mlstring></td>
                <td class="xproject-proposal-data">
                    <xar:foreach in="$teamlist" value="$memberinfo" >
                        <div>#$memberinfo.membername#
                            <xar:if condition="!empty($memberinfo.projectrole)">
                                - <em>#$memberinfo.projectrole#</em>
                            </xar:if>
                        </div>
                    </xar:foreach>
                </td>
            </tr>
            <tr valign="top">
                <td class="xproject-proposal-label"><xar:data-label property="$properties['projecttype']" /></td>
                <td class="xproject-proposal-data"><xar:data-output property="$properties['projecttype']" value="$item['projecttype']" /></td>
            </tr>
            <xar:if condition="!empty($item['date_approved'])">
                <tr valign="top">
                    <td class="xproject-proposal-label"><xar:data-label property="$properties['date_approved']" /></td>
                    <td class="xproject-proposal-data"><xar:data-output property="$properties['date_approved']" value="$item['date_approved']" /></td>
                </tr>
            </xar:if>
            <tr valign="top">
                <td class="xproject-proposal-label"><xar:mlstring>Timeframe/Progress</xar:mlstring></td>
                <td class="xproject-proposal-data">
                    <xar:set name="planned_start_date">$item['planned_start_date']</xar:set>
                    <xar:set name="planned_end_date">$item['planned_end_date']</xar:set>
                    <xar:set name="actual_start_date">$item['actual_start_date']</xar:set>
                    <xar:set name="actual_end_date">$item['actual_end_date']</xar:set>
                    
                    <xar:if condition="!empty($planned_start_date) or !empty($planned_end_date)">
                        <div>
                        <em><xar:mlstring>Planned Timeframe:</xar:mlstring></em>
                        <xar:if condition="!empty($planned_start_date)">
                            <xar:mlstring> from </xar:mlstring><strong><xar:data-output property="$properties['planned_start_date']" value="$planned_start_date" dateformat="%a, %d %B %Y" /></strong>
                        </xar:if>
                        <xar:if condition="!empty($planned_end_date)">
                            <xar:mlstring> thru </xar:mlstring><strong><xar:data-output property="$properties['planned_end_date']" value="$planned_end_date" dateformat="%a, %d %B %Y" /></strong>
                        </xar:if>
                        </div>
                    </xar:if>
                    
                    <xar:if condition="!empty($actual_start_date) or !empty($actual_end_date)">
                        <div>
                        <em><xar:mlstring>Actual Timeframe:</xar:mlstring></em>
                        <xar:if condition="!empty($actual_start_date)">
                            <xar:mlstring> from </xar:mlstring><strong><xar:data-output property="$properties['actual_start_date']" value="$actual_start_date" dateformat="%a, %d %B %Y" /></strong>
                        </xar:if>
                        <xar:if condition="!empty($actual_end_date)">
                            <xar:mlstring> thru </xar:mlstring><strong><xar:data-output property="$properties['actual_end_date']" value="$actual_end_date" dateformat="%a, %d %B %Y" /></strong>
                        </xar:if>
                        </div>
                    </xar:if>
                    
                    <xar:set name="hours_planned">$item['hours_planned']</xar:set>
                    <xar:set name="hours_spent">$item['hours_spent']</xar:set>
                    <xar:set name="hours_remaining">$item['hours_remaining']</xar:set>
                    
                    <xar:set name="ttlhours">$hours_planned + $hours_remaining</xar:set>
                </td>
            </tr>
            <xar:if condition="$item['hours_planned'] gt 0">
                <tr valign="top">
                    <td class="xproject-proposal-label"><xar:mlstring>Project Hours</xar:mlstring></td>
                    <td class="xproject-proposal-data">
                        <span style="padding-right: 10px;"><xar:mlstring>Planned</xar:mlstring>: <xar:data-output property="$properties['hours_planned']" value="$item['hours_planned']" /></span>
                    </td>
                </tr>
            </xar:if>
            <tr valign="top">
                <td class="xproject-proposal-label"><xar:mlstring>Budget</xar:mlstring></td>
                <td class="xproject-proposal-data">
                    <xar:if condition="$item['estimate'] gt 0">
                        <span style="padding-right: 10px;"><xar:mlstring>Estimated</xar:mlstring>: $<xar:data-output property="$properties['estimate']" value="$item['estimate']" /></span>
                    </xar:if>
                </td>
            </tr>
            <xar:if condition="!empty($item['formatted_desc'])">
                <tr valign="top">
                    <td class="xproject-proposal-label"><xar:data-label property="$properties['description']" /></td>
                    <td class="xproject-proposal-data"><xar:data-output property="$properties['description']" value="$item['formatted_desc']" /></td>
                </tr>
            </xar:if>
        </table>
        
        <div class="xar-mod-head" style="height: 22px;"><span class="xar-mod-title" style="float: left;"><xar:mlstring>Project Features</xar:mlstring></span></div>
        <div id="project_features">
            <xar:template type="module" file="features-print" />
        </div>
        
        <xar:set name="websiteprojecttype">xarModGetVar('xproject', 'websiteprojecttype')</xar:set>
        <xar:if condition="$websiteprojecttype eq $item.projecttype">
            <div class="xar-mod-head" style="height: 22px;"><span class="xar-mod-title" style="float: left;"><xar:mlstring>Project Pages</xar:mlstring></span></div>
            <div id="project_pages">
                <xar:template type="module" file="pages-print" />
            </div>
        </xar:if>
        
    </xar:if>
</div>

