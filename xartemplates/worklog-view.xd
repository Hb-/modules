<xar:set name="worklog_objectid">xarModGetVar('xtasks','worklog_objectid')</xar:set>
<xar:data-getitem name="$properties" module="xtasks" itemtype="2" itemid="$worklog_objectid" />
<xar:set name="projects_objectid">xarModGetVar('xproject','projects_objectid')</xar:set>
<xar:data-getitem name="$xproject_properties" module="xproject" itemtype="1" itemid="$projects_objectid" />

<div class="xar-mod-head">
    <span class="xar-mod-title">xTasks Administration</span>
</div>
<div class="xar-mod-body"> 

	<h2>
		<xar:mlstring>Work Log</xar:mlstring>
	</h2>

	<xar:template type="module" file="admin-menu" />

    <p><a href="#xarModURL('xtasks','worklog','report')#"><xar:mlstring>View Summarized Report</xar:mlstring></a></p>
   
    <form method="post" action="#xarModURL('xtasks','worklog','view')#">
		<fieldset>
			<legend>Filter Results:</legend>

	        <div>Days Displayed: <input type="text" name="ttldays" value="#$ttldays#" size="3" /></div>
	        (or)
	        <div>From <xar:data-input type="calendar" name="mindate" value="#$mindate#" />
	             to <xar:data-input type="calendar" name="maxdate" value="#$maxdate#" />
	            <input type="submit" value="Filter" />
	        </div>
		</fieldset>
    </form>

	<table class="xar-fullwidth">
		<tr>
            <th>
				<xar:mlstring>Task / Project</xar:mlstring>
			</th>
	        <th>
				<xar:mlstring>Work By</xar:mlstring>
			</th>
	        <th>
				<xar:mlstring>Date</xar:mlstring>
			</th>
	        <th>
				<xar:mlstring>Hours</xar:mlstring>
			</th>
	        <th>
				<xar:mlstring>Options</xar:mlstring>
			</th>
		</tr>
	    <xar:set name="prevflagdate">""</xar:set>
	    <xar:set name="rowclass">"norm"</xar:set>
	    <xar:foreach in="$worklog" value="$workdetails">
	        <xar:set name="flagdate">strftime("%d-%b-%Y", strtotime($workdetails['eventdate']))</xar:set>
	        <xar:if condition="$prevflagdate ne $flagdate">
	            <xar:if condition="$rowclass eq 'xtasks-norm-row'">
	                <xar:set name="rowclass">"xtasks-alt-row"</xar:set>
	            <xar:else />
	                <xar:set name="rowclass">"xtasks-norm-row"</xar:set>
	            </xar:if>
	            <xar:set name="prevflagdate">$flagdate</xar:set>
	        </xar:if>

	        <tr class="xar-#$rowclass#">
	            <td>
					<xar:mlstring>Task</xar:mlstring>:</em>
					<strong><a href="&xar-modurl-xtasks-admin-display;&amp;taskid=#$workdetails.taskid#">#$workdetails['taskname']#</a></strong>
					<xar:if condition="$workdetails.projectid gt 0">
						[ <a href="&xar-modurl-xproject-admin-display;&amp;projectid=#$workdetails['projectid']#">
							<xar:data-output property="$xproject_properties['project_name']" value="$workdetails['project_name']" />
						</a> ]
					</xar:if>
				</td>
                <td>
					<xar:data-output property="$properties['ownerid']" value="$workdetails['ownerid']" />
				</td>
                <td>
					<xar:data-output property="$properties['eventdate']" value="$workdetails['eventdate']" dateformat="%d-%b" />
				</td>
                <td>
					<xar:data-output property="$properties['hours']" value="$workdetails['hours']" />&nbsp;hrs
				</td>
                <td class="xar-align-center">
					<a href="&xar-modurl-xtasks-worklog-modify;&amp;worklogid=#$workdetails['worklogid']#" title="#xarML('Edit')#"><img src="modules/xtasks/xarimages/button.edit.gif" alt="" /></a>
					<a href="&xar-modurl-xtasks-worklog-delete;&amp;worklogid=#$workdetails['worklogid']#" title="#xarML('Delete')#"><img src="modules/xtasks/xarimages/button.delete.gif" alt="" /></a>
				</td>
	        </tr>
	    </xar:foreach>
	</table>
</div>
