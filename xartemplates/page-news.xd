
<xar:comment>Change this from 'article' to some other prefix to use a different set of template prefixes</xar:comment>
<xar:set name="template_prefix">'article'</xar:set>

<xar:comment>Provide an edit link if we have privileges</xar:comment>
<xar:if condition="xarSecurityCheck('EditXarpagesPage', 0, 'Page', $current_page.name . ':' . $current_page.pagetype.name)">
    <div>[<a href="#xarModURL('xarpages','admin','modifypage',array('pid'=>$pid,'return_url'=>xarServerGetCurrentURL(array(),false)))#">edit</a>]</div>
</xar:if>

<xar:comment>
    If no searching is being done, then display the introduction text.
    You may also wish to suppress the listing below completely if the intro
    text is displayed (so the user sees intro text *or* listings, but never
    both). Adapt this template to do that.
</xar:comment>
<xar:if condition="(empty($extra.searching_flag) and !empty($current_page.dd.intro_text)) or (empty($article) and empty($articles))">
    <div class="xarpages-intro-text">#$current_page.dd.intro_text#</div>
</xar:if>

<xar:comment>Archive table - the user has elected to view an archive</xar:comment>
<xar:if condition="!empty($extra.archive)">
    <div class="xarpages-archive-list"><xar:template file="news-archive-list" /></div>
</xar:if>

<xar:comment>List of items</xar:comment>
<xar:if condition="empty($extra.aid)">
    <xar:comment>Different text for the summary as for an individual item?</xar:comment>
    <xar:if condition="isset($current_page.dd.list_text)">
        <div class="xarpages-list-text">#$current_page.dd.list_text#</div>
    </xar:if>

    <div class="xarpages-summary-wrapper">
        <xar:comment>Loop through the articles to display the summary, calling up a template for format it</xar:comment>
        <xar:loop name="$articles">
            <xar:set name="summary">#xarTplModule('xarpages', $template_prefix, 'summary', $loop:item, $pubtypes[$loop:item.pubtypeid]['name'])#</xar:set>
            #$summary#
        </xar:loop>
    </div>
</xar:if>

<xar:comment>Individual item</xar:comment>
<xar:if condition="!empty($extra.aid)">
    <xar:if condition="!empty($article)">
        <xar:comment>Different text for the summary as for an individual item?</xar:comment>
        <xar:if condition="isset($current_page.dd.item_text)">
            <div>#$current_page.dd.item_text#</div>
        </xar:if>
        <div>
            <xar:set name="display">#xarTplModule('xarpages', $template_prefix, 'display', $article, $pubtypes[$article.pubtypeid]['name'])#</xar:set>
            #$display#
        </div>
    <xar:else />
        <div class="xar-error">
            <xar:ml>
                <xar:mlstring>Article #(1) does not exist or has been removed</xar:mlstring>
                <xar:mlvar>#$extra.aid#</xar:mlvar>
            </xar:ml>
        </div>
    </xar:if>
</xar:if>

<xar:comment>Display the view pager only if not displaying a single item</xar:comment>
<xar:if condition="!empty($extra.pager) and empty($extra.aid)">
    <div class="pager">#$extra.pager#</div>
</xar:if>

<xar:if condition="!empty($hooks)">
    <xar:foreach in="$hooks" key="$hookmodule">
        <xar:if condition="trim($hooks[$hookmodule]) ne ''">
            <div>#$hooks[$hookmodule]#</div>
        </xar:if>
    </xar:foreach>
</xar:if>
