<script type="text/javascript" src="modules/netquery/xarincludes/nqUtility.js"></script>

<xar:style scope="module" file="'.$stylesheet.'" module="netquery" />

<div class="xar-mod-head">
  <span class="xar-mod-title">#$maintitle#</span>
</div>

<div class="xar-mod-body">
<div class="nq-center">

<!-- <h4>#$subtitle#</h4> -->

<form class="nquser" method="post" action="&xar-modurl-netquery-user-main;">
  <fieldset class="nqbuttons">
    <legend>
    <xar:mlstring>Options</xar:mlstring>
    </legend>
    <div class="gobuttons">
    <xar:if condition="!empty($geoip.cn)">
      <a href="#$countrieslink.url#"><img class="gobuttonup" src="#$buttondir#/btn_earth.gif" alt="#$countrieslink.label#" /></a>
    </xar:if>
    </div>
    <div class="nqbuttons">
    <xar:if condition="$whois_enabled"><input name="b1" id="b1" type="image" src="#$buttondir#/btn_whois.gif" class="#$b1class#" alt="Whois" /></xar:if>
    <xar:if condition="$whoisip_enabled"><input name="b2" id="b2" type="image" src="#$buttondir#/btn_whoisip.gif" class="#$b2class#" alt="Whois IP" /></xar:if>
    <xar:if condition="$dns_lookup_enabled"><input name="b3" id="b3" type="image" src="#$buttondir#/btn_dns.gif" class="#$b3class#" alt="DNS Lookup" /></xar:if>
    <xar:if condition="$dns_dig_enabled"><input name="b4" id="b4" type="image" src="#$buttondir#/btn_dig.gif" class="#$b4class#" alt="DNS Dig" /></xar:if>
    <xar:if condition="$email_check_enabled"><input name="b12" id="b12" type="image" src="#$buttondir#/btn_email.gif" class="#$b12class#" alt="Validate Email" /></xar:if>
    <xar:if condition="$port_check_enabled"><input name="b5" id="b5" type="image" src="#$buttondir#/btn_port.gif" class="#$b5class#" alt="Port Check" /></xar:if>
    <xar:if condition="$http_req_enabled"><input name="b6" id="b6" type="image" src="#$buttondir#/btn_http.gif" class="#$b6class#" alt="HTTP Request" /></xar:if>
    <xar:if condition="$ping_enabled"><input name="b7" id="b7" type="image" src="#$buttondir#/btn_ping.gif" class="#$b7class#" alt="Ping" /></xar:if>
    <xar:if condition="$ping_remote_enabled"><input name="b8" id="b8" type="image" src="#$buttondir#/btn_pingrem.gif" class="#$b8class#" alt="Ping Remote" /></xar:if>
    <xar:if condition="$trace_enabled"><input name="b9" id="b9" type="image" src="#$buttondir#/btn_trace.gif" class="#$b9class#" alt="Traceroute" /></xar:if>
    <xar:if condition="$trace_remote_enabled"><input name="b10" id="b10" type="image" src="#$buttondir#/btn_tracerem.gif" class="#$b10class#" alt="Traceroute Remote" /></xar:if>
    <xar:if condition="$looking_glass_enabled"><input name="b11" id="b11" type="image" src="#$buttondir#/btn_lgquery.gif" class="#$b11class#" alt="Looking Glass" /></xar:if>
    </div>
  </fieldset>

<xar:if condition="$formtype eq 'whois'">
  <xar:set name="$manlink">'modules/netquery/xardocs/manual.html#whois'</xar:set>
  <fieldset>
    <legend>
    <xar:mlstring>Whois</xar:mlstring>
    </legend>
    <div class="gobuttons">
    <a href="javascript:NQpopup('#$manlink#','console','400','600');"><img class="gobuttonup" src="#$buttondir#/btn_help.gif" alt="#$hlplink.label#" /></a>
    <input class="gobuttonup" type="image" src="#$buttondir#/btn_go.gif" alt="Go" />
    </div>
    <div class="nqinput">
    <input type="hidden" name="authid" id="authid" value="#$authid#" />
    <input type="hidden" name="querytype" id="querytype" value="whois" />
    <label class="nq-column11" for="domain_1">#$domainlabel#</label>
    <span class="nq-spacer">&nbsp;</span>
    <label class="nq-column2" for="whois_tld_1">#$extlabel#</label><br />
    <xar:while condition="(++$j le $whois_max_limit)">
      <div class="nqinput">
      <input class="nq-column11" type="text" name="domain_#$j#" id="domain_#$j#" value="#$domain[$j]#" size="32" maxlength="50" onfocus="this.value=''" />
      <span class="nq-spacer">.</span>
      <select class="nq-column2" name="whois_tld_#$j#" id="whois_tld_#$j#">
        <xar:foreach in="$links" value="$link">
            <xar:if condition="!empty($link.whois_tld)">
                <xar:if condition="$link.whois_tld eq $whois_tld[$j]">
                    <option selected="selected" value="#$link.whois_tld#">#$link.whois_tld#</option>
                <xar:else />
                    <option value="#$link.whois_tld#">#$link.whois_tld#</option>
                </xar:if>
            </xar:if>
        </xar:foreach>
      </select>
      </div>
    </xar:while>
    </div>
  </fieldset>
</xar:if>

<xar:if condition="$formtype eq 'whoisip'">
  <xar:set name="$manlink">'modules/netquery/xardocs/manual.html#whoisip'</xar:set>
  <fieldset>
    <legend>
    <xar:mlstring>Whois IP</xar:mlstring>
    </legend>
    <div class="gobuttons">
    <a href="javascript:NQpopup('#$manlink#','console','400','600');"><img class="gobuttonup" src="#$buttondir#/btn_help.gif" alt="#$hlplink.label#" /></a>
    <input class="gobuttonup" type="image" src="#$buttondir#/btn_go.gif" alt="Go" />
    </div>
    <div class="nqinput">
    <input type="hidden" name="authid" id="authid" value="#$authid#" />
    <input type="hidden" name="querytype" id="querytype" value="whoisip" />
    <label class="nq-column11" for="host">#$whoisiplabel#</label>
    <br /><input class="nq-column11" type="text" name="host" id="host" value="#$host#" size="32" maxlength="100" />
    </div>
  </fieldset>
</xar:if>

<xar:if condition="$formtype eq 'lookup'">
  <xar:set name="$manlink">'modules/netquery/xardocs/manual.html#dnslookup'</xar:set>
  <fieldset>
    <legend>
    <xar:mlstring>DNS Lookup</xar:mlstring>
    </legend>
    <div class="gobuttons">
    <a href="javascript:NQpopup('#$manlink#','console','400','600');"><img class="gobuttonup" src="#$buttondir#/btn_help.gif" alt="#$hlplink.label#" /></a>
    <input class="gobuttonup" type="image" src="#$buttondir#/btn_go.gif" alt="Go" />
    </div>
    <div class="nqinput">
    <input type="hidden" name="authid" id="authid" value="#$authid#" />
    <input type="hidden" name="querytype" id="querytype" value="lookup" />
    <label class="nq-column11" for="host">#$lookuplabel#</label>
    <br /><input class="nq-column11" type="text" name="host" id="host" value="#$host#" size="32" maxlength="100" />
    </div>
  </fieldset>
</xar:if>

<xar:if condition="$formtype eq 'dig'">
  <xar:set name="$manlink">'modules/netquery/xardocs/manual.html#dnsdig'</xar:set>
  <fieldset>
    <legend>
    <xar:mlstring>DNS Dig</xar:mlstring>
    </legend>
    <div class="gobuttons">
    <a href="javascript:NQpopup('#$manlink#','console','400','600');"><img class="gobuttonup" src="#$buttondir#/btn_help.gif" alt="#$hlplink.label#" /></a>
    <input class="gobuttonup" type="image" src="#$buttondir#/btn_go.gif" alt="Go" />
    </div>
    <div class="nqinput">
    <input type="hidden" name="authid" id="authid" value="#$authid#" />
    <input type="hidden" name="querytype" id="querytype" value="dig" />
    <label class="nq-column11" for="host">#$diglabel#</label>
    <span class="nq-spacer">&nbsp;</span>
    <label class="nq-column2" for="digparam">#$digparamlabel#</label>
    <br /><input class="nq-column11" type="text" name="host" id="host" value="#$host#" size="32" maxlength="100" />
    <span class="nq-spacer">&nbsp;</span>
    <select class="nq-column2" name="digparam" id="digparam">
        <xar:foreach in="$digoptions" value="$digoption">
            <xar:if condition="!empty($digoption.value)">
                <xar:if condition="$digoption.value eq $digparam">
                    <option selected="selected" value="#$digoption.value#">#$digoption.name#</option>
                <xar:else />
                    <option value="#$digoption.value#">#$digoption.name#</option>
                </xar:if>
            </xar:if>
        </xar:foreach>
    </select>
    </div>
  </fieldset>
</xar:if>

<xar:if condition="$formtype eq 'email'">
  <xar:set name="$manlink">'modules/netquery/xardocs/manual.html#email'</xar:set>
  <fieldset>
    <legend>
    <xar:mlstring>Validate Email</xar:mlstring>
    </legend>
    <div class="gobuttons">
    <a href="javascript:NQpopup('#$manlink#','console','400','600');"><img class="gobuttonup" src="#$buttondir#/btn_help.gif" alt="#$hlplink.label#" /></a>
    <input class="gobuttonup" type="image" src="#$buttondir#/btn_go.gif" alt="Go" />
    </div>
    <div class="nqinput">
    <input type="hidden" name="authid" id="authid" value="#$authid#" />
    <input type="hidden" name="querytype" id="querytype" value="email" />
    <label class="nq-column11" for="host">#$emaillabel#</label>
    <br /><input class="nq-column11" type="text" name="email" id="email" value="#$email#" size="32" maxlength="100" />
    </div>
  </fieldset>
</xar:if>

<xar:if condition="$formtype eq 'port'">
  <xar:set name="$manlink">'modules/netquery/xardocs/manual.html#port'</xar:set>
  <fieldset>
    <legend>
    <xar:mlstring>Port Services</xar:mlstring>
    </legend>
    <div class="gobuttons">
    <a href="javascript:NQpopup('#$manlink#','console','400','600');"><img class="gobuttonup" src="#$buttondir#/btn_help.gif" alt="#$hlplink.label#" /></a>
    <input class="gobuttonup" type="image" src="#$buttondir#/btn_go.gif" alt="Go" />
    </div>
    <div class="nqinput">
    <input type="hidden" name="authid" id="authid" value="#$authid#" />
    <input type="hidden" name="querytype" id="querytype" value="port" />
    <label class="nq-column11" for="server">#$serverlabel#</label>
    <span class="nq-spacer">&nbsp;</span>
    <label class="nq-column2" for="portnum">#$portnumlabel#</label>
    <br /><input class="nq-column11" type="text" name="server" id="server" value="#$server#" size="32" maxlength="100" />
    <span class="nq-spacer">&nbsp;</span>
    <input class="nq-column2" type="text" name="portnum" id="portnum" value="#$portnum#" size="5" maxlength="10" />
    </div>
  </fieldset>
</xar:if>

<xar:if condition="$formtype eq 'http'">
  <xar:set name="$manlink">'modules/netquery/xardocs/manual.html#httpreq'</xar:set>
  <fieldset>
    <legend>
    <xar:mlstring>HTTP Request</xar:mlstring>
    </legend>
    <div class="gobuttons">
    <a href="javascript:NQpopup('#$manlink#','console','400','600');"><img class="gobuttonup" src="#$buttondir#/btn_help.gif" alt="#$hlplink.label#" /></a>
    <input class="gobuttonup" type="image" src="#$buttondir#/btn_go.gif" alt="Go" />
    </div>
    <div class="nqinput">
    <input type="hidden" name="authid" id="authid" value="#$authid#" />
    <input type="hidden" name="querytype" id="querytype" value="http" />
    <label class="nq-column11" for="httpurl">#$httpurllabel#</label>
    <span class="nq-spacer">&nbsp;</span>
    <label class="nq-column2" for="httpreq">#$httpreqlabel#</label>
    <br /><input class="nq-column11" type="text" name="httpurl" id="httpurl" value="#$httpurl#" size="32" maxlength="100" />
    <span class="nq-spacer">&nbsp;</span>
    <select class="nq-column2" name="httpreq" id="httpreq">
        <xar:foreach in="$httpoptions" value="$httpoption">
            <xar:if condition="!empty($httpoption)">
                <xar:if condition="$httpoption eq $httpreq">
                    <option selected="selected" value="#$httpoption#">#$httpoption#</option>
                <xar:else />
                    <option value="#$httpoption#">#$httpoption#</option>
                </xar:if>
            </xar:if>
        </xar:foreach>
    </select>
    </div>
  </fieldset>
</xar:if>

<xar:if condition="$formtype eq 'ping'">
  <xar:set name="$manlink">'modules/netquery/xardocs/manual.html#ping'</xar:set>
  <fieldset>
    <legend>
    <xar:mlstring>Ping Host</xar:mlstring>
    </legend>
    <div class="gobuttons">
    <a href="javascript:NQpopup('#$manlink#','console','400','600');"><img class="gobuttonup" src="#$buttondir#/btn_help.gif" alt="#$hlplink.label#" /></a>
    <input class="gobuttonup" type="image" src="#$buttondir#/btn_go.gif" alt="Go" />
    </div>
    <div class="nqinput">
    <input type="hidden" name="authid" id="authid" value="#$authid#" />
    <input type="hidden" name="querytype" id="querytype" value="ping" />
    <label class="nq-column11" for="host">#$pinglabel#</label>
    <span class="nq-spacer">&nbsp;</span>
    <label class="nq-column2" for="maxp">#$maxplabel#</label>
    <br /><input class="nq-column11" type="text" name="host" id="host" value="#$host#" size="32" maxlength="100" />
    <span class="nq-spacer">&nbsp;</span>
    <select class="nq-column2" name="maxp" id="maxp">
        <xar:foreach in="$maxpoptions" value="$maxpoption">
            <xar:if condition="!empty($maxpoption)">
                <xar:if condition="$maxpoption eq $maxp">
                    <option selected="selected" value="#$maxpoption#">#$maxpoption#</option>
                <xar:else />
                    <option value="#$maxpoption#">#$maxpoption#</option>
                </xar:if>
            </xar:if>
        </xar:foreach>
    </select>
    </div>
  </fieldset>
</xar:if>

<xar:if condition="$formtype eq 'pingrem'">
  <xar:set name="$manlink">'modules/netquery/xardocs/manual.html#ping'</xar:set>
  <fieldset>
    <legend>
    <xar:mlstring>Remote Ping</xar:mlstring>
    </legend>

    <div class="gobuttons">
       <a href="javascript:NQpopup('#$manlink#','console','400','600');"><img class="gobuttonup" src="#$buttondir#/btn_help.gif" alt="#$hlplink.label#" /></a>
       <input class="gobuttonup" type="image" src="#$buttondir#/btn_go.gif" alt="Go" onclick="NQremote('#$pingexec_remote#','#$pingexec_remote_t#',host.value);" />
    </div>
    <div class="nqinput">
    <input type="hidden" name="authid" id="authid" value="#$authid#" />
    <input type="hidden" name="querytype" id="querytype" value="pingrem" />
    <label class="nq-column11" for="host">#$pingremotelabel#</label>
    <br /><input class="nq-column11" type="text" name="host" id="host" value="#$host#" size="32" maxlength="100" />
    </div>
  </fieldset>
</xar:if>

<xar:if condition="$formtype eq 'trace'">
  <xar:set name="$manlink">'modules/netquery/xardocs/manual.html#traceroute'</xar:set>
  <fieldset>
    <legend>
    <xar:mlstring>Traceroute</xar:mlstring>
    </legend>
    <div class="gobuttons">
    <a href="javascript:NQpopup('#$manlink#','console','400','600');"><img class="gobuttonup" src="#$buttondir#/btn_help.gif" alt="#$hlplink.label#" /></a>
    <input class="gobuttonup" type="image" src="#$buttondir#/btn_go.gif" alt="Go" />
    </div>
    <div class="nqinput">
    <input type="hidden" name="authid" id="authid" value="#$authid#" />
    <input type="hidden" name="querytype" id="querytype" value="trace" />
    <label class="nq-column11" for="host">#$tracelabel#</label>
    <span class="nq-spacer">&nbsp;</span>
    <label class="nq-column2" for="maxt">#$maxtlabel#</label>
    <br /><input class="nq-column11" type="text" name="host" id="host" value="#$host#" size="32" maxlength="100" />
    <span class="nq-spacer">&nbsp;</span>
    <select class="nq-column2" name="maxt" id="maxt">
        <xar:foreach in="$maxtoptions" value="$maxtoption">
            <xar:if condition="!empty($maxtoption)">
                <xar:if condition="$maxtoption eq $maxt">
                    <option selected="selected" value="#$maxtoption#">#$maxtoption#</option>
                <xar:else />
                    <option value="#$maxtoption#">#$maxtoption#</option>
                </xar:if>
            </xar:if>
        </xar:foreach>
    </select>
    </div>
  </fieldset>
</xar:if>

<xar:if condition="$formtype eq 'tracerem'">
  <xar:set name="$manlink">'modules/netquery/xardocs/manual.html#traceroute'</xar:set>
  <fieldset>
    <legend>
    <xar:mlstring>Remote Traceroute</xar:mlstring>
    </legend>
    <div class="gobuttons">
    <a href="javascript:NQpopup('#$manlink#','console','400','600');"><img class="gobuttonup" src="#$buttondir#/btn_help.gif" alt="#$hlplink.label#" /></a>
    <input class="gobuttonup" type="image" src="#$buttondir#/btn_go.gif" alt="Go" onclick="NQremote('#$traceexec_remote#','#$traceexec_remote_t#',host.value);" />
    </div>
    <div class="nqinput">
    <input type="hidden" name="authid" id="authid" value="#$authid#" />
    <input type="hidden" name="querytype" id="querytype" value="tracerem" />
    <label class="nq-column11" for="host">#$traceremotelabel#</label>
    <br /><input class="nq-column11" type="text" name="host" id="host" value="#$host#" size="32" maxlength="100" />
    </div>
  </fieldset>
</xar:if>

<xar:if condition="$formtype eq 'lgquery'">
  <xar:set name="$manlink">'modules/netquery/xardocs/manual.html#lg'</xar:set>
  <fieldset>
    <legend>
    <xar:mlstring>Looking Glass</xar:mlstring>
    </legend>
    <div class="gobuttons">
    <a href="javascript:NQpopup('#$manlink#','console','400','600');"><img class="gobuttonup" src="#$buttondir#/btn_help.gif" alt="#$hlplink.label#" /></a>
    <input class="gobuttonup" type="image" src="#$buttondir#/btn_go.gif" alt="Go" />
    </div>
    <div class="nqinput">
    <input type="hidden" name="authid" id="authid" value="#$authid#" />
    <input type="hidden" name="querytype" id="querytype" value="lgquery" />
    <label class="nq-column12" for="request">#$lgrequestlabel#</label>
    <span class="nq-spacer">&nbsp;</span>
    <label class="nq-column13" for="lgparam">#$lgparamlabel#</label>
    <span class="nq-spacer">&nbsp;</span>
    <label class="nq-column2" for="router">#$lgrouterlabel#</label>
    <br /><select class="nq-column12" name="request" id="request">
        <xar:foreach in="$lgrequests" value="$req" key="$lgreq">
            <xar:if condition="!empty($req.request)">
                <xar:if condition="$lgdefault[$req.handler] and !(($req.argc) and (!$lgdefault.use_argc))">
                    <xar:if condition="$lgreq eq $request">
                        <option selected="selected" value="#$lgreq#">#$req.request#</option>
                    <xar:else />
                        <option value="#$lgreq#">#$req.request#</option>
                    </xar:if>
                </xar:if>
            </xar:if>
        </xar:foreach>
    </select>
    <span class="nq-spacer">&nbsp;</span>
    <input class="nq-column13" type="text" name="lgparam" id="lgparam" value="#$lgparam#" size="8" maxlength="100" />
    <span class="nq-spacer">&nbsp;</span>
    <select class="nq-column2" name="router" id="router">
        <xar:foreach in="$lgrouters" value="$rtr">
            <xar:if condition="!empty($rtr.router)">
                <xar:if condition="$rtr.router eq $router">
                    <option selected="selected" value="#$rtr.router#">#$rtr.router#</option>
                <xar:else />
                    <option value="#$rtr.router#">#$rtr.router#</option>
                </xar:if>
            </xar:if>
        </xar:foreach>
    </select>
    </div>
  </fieldset>
</xar:if>

</form>

<xar:if condition="'' ne $results">
  <div class="nqresults">
  #$results#
  </div>
</xar:if>

<xar:if condition="$bbsettings.visible">
    <p>
    <xar:if condition="$bbsettings.running">
        <xar:mlstring>Access monitor is running</xar:mlstring>
        <xar:if condition="$bbsettings.verbose">
            &nbsp;- <xar:mlstring>Logging all access</xar:mlstring>
        </xar:if>
        <xar:if condition="$bbsettings.enabled">
            &nbsp;- <xar:mlstring>Spambot screening</xar:mlstring>
            <xar:if condition="$bbsettings.strict">
                 &nbsp;- <xar:mlstring>Strict checking</xar:mlstring>
            </xar:if>
        </xar:if>
    <xar:else />
        <xar:mlstring>Access monitor is NOT running</xar:mlstring>
    </xar:if>
    <br />
    <xar:ml>
      <xar:mlstring>Spambot blocker has denied <strong>#(1)</strong> access attempts in the last #(2) days.</xar:mlstring>
      <xar:mlvar>#$bbstats#</xar:mlvar>
      <xar:mlvar>#$bbsettings.log_retain#</xar:mlvar>
    </xar:ml>
    </p>
</xar:if>

<xar:if condition="$clientinfo_enabled">
    <p>
    <xar:mlstring>Client Info</xar:mlstring> -
    <xar:if condition="!empty($geoip.cn)">
      <xar:if condition="!empty($geoip.geoflag)"><img class="geoflag" src="#$geoip.geoflag#" alt="" /></xar:if>
      <xar:if condition="$mapping_site eq 1">
          <a href="javascript:NQpopup('http://www.mapquest.com/maps/map.adp?latlongtype=decimal&amp;latitude=#$geoip.lat#&amp;longitude=#$geoip.lon#&amp;zoom=0');">#$geoip.cn#</a> - 
      <xar:elseif condition="$mapping_site eq 2" />
          <a href="javascript:NQpopup('http://www.multimap.com/map/browse.cgi?lat=#$geoip.lat#&amp;lon=#$geoip.lon#&amp;scale=40000000&amp;icon=x');">#$geoip.cn#</a> - 
      <xar:else />
          #$geoip.cn#
      </xar:if>
    </xar:if>
    <xar:mlstring>IP</xar:mlstring>: #$client->property("ip")# -
    <xar:mlstring>OS</xar:mlstring>: #$client->property("platform")# #$client->property("os")# -
    <xar:mlstring>Browser</xar:mlstring> : #$client->property("browser")# #$client->property("version")#
    </p>
</xar:if>

<xar:if condition="$exec_timer_enabled">
    <p>
    <xar:mlstring>Execution time</xar:mlstring>: #$timer->get_current('main')#
    </p>
</xar:if>

</div>
</div>
