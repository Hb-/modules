<xar:comment>
    License: GPL http://www.gnu.org/copyleft/gpl.html 
</xar:comment>
<div class="xar-mod-head">
    <span class="xar-mod-title">
        <xar:mlstring>
            Site Tools Administration 
        </xar:mlstring>
    </span>
</div>
<div class="xar-mod-body">
    <h2>
        <xar:mlstring>
            Backup Database Tables 
        </xar:mlstring>
    </h2>
    <xar:set name="$confirmbutton">
        <xar:mlstring>
            Backup 
        </xar:mlstring>
    </xar:set>
    <xar:set name="$backuptitle">
        <xar:mlstring>
            Backing Up Database: 
        </xar:mlstring>
    </xar:set>
    <xar:set name="$goback">
        <xar:mlstring>
            Go Back 
        </xar:mlstring>
    </xar:set>
    <xar:set name="$checktrue">
        <xar:mlstring>
            Select All 
        </xar:mlstring>
    </xar:set>
    <xar:set name="$checkfalse">
        <xar:mlstring>
            Deselect All 
        </xar:mlstring>
    </xar:set>
    <xar:set name="$screenlabel">
        <xar:mlstring>
            Running status display: 
        </xar:mlstring>
    </xar:set>
    <xar:set name="$screenhelp">
        <xar:mlstring>
            If checked, a running status of backup progress is displayed. 
        </xar:mlstring>
    </xar:set>
    <xar:set name="$usegzlabel">
        <xar:mlstring>
            Create GZ backup file(if gz available)? 
        </xar:mlstring>
    </xar:set>
    <xar:set name="$usegzhelp">
        <xar:mlstring>
            If checked the backup file will be in GZ format, if available. Otherwise, a text sql file will be created. 
        </xar:mlstring>
    </xar:set>
    <xar:set name="$securitymessage">
        <xar:mlstring>
            <b>
                SECURITY WARNING:
            </b>
            <br />
            Do not leave your backup file in a web browsable directory.
            <br />
            Remember to delete it, or move it to a secure directory. 
        </xar:mlstring>
    </xar:set>
</div>
<!-- First get choice of backup type -->
<xar:if condition="$warning eq 1">
    <div>
        #$warningmessage#
    </div>
<xar:elseif condition="$startbackup eq ''" />
    <form method="post" action="#xarModURL('sitetools', 'admin', 'backup')#" enctype="application/x-www-form-urlencoded">
        <input type="hidden" name="authid" id="authid" value="#$authid#" />
            <div>
                <span style="float: left; width: 40%; text-align: right;">
                    <xar:mlstring>
                        Backup Type:
                    </xar:mlstring>
                </span>
                <span style="float: right; width: 58%; text-align: left;">
                    <select name="startbackup" id="startbackup">
                        <option value="0">
                            <xar:mlstring>
                                Select backup type
                            </xar:mlstring>
                        </option>
                        <xar:foreach in="$backupops" value="$v" key="$k">
                            <xar:if condition="$k eq $startbackup">
                                <option value="#$k#" selected="selected">
                                    #$v#
                                </option>
                                <xar:else />
                                <option value="#$k#">
                                    #$v#
                                </option>
                            </xar:if>
                        </xar:foreach>
                    </select>
                </span>
            </div>
            <div style="clear: both; padding-top: 10px;">
                <span style="float: left; width: 40%; text-align: right;">
                    <label for="usegz" class="help" title="#$usegzhelp#">
                        #$usegzlabel#
                    </label>
                </span>
                <span style="float: right; width: 58%; text-align: left;">
                    <xar:if condition="$usegz eq true">
                        <input type="checkbox" name="usegz" id="usegz" value="1" checked="checked" />
                    <xar:else />
                        <input type="checkbox" name="usegz" id="usegz" value="1" />
                    </xar:if>
                </span>
            </div>
            <div style="clear: both; padding-top: 10px;">
                <span style="float: left; width: 40%; text-align: right;">
                    <label for="screenlabel" class="help" title="#$screenhelp#">
                        #$screenlabel#
                    </label>
                </span>
                <span style="float: right; width: 58%; text-align: left;">
                    <xar:if condition="$screen eq true">
                        <input type="checkbox" name="screen" id="screen" value="1" checked="checked" />
                    <xar:else />
                        <input type="checkbox" name="screen" id="screen" value="1" />
                    </xar:if>
                </span>
            </div>
            <div style="clear: both; padding-top: 10px;">
                <span style="text-align:center; width:98%; margin-top:20px;">
                    <input type="submit" name="confirm" value="#$confirmbutton#" />
                </span>
            </div>
        </form>
        <p>
            <a href="javascript:history.back(-1)">
                #$goback#
            </a>
        </p>
<!-- Start partial database table selection display -->
<xar:elseif condition="$startbackup eq 'partial'" />
            <form action="#xarModURL('sitetools', 'admin', 'backup')#" method="post" name="SelectedTablesForm" id="SelectedTablesForm" enctype="application/x-www-form-urlencoded">

                <input type="hidden" name="authid" id="authid" value="#$authid#" />
                <input type="hidden" name="startbackup" id="startbackup" value="complete" />
                <input type="hidden" name="usegz" id="usegz" value="#$usegz#" />
                <input type="hidden" name="screen" id="screen" value="#$screen#" />

            <table width="100%" border="0" cellspacing="2" cellpadding="1">
                <tr>
                    <th nowrap="nowrap" colspan="#$number_of_cols#">
                        <label class="xar-mod-title">
                            <xar:mlstring>
                                Tables for:&nbsp;
                            </xar:mlstring>
                            #$dbname# &nbsp;&nbsp;
                            <xar:mlstring>
                                (records)
                            </xar:mlstring>
                        </label>
                    </th>
                </tr>
                <tr>
                    <xar:set name="$i">
                        1
                    </xar:set>
                    <xar:foreach in="$dbtables" value="$dbtable">
                        <xar:if condition="$i++ lt $number_of_cols">
                            <td class="xar-norm-outline" style="text-align: left;margin-left:2px; margin-top:2px; margin-bottom:2px;width:4%;border-width: 0px 0px 1px 0px;border-style: dotted;">
                                <input type="checkbox" name="#$checkboxname#" value="#$dbtable['tablename']#" checked />
                                #$dbtable['tablename']# (#$dbtable['tablerecs']#)
                            </td>
                            <xar:else />
                            <td class="xar-norm-outline" style="text-align: left;margin-left:2px; margin-top:2px; margin-bottom:2px;width:4%;border-width: 0px 0px 1px 0px;border-style: dotted;">
                                <input type="checkbox" name="#$checkboxname#" value="#$dbtable['tablename']#" checked />
                                #$dbtable['tablename']# (#$dbtable['tablerecs']#)
                                <xar:set name="$i">
                                    1
                                </xar:set>
                            </td>
                        </tr>
                        <tr>
                        </xar:if>
                    </xar:foreach>
                </tr>
            </table>
            <span style="float: left; padding-top: 30px; width: 98%; text-align: center;">
                <input type="button" OnClick="CheckAll(true)" value="#$checktrue#" />
                <input type="button" OnClick="CheckAll(false)" value="#$checkfalse#" />
                <input type="submit" name="SelectedTablesOnly" value="#$confirmbutton#" />
            </span>
        </form>

            <a href="javascript:history.back(-1)">
                #$goback#
            </a>

<xar:elseif condition="$startbackup" />
   <xar:if condition="$screen eq 1">
        <xar:loop name="$runningstatus">
            #$loop:item['message']#
             <br />
        </xar:loop>
    </xar:if>
    <div style="margin-top:20px;">
        <table width='90%' align='center' border='1'>
            <tr>
                <th valign='middle' colspan='2'>
                    <xar:mlstring>
                        Backup Summary
                    </xar:mlstring>
                </th>
            </tr>
            <tr>
                <td valign='middle' align='left'>
                    <xar:mlstring>
                        Completed in:
                    </xar:mlstring>
                </td>
                <td valign='middle' align='left'>
                    #$completetime#
                </td>
            </tr>
            <tr>
                <td valign='middle' align='left'>
                    <xar:mlstring>
                        Backup type:
                    </xar:mlstring>
                </td>
                <td valign='middle' align='left'>
                    #$btype#
                </td>
            </tr>
            <tr>
                <td valign='middle' align='left'>
                    <xar:mlstring>
                        Click to download:
                    </xar:mlstring>
                </td>
                <td valign='middle' align='left'>
                    <a href="#$downloadurl#">
                        #$bkname#
                    </a>
                        (#$bkfilesize#)
                </td>
            </tr>
            <tr>
                <td valign='middle' colspan='2' align='center'>
                    #$securitymessage#
                </td>
            </tr>
            <tr>
                <td valign='middle' colspan="2" align='center'>
                    <a href="#$deleteurl#">
                        <xar:mlstring>
                            DELETE backup
                        </xar:mlstring>
                    </a>
                </td>
            </tr>
        </table>
    </div>
</xar:if>

