    .importPluginLanguagePack('preview');var     _PreviewPlugin={getInfo:function(){return{longname:'Preview',author:'Moxiecode Systems',authorurl:'http://    .moxiecode.com',infourl:'http://    .moxiecode.com/    /docs/plugin_preview.html',version:    .majorVersion+"."+    .minorVersion}},getControlHTML:function(cn){switch(cn){case"preview":return     .getButtonHTML(cn,'lang_preview_desc','{$pluginurl}/images/preview.gif','mcePreview')}return""},execCommand:function(editor_id,element,command,user_interface,value){switch(command){case"mcePreview":var previewPage=    .getParam("plugin_preview_pageurl",null);var previewWidth=    .getParam("plugin_preview_width","550");var previewHeight=    .getParam("plugin_preview_height","600");if(previewPage){var template=new Array();template['file']=previewPage;template['width']=previewWidth;template['height']=previewHeight;    .openWindow(template,{editor_id:editor_id,resizable:"yes",scrollbars:"yes",inline:"yes",content:    .getContent(),content_css:    .getParam("content_css")})}else{var win=window.open("","mcePreview","menubar=no,toolbar=no,scrollbars=yes,resizable=yes,left=20,top=20,width="+previewWidth+",height="+previewHeight);var html="";var c=    .getContent();var pos=c.indexOf('<body'),pos2;if(pos!=-1){pos=c.indexOf('>',pos);pos2=c.lastIndexOf('</body>');c=c.substring(pos+1,pos2)}html+=    .getParam('doctype');html+='<html xmlns="http://www.w3.org/1999/xhtml">';html+='<head>';html+='<title>'+    .getLang('lang_preview_desc')+'</title>';html+='<base href="'+    .settings['base_href']+'" />';html+='<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />';html+='<link href="'+    .getParam("content_css")+'" rel="stylesheet" type="text/css" />';html+='<script type="text/javascript">';html+='window.opener.    _PreviewPlugin._setDoc(document);';html+='window.opener.    _PreviewPlugin._setWin(window);';html+='writeFlash = window.opener.    _PreviewPlugin._writeFlash;';html+='writeShockWave = window.opener.    _PreviewPlugin._writeShockWave;';html+='writeQuickTime = window.opener.    _PreviewPlugin._writeQuickTime;';html+='writeRealMedia = window.opener.    _PreviewPlugin._writeRealMedia;';html+='writeWindowsMedia = window.opener.    _PreviewPlugin._writeWindowsMedia;';html+='writeEmbed = window.opener.    _PreviewPlugin._writeEmbed;';html+='</script>';html+='</head>';html+='<body dir="'+    .getParam("directionality")+'" onload="window.opener.    _PreviewPlugin._onLoad();">';html+=c;html+='</body>';html+='</html>';win.document.write(html);win.document.close()}return true}return false},_setDoc:function(d){    _PreviewPlugin._doc=d;d._embeds=new Array()},_setWin:function(d){    _PreviewPlugin._win=d},_onLoad:function(){var nl,i,el=new Array(),d=    _PreviewPlugin._doc,sv,ne;nl=d.getElementsByTagName("script");for(i=0;i<nl.length;i++){sv=    .isMSIE?nl[i].innerHTML:nl[i].firstChild.nodeValue;if(new RegExp('write(Flash|ShockWave|WindowsMedia|QuickTime|RealMedia)\\(.*','g').test(sv))el[el.length]=nl[i]}for(i=0;i<el.length;i++){ne=d.createElement("div");ne.innerHTML=d._embeds[i];el[i].parentNode.insertBefore(ne.firstChild,el[i])}},_writeFlash:function(p){p.src=    .convertRelativeToAbsoluteURL(    .settings['base_href'],p.src);    _PreviewPlugin._writeEmbed('D27CDB6E-AE6D-11cf-96B8-444553540000','http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0','application/x-shockwave-flash',p)},_writeShockWave:function(p){p.src=    .convertRelativeToAbsoluteURL(    .settings['base_href'],p.src);    _PreviewPlugin._writeEmbed('166B1BCA-3F9C-11CF-8075-444553540000','http://download.macromedia.com/pub/shockwave/cabs/director/sw.cab#version=8,5,1,0','application/x-director',p)},_writeQuickTime:function(p){p.src=    .convertRelativeToAbsoluteURL(    .settings['base_href'],p.src);    _PreviewPlugin._writeEmbed('02BF25D5-8C17-4B23-BC80-D3488ABDDC6B','http://www.apple.com/qtactivex/qtplugin.cab#version=6,0,2,0','video/quicktime',p)},_writeRealMedia:function(p){p.src=    .convertRelativeToAbsoluteURL(    .settings['base_href'],p.src);    _PreviewPlugin._writeEmbed('CFCDAA03-8BE4-11cf-B84B-0020AFBBCCFA','http://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=6,0,40,0','audio/x-pn-realaudio-plugin',p)},_writeWindowsMedia:function(p){p.src=    .convertRelativeToAbsoluteURL(    .settings['base_href'],p.src);p.url=p.src;    _PreviewPlugin._writeEmbed('6BF52A52-394A-11D3-B153-00C04F79FAA6','http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701','application/x-mplayer2',p)},_writeEmbed:function(cls,cb,mt,p){var h='',n,d=    _PreviewPlugin._doc,ne,c;h+='<object classid="clsid:'+cls+'" codebase="'+cb+'"';h+=typeof(p.id)!="undefined"?'id="'+p.id+'"':'';h+=typeof(p.name)!="undefined"?'name="'+p.name+'"':'';h+=typeof(p.width)!="undefined"?'width="'+p.width+'"':'';h+=typeof(p.height)!="undefined"?'height="'+p.height+'"':'';h+=typeof(p.align)!="undefined"?'align="'+p.align+'"':'';h+='>';for(n in p)h+='<param name="'+n+'" value="'+p[n]+'">';h+='<embed type="'+mt+'"';for(n in p)h+=n+'="'+p[n]+'" ';h+='></embed></object>';d._embeds[d._embeds.length]=h}};    .addPlugin("preview",    _PreviewPlugin);