<div class="xar-mod-head"><span class="xar-mod-title"><xar:mlstring>Workflow Administration</xar:mlstring></span></div>
<div class="xar-mod-body"><h2>#xarML('Admin process activities')#</h2><br />
<div style="margin: auto;">

<xar:template file="proc_bar" type="module"/>

<xar:if condition="count($errors) gt 0">
<div class="wikitext">
Errors:<br/>
<xar:foreach in="$errors" key="$ix">
<small>#$errors[$ix]#</small><br/>
</xar:foreach>
</div>
</xar:if>

<h3>#xarML('Add or edit an activity')# <a class="link" href="&xar-modurl-workflow-admin-activities;&amp;where2=#$where2#&amp;sort_mode2=#$sort_mode2#&amp;pid=#$pid#&amp;find=#$find#&amp;where=#$where#&amp;sort_mode=#$sort_mode#&amp;activityId=0">#xarML('new')#</a></h3>
<form action="&xar-modurl-workflow-admin-activities;" method="post">
<input type="hidden" name="pid" value="#$pid#" />
<input type="hidden" name="activityId" value="#$info['activityId']#" />
<input type="hidden" name="where2" value="#$where2#" />
<input type="hidden" name="sort_mode2" value="#$sort_mode2#" />
<input type="hidden" name="find" value="#$find#" />
<input type="hidden" name="where" value="#$where#" />
<input type="hidden" name="sort_mode" value="#$sort_mode#" />
<table class="normal">
<tr>
  <td class="formcolor">#xarML('name')#</td>
  <td class="formcolor"><input type="text" name="name" value="#$info['name']#" /></td>
</tr>
<tr>
  <td class="formcolor">#xarML('description')#</td>
  <td class="formcolor"><textarea name="description" rows="4" cols="60">#$info['description']#</textarea></td>
</tr>
<tr>
  <td class="formcolor">#xarML('type')#</td>
  <td class="formcolor">
  <select name="act_type">
<xar:if condition="$info['type'] eq 'start'">
  <option value="start" selected="selected">#xarML('start')#</option>
<xar:else/>
  <option value="start">#xarML('start')#</option>
</xar:if>
<xar:if condition="$info['type'] eq 'end'">
  <option value="end" selected="selected">#xarML('end')#</option>
<xar:else/>
  <option value="end">#xarML('end')#</option>
</xar:if>
<xar:if condition="$info['type'] eq 'activity'">
  <option value="activity" selected="selected">#xarML('activity')#</option>
<xar:else/>
  <option value="activity">#xarML('activity')#</option>
</xar:if>
<xar:if condition="$info['type'] eq 'switch'">
  <option value="switch" selected="selected">#xarML('switch')#</option>
<xar:else/>
  <option value="switch">#xarML('switch')#</option>
</xar:if>
<xar:if condition="$info['type'] eq 'split'">
  <option value="split" selected="selected">#xarML('split')#</option>
<xar:else/>
  <option value="split">#xarML('split')#</option>
</xar:if>
<xar:if condition="$info['type'] eq 'join'">
  <option value="join" selected="selected">#xarML('join')#</option>
<xar:else/>
  <option value="join">#xarML('join')#</option>
</xar:if>
<xar:if condition="$info['type'] eq 'standalone'">
  <option value="standalone" selected="selected">#xarML('standalone')#</option>
<xar:else/>
  <option value="standalone">#xarML('standalone')#</option>
</xar:if>
  </select>
<xar:if condition="$info['isInteractive'] eq 'y'">
  #xarML('interactive')#:<input type="checkbox" name="isInteractive" checked="checked" />
<xar:else/>
  #xarML('interactive')#:<input type="checkbox" name="isInteractive" />
</xar:if>
<xar:if condition="$info['isAutoRouted'] eq 'y'">
  #xarML('auto routed')#:<input type="checkbox" name="isAutoRouted" checked="checked" />
<xar:else/>
  #xarML('auto routed')#:<input type="checkbox" name="isAutoRouted" />
</xar:if>
  </td>
</tr>

<tr>
  <td class="formcolor">#xarML('Add transitions')#</td>
  <td class="formcolor">
    <table class="normal">
		<tr>
			<td class="formcolor">
				#xarML('Add transition from:')#<br/>
				<select name="add_tran_from[]" multiple="multiple" size="5">
				<xar:foreach in="$items" key="$ix">
<xar:if condition="$items[$ix]['from'] eq 'y'">
				<option value="#$items[$ix]['activityId']#" selected="selected">#$items[$ix]['name']#</option>
<xar:else/>
				<option value="#$items[$ix]['activityId']#">#$items[$ix]['name']#</option>
</xar:if>
				</xar:foreach>
				</select>
			</td>
			<td class="formcolor">
				#xarML('Add transition to:')#<br/>
				<select name="add_tran_to[]" multiple="multiple" size="5">
				<xar:foreach in="$items" key="$ix">
<xar:if condition="$items[$ix]['to'] eq 'y'">
				<option value="#$items[$ix]['activityId']#" selected="selected">#$items[$ix]['name']#</option>
<xar:else/>
				<option value="#$items[$ix]['activityId']#">#$items[$ix]['name']#</option>
</xar:if>
				</xar:foreach>
				</select>
			</td>
		</tr>
    </table>
  </td>
</tr>

<tr>
  <td class="formcolor">#xarML('roles')#</td>
  <td class="formcolor">
  <xar:if condition="!empty($roles) and count($roles) gt 0">
  <xar:foreach in="$roles" key="$ix">
  #$roles[$ix]['name']#[<a class="link" href="&xar-modurl-workflow-admin-activities;&amp;where2=#$where2#&amp;sort_mode2=#$sort_mode2#&amp;sort_mode=#$sort_mode#&amp;find=#$find#&amp;where=#$where#&amp;activityId=#$info['activityId']#&amp;pid=#$pid#&amp;remove_role=#$roles[$ix]['roleId']#">x</a>]<br/>
  </xar:foreach>
  <xar:else/>
  #xarML('No roles associated to this activity')#
  </xar:if>
  </td>
</tr>
<tr>
  <td class="formcolor">#xarML('Add role')#</td>
  <td class="formcolor">
  <xar:if condition="count($all_roles)">
  <select name="userole">
  <option value="">#xarML('add new')#</option>
  <xar:foreach in="$all_roles" key="$ix">
  <option value="#$all_roles[$ix]['roleId']#">#$all_roles[$ix]['name']#</option>
  </xar:foreach>
  </select>
  </xar:if>
  <input type="text" name="rolename" /><input type="submit" name="addrole" value="#xarML('add role')#" />
  </td>
</tr>
<tr>
  <td class="formcolor">&nbsp;</td>
  <td class="formcolor"><input type="submit" name="save_act" value="#xarML('save')#" /> </td>
</tr>

</table>
</form>

<h3>#xarML('Process activities')#</h3>

<form action="&xar-modurl-workflow-admin-activities;" method="post">
<input type="hidden" name="sort_mode" value="#$sort_mode#" />
<input type="hidden" name="pid" value="#$pid#" />
<input type="hidden" name="activityId" value="#$info['activityId']#" />
<input type="hidden" name="where2" value="#$where2#" />
<input type="hidden" name="sort_mode2" value="#$sort_mode2#" />
<table>
<tr>
	<td>
		#xarML('Find')#
	</td>
	<td>
		#xarML('Type')#
	</td>
	<td>
		#xarML('Int')#
	</td>
	<td>
		#xarML('Routing')#
	</td>
	<td>
		&nbsp;
	</td>
</tr>
<tr>
	<td>
		<input size="8" type="text" name="find" value="#$find#" />
	</td>
	<td>
		<select name="filter_type">
		  <option value="">#xarML('all')#</option>
		  <option value="start">#xarML('start')#</option>
		  <option value="end" >#xarML('end')#</option>
		  <option value="activity" >#xarML('activity')#</option>
		  <option value="switch" >#xarML('switch')#</option>
		  <option value="split" >#xarML('split')#</option>
		  <option value="join" >#xarML('join')#</option>
		  <option value="standalone" >#xarML('standalone')#</option>
		</select>
	</td>
	<td>
		<select name="filter_interactive">
		<option value="">#xarML('all')#</option>
		<option value="y">#xarML('Interactive')#</option>
		<option value="n">#xarML('Automatic')#</option>
		</select>
	</td>
	<td>
		<select name="filter_autoroute">
		<option value="">#xarML('all')#</option>
		<option value="y">#xarML('Auto routed')#</option>
		<option value="n">#xarML('Manual')#</option>
		</select>
	</td>
	<td>
		<input type="submit" name="filter" value="#xarML('filter')#" />
	</td>
</tr>
</table>
</form>
<form action="&xar-modurl-workflow-admin-activities;" method="post">
<input type="hidden" name="find" value="#$find#" />
<input type="hidden" name="where" value="#$where#" />
<input type="hidden" name="sort_mode" value="#$sort_mode#" />
<input type="hidden" name="where2" value="#$where2#" />
<input type="hidden" name="sort_mode2" value="#$sort_mode2#" />
<input type="hidden" name="pid" value="#$pid#" />
<input type="hidden" name="activityId" value="#$info['activityId']#" />
<table class="normal">
<tr>
<td style="text-align:center;"  class="heading"><input type="submit" name="delete_act" value="x " /></td>
<xar:if condition="$sort_mode eq 'flowNum_desc'">
<td  class="heading" ><a class="tableheading" href="&xar-modurl-workflow-admin-activities;&amp;where2=#$where2#&amp;sort_mode2=#$sort_mode2#&amp;pid=#$pid#&amp;find=#$find#&amp;where=#$where#&amp;sort_mode=flowNum_asc">#</a></td>
<xar:else/>
<td  class="heading" ><a class="tableheading" href="&xar-modurl-workflow-admin-activities;&amp;where2=#$where2#&amp;sort_mode2=#$sort_mode2#&amp;pid=#$pid#&amp;find=#$find#&amp;where=#$where#&amp;sort_mode=flowNum_desc">#</a></td>
</xar:if>
<xar:if condition="$sort_mode eq 'name_desc'">
<td  class="heading" ><a class="tableheading" href="&xar-modurl-workflow-admin-activities;&amp;where2=#$where2#&amp;sort_mode2=#$sort_mode2#&amp;pid=#$pid#&amp;find=#$find#&amp;where=#$where#&amp;sort_mode=name_asc">#xarML('Name')#</a></td>
<xar:else/>
<td  class="heading" ><a class="tableheading" href="&xar-modurl-workflow-admin-activities;&amp;where2=#$where2#&amp;sort_mode2=#$sort_mode2#&amp;pid=#$pid#&amp;find=#$find#&amp;where=#$where#&amp;sort_mode=name_desc">#xarML('Name')#</a></td>
</xar:if>
<xar:if condition="$sort_mode eq 'type_desc'">
<td  class="heading" ><a class="tableheading" href="&xar-modurl-workflow-admin-activities;&amp;where2=#$where2#&amp;sort_mode2=#$sort_mode2#&amp;pid=#$pid#&amp;find=#$find#&amp;where=#$where#&amp;sort_mode=type_asc">#xarML('Type')#</a></td>
<xar:else/>
<td  class="heading" ><a class="tableheading" href="&xar-modurl-workflow-admin-activities;&amp;where2=#$where2#&amp;sort_mode2=#$sort_mode2#&amp;pid=#$pid#&amp;find=#$find#&amp;where=#$where#&amp;sort_mode=type_desc">#xarML('Type')#</a></td>
</xar:if>
<xar:if condition="$sort_mode eq 'isInteractive_desc'">
<td  class="heading" ><a class="tableheading" href="&xar-modurl-workflow-admin-activities;&amp;where2=#$where2#&amp;sort_mode2=#$sort_mode2#&amp;pid=#$pid#&amp;find=#$find#&amp;where=#$where#&amp;sort_mode=isInteractive_asc">#xarML('inter')#</a></td>
<xar:else/>
<td  class="heading" ><a class="tableheading" href="&xar-modurl-workflow-admin-activities;&amp;where2=#$where2#&amp;sort_mode2=#$sort_mode2#&amp;pid=#$pid#&amp;find=#$find#&amp;where=#$where#&amp;sort_mode=isInteractive_desc">#xarML('inter')#</a></td>
</xar:if>
<xar:if condition="$sort_mode eq 'isInteractive_desc'">
<td  class="heading" ><a class="tableheading" href="&xar-modurl-workflow-admin-activities;&amp;where2=#$where2#&amp;sort_mode2=#$sort_mode2#&amp;pid=#$pid#&amp;find=#$find#&amp;where=#$where#&amp;sort_mode=isAutoRouted_asc">#xarML('route')#</a></td>
<xar:else/>
<td  class="heading" ><a class="tableheading" href="&xar-modurl-workflow-admin-activities;&amp;where2=#$where2#&amp;sort_mode2=#$sort_mode2#&amp;pid=#$pid#&amp;find=#$find#&amp;where=#$where#&amp;sort_mode=isAutoRouted_desc">#xarML('route')#</a></td>
</xar:if>
<td  class="heading" >#xarML('Action')#</td>
</tr>
<xar:if condition="!empty($items) and count($items) gt 0">
<xar:foreach in="$items" key="$ix">
<tr>
	<td style="text-align:center;"">
		<input type="checkbox" name="activity[#$items[$ix]['activityId']#]" />
	</td>
	<td style="text-align:right;"">
	  #$items[$ix]['flowNum']#
	</td>

	<td>
	  <a class="link" href="&xar-modurl-workflow-admin-activities;&amp;where2=#$where2#&amp;sort_mode2=#$sort_mode2#&amp;pid=#$pid#&amp;find=#$find#&amp;where=#$where#&amp;sort_mode=#$sort_mode#&amp;activityId=#$items[$ix]['activityId']#">#$items[$ix]['name']#</a>
	  <xar:if condition="$items[$ix]['roles'] < 1">
		<small>#xarML('(no roles)')#</small>
	  </xar:if>
	</td>
	<td style="text-align:center;"">
	<xar:if condition="$items[$ix]['type'] eq 'start'">
		<img src="modules/workflow/lib/Galaxia/img/icons/mini_circle.gif" alt="#$items[$ix]['type']#" title="#$items[$ix]['type']#" border="0" />
	<xar:elseif condition="$items[$ix]['type'] eq 'end'"/>
		<img src="modules/workflow/lib/Galaxia/img/icons/mini_dbl_circle.gif" alt="#$items[$ix]['type']#" title="#$items[$ix]['type']#" border="0" />
	<xar:elseif condition="$items[$ix]['type'] eq 'activity'"/>
		<img src="modules/workflow/lib/Galaxia/img/icons/mini_rectangle.gif" alt="#$items[$ix]['type']#" title="#$items[$ix]['type']#" border="0" />
	<xar:elseif condition="$items[$ix]['type'] eq 'switch'"/>
		<img src="modules/workflow/lib/Galaxia/img/icons/mini_diamond.gif" alt="#$items[$ix]['type']#" title="#$items[$ix]['type']#" border="0" />
	<xar:elseif condition="$items[$ix]['type'] eq 'standalone'"/>
		<img src="modules/workflow/lib/Galaxia/img/icons/mini_hexagon.gif" alt="#$items[$ix]['type']#" title="#$items[$ix]['type']#" border="0" />
	<xar:elseif condition="$items[$ix]['type'] eq 'split'"/>
		<img src="modules/workflow/lib/Galaxia/img/icons/mini_triangle.gif" alt="#$items[$ix]['type']#" title="#$items[$ix]['type']#" border="0" />
	<xar:elseif condition="$items[$ix]['type'] eq 'join'"/>
		<img src="modules/workflow/lib/Galaxia/img/icons/mini_inv_triangle.gif" alt="#$items[$ix]['type']#" title="#$items[$ix]['type']#" border="0" />
	<xar:else/>
		#$items[$ix]['type']#
	</xar:if>
	</td>
	<td style="text-align:center;"">
<xar:if condition="$items[$ix]['isInteractive'] eq 'y'">
	  <input type="checkbox" name="activity_inter[#$items[$ix]['activityId']#]" checked="checked" />
<xar:else/>
	  <input type="checkbox" name="activity_inter[#$items[$ix]['activityId']#]" />
</xar:if>
	</td>
    <td style="text-align:center;"">
<xar:if condition="$items[$ix]['isAutoRouted'] eq 'y'">
	  <input type="checkbox" name="activity_route[#$items[$ix]['activityId']#]" checked="checked" />
<xar:else/>
	  <input type="checkbox" name="activity_route[#$items[$ix]['activityId']#]" />
</xar:if>
	</td>

	<td>
	<a class="link" href="&xar-modurl-workflow-admin-shared_source;&amp;pid=#$pid#&amp;activityId=#$items[$ix]['activityId']#">#xarML('code')#</a>
	<xar:if condition="$items[$ix]['isInteractive'] eq 'y'">
	<br/><a class="link" href="&xar-modurl-workflow-admin-shared_source;&amp;pid=#$pid#&amp;activityId=#$items[$ix]['activityId']#&amp;template=1">#xarML('template')#</a>
	</xar:if>
	</td>
</tr>
</xar:foreach>
<xar:else/>
<tr>
	<td colspan="6">
	#xarML('No activities defined yet')#
	</td>
</tr>
</xar:if>
<tr>
<td class="heading" colspan="7" style="text-align:center;">
<input type="submit" name="update_act" value="#xarML('update')#" />
</td>
</tr>
</table>
</form>

<h3>#xarML('Process Transitions')#</h3>
<table class="normal">
<tr>
	<td >
		<h3>#xarML('List of transitions')#</h3>
			<form action="&xar-modurl-workflow-admin-activities;" method="post" id='filtran'>
			<input type="hidden" name="pid" value="#$pid#" />
			<input type="hidden" name="activityId" value="#$info['activityId']#" />
			<input type="hidden" name="find" value="#$find2#" />
			<input type="hidden" name="where" value="#$where2#" />
			<input type="hidden" name="sort_mode2" value="#$sort_mode2#" />
			#xarML('From:')#<select name="filter_tran_name" onChange="javascript:document.getElementById('filtran').submit();">
<xar:if condition="$filter_tran_name eq ''">
			<option value="" selected="selected">#xarML('all')#</option>
<xar:else/>
			<option value="">#xarML('all')#</option>
</xar:if>
			<xar:foreach in="$items" key="$ix">
<xar:if condition="$filter_tran_name eq $items[$ix]['activityId']">
			<option value="#$items[$ix]['activityId']#" selected="selected">#$items[$ix]['name']#</option>
<xar:else/>
			<option value="#$items[$ix]['activityId']#">#$items[$ix]['name']#</option>
</xar:if>
			</xar:foreach>
			</select>
<!--			<input type="submit" name="filter_tran" value="#xarML('filter')#" /> -->
			</form>

			<form action="&xar-modurl-workflow-admin-activities;" method="post">
			<input type="hidden" name="pid" value="#$pid#" />
			<input type="hidden" name="activityId" value="#$info['activityId']#" />
			<input type="hidden" name="find" value="#$find2#" />
			<input type="hidden" name="where" value="#$where2#" />
			<input type="hidden" name="sort_mode" value="#$sort_mode#" />
			<input type="hidden" name="where2" value="#$where2#" />
			<input type="hidden" name="sort_mode2" value="#$sort_mode2#" />
			<table class="normal">
			<tr>
			<td class="heading" ><input type="submit" name="delete_tran" value="#xarML('x')# " /></td>
<xar:if condition="$sort_mode eq 'actFromName_desc'">
			<td class="heading" ><a class="tableheading" href="&xar-modurl-workflow-admin-activities;&amp;where2=#$where2#&amp;sort_mode2=#$sort_mode2#&amp;pid=#$pid#&amp;find=#$find#&amp;where=#$where#&amp;sort_mode=actFromName_asc">#xarML('Origin')#</a></td>
<xar:else/>
			<td class="heading" ><a class="tableheading" href="&xar-modurl-workflow-admin-activities;&amp;where2=#$where2#&amp;sort_mode2=#$sort_mode2#&amp;pid=#$pid#&amp;find=#$find#&amp;where=#$where#&amp;sort_mode=actFromName_desc">#xarML('Origin')#</a></td>
</xar:if>
<xar:if condition="$sort_mode eq 'actToName_desc'">
			<!--<td class="heading" ><a class="tableheading" href="&xar-modurl-workflow-admin-activities;&amp;where2=#$where2#&amp;sort_mode2=#$sort_mode2#&amp;pid=#$pid#&amp;find=#$find#&amp;where=#$where#&amp;sort_mode=actToName_asc">#xarML('To')#</a></td>-->
<xar:else/>
			<!--<td class="heading" ><a class="tableheading" href="&xar-modurl-workflow-admin-activities;&amp;where2=#$where2#&amp;sort_mode2=#$sort_mode2#&amp;pid=#$pid#&amp;find=#$find#&amp;where=#$where#&amp;sort_mode=actToName_desc">#xarML('To')#</a></td>-->
</xar:if>
			</tr>
<xar:if condition="!empty($transitions) and count($transitions) gt 0">
			<xar:foreach in="$transitions" key="$ix">
			<tr>
				<td>
					<input type="checkbox" name="transition[#$transitions[$ix]['actFromId']#_#$transitions[$ix]['actToId']#]" />
				</td>
				<td>
					<a class="link" href="&xar-modurl-workflow-admin-activities;&amp;where2=#$where2#&amp;sort_mode2=#$sort_mode2#&amp;pid=#$pid#&amp;find=#$find#&amp;where=#$where#&amp;sort_mode=#$sort_mode#&amp;activityId=#$transitions[$ix]['actFromId']#">#$transitions[$ix]['actFromName']#</a>
					<img src='modules/workflow/lib/Galaxia/img/icons/next.gif' alt='to' />
					<a class="link" href="&xar-modurl-workflow-admin-activities;&amp;where2=#$where2#&amp;sort_mode2=#$sort_mode2#&amp;pid=#$pid#&amp;find=#$find#&amp;where=#$where#&amp;sort_mode=#$sort_mode#&amp;activityId=#$transitions[$ix]['actToId']#">#$transitions[$ix]['actToName']#</a>
				</td>
				<!--
				<td>
					#$transitions[$ix]['actToName']#
				</td>
				-->
			</tr>
			</xar:foreach>
<xar:else/>
			<tr>
				<td colspan="3">
				#xarML('No transitions defined yet')#
				</td>
			</tr>
</xar:if>
			</table>
			</form>
	</td>
	<td class="formcolor" >
		<h3>#xarML('Add a transition')#</h3>
		<form action="&xar-modurl-workflow-admin-activities;" method="post">
		<input type="hidden" name="pid" value="#$pid#" />
		<input type="hidden" name="activityId" value="#$info['activityId']#" />
		<input type="hidden" name="find" value="#$find2#" />
		<input type="hidden" name="where" value="#$where2#" />
		<input type="hidden" name="sort_mode" value="#$sort_mode#" />
		<input type="hidden" name="where2" value="#$where2#" />
		<input type="hidden" name="sort_mode2" value="#$sort_mode2#" />
		<table class="normal">
		<tr>
		  <td class="formcolor">
		  From:
		  </td>
		  <td>
		  <select name="actFromId">
		  <xar:foreach in="$items" key="$ix">
		  <option value="#$items[$ix]['activityId']#">#$items[$ix]['name']#</option>
		  </xar:foreach>
		  </select>
		  </td>
		</tr>
		<tr>
		  <td class="formcolor">
		  To:
		  </td>
		  <td>
		   <select name="actToId">
		  <xar:foreach in="$items" key="$ix">
		  <option value="#$items[$ix]['activityId']#">#$items[$ix]['name']#</option>
		  </xar:foreach>
		  </select>
		  </td>
		</tr>
		<tr>
		  <td class="formcolor">&nbsp;</td>
		  <td class="formcolor">
		    <input type="submit" name="add_trans" value="#xarML('add')#" />
		  </td>
		</tr>
		</table>
		</form>
	</td>
</tr>
</table>
<p><i>Based on the <a href="http://tikiwiki.org/tiki-index.php?page=GalaxiaWorkflow">Galaxia Workflow Engine</a></i></p>
</div>
</div>
