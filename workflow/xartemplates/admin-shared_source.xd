<script type="text/javascript">
function setSomeElement(fooel, foo1) {
    document.getElementById(fooel).value = document.getElementById(fooel).value + foo1;
}
</script>

<!-- Process navigation bar -->
<xar:template file="proc_bar"/>

<div class="xar-mod-body">
  <h2><xar:mlstring>Admin process sources</xar:mlstring></h2>

  <div class="xar-norm-outline" style="padding: 0.5em 1em 0.5em; margin: auto; width: 100%">
    <form id='editsource' action="&xar-modurl-workflow-admin-shared_source;" method="post">
      <input type="hidden" name="pid" value="#$pid#" />
      <input type="hidden" name="source_name" value="#$source_name#" />
      <table style="width: 99%">
        <tr>
          <td><xar:mlstring>Activity: </xar:mlstring>
            <select name="activityId" onChange="document.getElementById('editsource').submit();">
              <xar:if condition="$activityId eq 0">
                <option value="" selected="selected"><xar:mlstring>Shared code</xar:mlstring></option>
              <xar:else/>
                <option value=""><xar:mlstring>Shared code</xar:mlstring></option>
              </xar:if>
              <xar:foreach in="$items" key="$ix">
                <xar:if condition="$activityId eq $items[$ix]['activityId']">
                  <option value="#$items[$ix]['activityId']#" selected="selected">#$items[$ix]['name']#</option>
                  <xar:else/>
                  <option value="#$items[$ix]['activityId']#">#$items[$ix]['name']#</option>
                </xar:if>
              </xar:foreach>
            </select>
          </td>
          <td>
            <xar:if condition="$activityId gt 0 and $act_info['isInteractive'] eq 'y' and $template eq 'n'">
              <input type="submit" name='template' value="#xarML('Switch to template')#" />
            </xar:if>
            <xar:if condition="$activityId gt 0 and $act_info['isInteractive'] eq 'y' and $template eq 'y'">
              <input type="submit" name='save' value="#xarML('Switch to code')#" />
            </xar:if>
          </td>
        </tr>
        <tr>
          <td colspan="4">
            <table border="1">
              <tr>
                <td style="width: 100%;">
                  <textarea style="width: 100%" id='src' name="source" rows="20" cols="80">#$data#</textarea>
                </td>
                <td>
                  <xar:if condition="$template != 'y'">
                    <a href="javascript:setSomeElement('src','$instance->setNextUser(\'\');');"><xar:mlstring>Set next user</xar:mlstring></a><hr/>
                    <a href="javascript:setSomeElement('src','$instance->get(\'\');');"><xar:mlstring>Get property</xar:mlstring></a><hr/>
                    <a href="javascript:setSomeElement('src','$instance->set(\'\',\'\');');"><xar:mlstring>Set property</xar:mlstring></a><hr />
                    <xar:if condition="$act_info['isInteractive'] eq 'y'">
                      <a href="javascript:setSomeElement('src','$instance->complete();');"><xar:mlstring>Complete</xar:mlstring></a><hr/>
                      <a href="javascript:setSomeElement('src','if(isset($_REQUEST[\'save\']){\n  $instance->complete();\n}');"><xar:mlstring>Process form</xar:mlstring></a><hr/>
                    </xar:if>
                    <xar:if condition="$act_info['type'] eq 'switch'">
                      <a href="javascript:setSomeElement('src','$instance->setNextActivity(\'\');');"><xar:mlstring>Set Next act</xar:mlstring></a><hr />              
                      <a href="javascript:setSomeElement('src','if() {\n  $instance->setNextActivity(\'\');\n}');"><xar:mlstring>If:SetNextact</xar:mlstring></a><hr />              
                      <a href="javascript:setSomeElement('src','switch($instance->get(\'\')){\n  case:\'\':\n  $instance->setNextActivity(\'\');\n  break;\n}');"><xar:mlstring>Switch construct</xar:mlstring></a><hr />
                    </xar:if>
                  </xar:if>
                </td>
              </tr>
            </table>
          </td>
        </tr>
        <tr>
          <td>
            <input type="submit" name='save' value="#xarML('Save')#" />
            <input type="submit" name='cancel' value="#xarML('Cancel')#" />
          </td>
        </tr>
      </table>  
    </form>
  </div>

  <!-- Show a courtesy footer -->
  <xar:template file="galaxfooter"/>
</div>
